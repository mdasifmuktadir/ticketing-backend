var os=Object.defineProperty;var is=(r,e,t)=>e in r?os(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tr=(r,e,t)=>(is(r,typeof e!="symbol"?e+"":e,t),t);import{_ as pe,o as p,c as m,a as d,t as g,j as y,F as k,d as D,k as as,l as ut,f as q,r as ne,b as Z,g as W,w as ft,h as pt,m as cs,n as j,p as ls}from"./index-e5788531.js";class Oe extends Error{constructor(e,t){const n=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=n}}class Mt extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class _e extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ds extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=n}}class hs extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=n}}class us extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=n}}class fs extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class ps extends Error{constructor(e,t){const n=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=n}}class Hr{constructor(e,t,n){this.statusCode=e,this.statusText=t,this.content=n}}class mt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var v;(function(r){r[r.Trace=0]="Trace",r[r.Debug=1]="Debug",r[r.Information=2]="Information",r[r.Warning=3]="Warning",r[r.Error=4]="Error",r[r.Critical=5]="Critical",r[r.None=6]="None"})(v||(v={}));class Ve{constructor(){}log(e,t){}}Ve.instance=new Ve;const ms="7.0.9";class X{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,n){if(!(e in t))throw new Error(`Unknown ${n} value: ${e}.`)}}class Y{static get isBrowser(){return typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return typeof self=="object"&&"importScripts"in self}static get isReactNative(){return typeof window=="object"&&typeof window.document>"u"}static get isNode(){return!this.isBrowser&&!this.isWebWorker&&!this.isReactNative}}function Ge(r,e){let t="";return Ke(r)?(t=`Binary data of length ${r.byteLength}`,e&&(t+=`. Content: '${gs(r)}'`)):typeof r=="string"&&(t=`String data of length ${r.length}`,e&&(t+=`. Content: '${r}'`)),t}function gs(r){const e=new Uint8Array(r);let t="";return e.forEach(n=>{const s=n<16?"0":"";t+=`0x${s}${n.toString(16)} `}),t.substr(0,t.length-1)}function Ke(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}async function zr(r,e,t,n,s,o){const i={},[c,a]=De();i[c]=a,r.log(v.Trace,`(${e} transport) sending data. ${Ge(s,o.logMessageContent)}.`);const l=Ke(s)?"arraybuffer":"text",h=await t.post(n,{content:s,headers:{...i,...o.headers},responseType:l,timeout:o.timeout,withCredentials:o.withCredentials});r.log(v.Trace,`(${e} transport) request complete. Response status: ${h.statusCode}.`)}function _s(r){return r===void 0?new lt(v.Information):r===null?Ve.instance:r.log!==void 0?r:new lt(r)}class vs{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class lt{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const n=`[${new Date().toISOString()}] ${v[e]}: ${t}`;switch(e){case v.Critical:case v.Error:this.out.error(n);break;case v.Warning:this.out.warn(n);break;case v.Information:this.out.info(n);break;default:this.out.log(n);break}}}}function De(){let r="X-SignalR-User-Agent";return Y.isNode&&(r="User-Agent"),[r,ys(ms,bs(),Cs(),ks())]}function ys(r,e,t,n){let s="Microsoft SignalR/";const o=r.split(".");return s+=`${o[0]}.${o[1]}`,s+=` (${r}; `,e&&e!==""?s+=`${e}; `:s+="Unknown OS; ",s+=`${t}`,n?s+=`; ${n}`:s+="; Unknown Runtime Version",s+=")",s}function bs(){if(Y.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function ks(){if(Y.isNode)return process.versions.node}function Cs(){return Y.isNode?"NodeJS":"Browser"}function rr(r){return r.stack?r.stack:r.message?r.message:`${r}`}function ws(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}class xs extends mt{constructor(e){if(super(),this._logger=e,typeof fetch>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._jar=new(t("tough-cookie")).CookieJar,this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind(ws());if(typeof AbortController>"u"){const t=typeof __webpack_require__=="function"?__non_webpack_require__:require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new _e;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let n;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),n=new _e});let s=null;if(e.timeout){const a=e.timeout;s=setTimeout(()=>{t.abort(),this._logger.log(v.Warning,"Timeout from HTTP request."),n=new Mt},a)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},Ke(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(a){throw n||(this._logger.log(v.Warning,`Error from HTTP request. ${a}.`),a)}finally{s&&clearTimeout(s),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const a=await nr(o,"text");throw new Oe(a||o.statusText,o.status)}const c=await nr(o,e.responseType);return new Hr(o.status,o.statusText,c)}getCookieString(e){let t="";return Y.isNode&&this._jar&&this._jar.getCookies(e,(n,s)=>t=s.join("; ")),t}}function nr(r,e){let t;switch(e){case"arraybuffer":t=r.arrayBuffer();break;case"text":t=r.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=r.text();break}return t}class Ss extends mt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new _e):e.method?e.url?new Promise((t,n)=>{const s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(Ke(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach(i=>{s.setRequestHeader(i,o[i])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),n(new _e)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new Hr(s.status,s.statusText,s.response||s.responseText)):n(new Oe(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(v.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),n(new Oe(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(v.Warning,"Timeout from HTTP request."),n(new Mt)},s.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class Ts extends mt{constructor(e){if(super(),typeof fetch<"u"||Y.isNode)this._httpClient=new xs(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new Ss(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new _e):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class he{static write(e){return`${e}${he.RecordSeparator}`}static parse(e){if(e[e.length-1]!==he.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(he.RecordSeparator);return t.pop(),t}}he.RecordSeparatorCode=30;he.RecordSeparator=String.fromCharCode(he.RecordSeparatorCode);class Rs{writeHandshakeRequest(e){return he.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,n;if(Ke(e)){const c=new Uint8Array(e),a=c.indexOf(he.RecordSeparatorCode);if(a===-1)throw new Error("Message is incomplete.");const l=a+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(c.slice(0,l))),n=c.byteLength>l?c.slice(l).buffer:null}else{const c=e,a=c.indexOf(he.RecordSeparator);if(a===-1)throw new Error("Message is incomplete.");const l=a+1;t=c.substring(0,l),n=c.length>l?c.substring(l):null}const s=he.parse(t),o=JSON.parse(s[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[n,o]}}var H;(function(r){r[r.Invocation=1]="Invocation",r[r.StreamItem=2]="StreamItem",r[r.Completion=3]="Completion",r[r.StreamInvocation=4]="StreamInvocation",r[r.CancelInvocation=5]="CancelInvocation",r[r.Ping=6]="Ping",r[r.Close=7]="Close"})(H||(H={}));class Es{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new vs(this,e)}}const Ps=30*1e3,As=15*1e3;var z;(function(r){r.Disconnected="Disconnected",r.Connecting="Connecting",r.Connected="Connected",r.Disconnecting="Disconnecting",r.Reconnecting="Reconnecting"})(z||(z={}));class jt{constructor(e,t,n,s){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(v.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},X.isRequired(e,"connection"),X.isRequired(t,"logger"),X.isRequired(n,"protocol"),this.serverTimeoutInMilliseconds=Ps,this.keepAliveIntervalInMilliseconds=As,this._logger=t,this._protocol=n,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new Rs,this.connection.onreceive=o=>this._processIncomingData(o),this.connection.onclose=o=>this._connectionClosed(o),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=z.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:H.Ping})}static create(e,t,n,s){return new jt(e,t,n,s)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==z.Disconnected&&this._connectionState!==z.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==z.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=z.Connecting,this._logger.log(v.Debug,"Starting HubConnection.");try{await this._startInternal(),Y.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=z.Connected,this._connectionStarted=!0,this._logger.log(v.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=z.Disconnected,this._logger.log(v.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,n)=>{this._handshakeResolver=t,this._handshakeRejecter=n});await this.connection.start(this._protocol.transferFormat);try{const t={protocol:this._protocol.name,version:this._protocol.version};if(this._logger.log(v.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(t)),this._logger.log(v.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(v.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){return this._connectionState===z.Disconnected?(this._logger.log(v.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===z.Disconnecting?(this._logger.log(v.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=z.Disconnecting,this._logger.log(v.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(v.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new _e("The connection was stopped before the hub handshake could complete."),this.connection.stop(e)))}stream(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,s);let i;const c=new Es;return c.cancelCallback=()=>{const a=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],i.then(()=>this._sendWithProtocol(a))},this._callbacks[o.invocationId]=(a,l)=>{if(l){c.error(l);return}else a&&(a.type===H.Completion?a.error?c.error(new Error(a.error)):c.complete():c.next(a.item))},i=this._sendWithProtocol(o).catch(a=>{c.error(a),delete this._callbacks[o.invocationId]}),this._launchStreams(n,i),c}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,s));return this._launchStreams(n,o),o}invoke(e,...t){const[n,s]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,s);return new Promise((c,a)=>{this._callbacks[o.invocationId]=(h,u)=>{if(u){a(u);return}else h&&(h.type===H.Completion?h.error?a(new Error(h.error)):c(h.result):a(new Error(`Unexpected message type: ${h.type}`)))};const l=this._sendWithProtocol(o).catch(h=>{a(h),delete this._callbacks[o.invocationId]});this._launchStreams(n,l)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const n=this._methods[e];if(n)if(t){const s=n.indexOf(t);s!==-1&&(n.splice(s,1),n.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const n of t)switch(n.type){case H.Invocation:this._invokeClientMethod(n);break;case H.StreamItem:case H.Completion:{const s=this._callbacks[n.invocationId];if(s){n.type===H.Completion&&delete this._callbacks[n.invocationId];try{s(n)}catch(o){this._logger.log(v.Error,`Stream callback threw error: ${rr(o)}`)}}break}case H.Ping:break;case H.Close:{this._logger.log(v.Information,"Close message received from server.");const s=n.error?new Error("Server returned an error on close: "+n.error):void 0;n.allowReconnect===!0?this.connection.stop(s):this._stopPromise=this._stopInternal(s);break}default:this._logger.log(v.Warning,`Invalid message type: ${n.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,n;try{[n,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(s){const o="Error parsing handshake response: "+s;this._logger.log(v.Error,o);const i=new Error(o);throw this._handshakeRejecter(i),i}if(t.error){const s="Server returned handshake error: "+t.error;this._logger.log(v.Error,s);const o=new Error(s);throw this._handshakeRejecter(o),o}else this._logger.log(v.Debug,"Server handshake complete.");return this._handshakeResolver(),n}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===z.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),n=this._methods[t];if(!n){this._logger.log(v.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(v.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const s=n.slice(),o=!!e.invocationId;let i,c,a;for(const l of s)try{const h=i;i=await l.apply(this,e.arguments),o&&i&&h&&(this._logger.log(v.Error,`Multiple results provided for '${t}'. Sending error to server.`),a=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),c=void 0}catch(h){c=h,this._logger.log(v.Error,`A callback for the method '${t}' threw error '${h}'.`)}a?await this._sendWithProtocol(a):o?(c?a=this._createCompletionMessage(e.invocationId,`${c}`,null):i!==void 0?a=this._createCompletionMessage(e.invocationId,null,i):(this._logger.log(v.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),a=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(a)):i&&this._logger.log(v.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(v.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new _e("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===z.Disconnecting?this._completeClose(e):this._connectionState===z.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===z.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=z.Disconnected,this._connectionStarted=!1,Y.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(v.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let n=0,s=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(n++,0,s);if(o===null){this._logger.log(v.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=z.Reconnecting,e?this._logger.log(v.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(v.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(i=>i.apply(this,[e]))}catch(i){this._logger.log(v.Error,`An onreconnecting callback called with error '${e}' threw error '${i}'.`)}if(this._connectionState!==z.Reconnecting){this._logger.log(v.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(v.Information,`Reconnect attempt number ${n} will start in ${o} ms.`),await new Promise(i=>{this._reconnectDelayHandle=setTimeout(i,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==z.Reconnecting){this._logger.log(v.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=z.Connected,this._logger.log(v.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(i=>i.apply(this,[this.connection.connectionId]))}catch(i){this._logger.log(v.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${i}'.`)}return}catch(i){if(this._logger.log(v.Information,`Reconnect attempt failed because of error '${i}'.`),this._connectionState!==z.Reconnecting){this._logger.log(v.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===z.Disconnecting&&this._completeClose();return}s=i instanceof Error?i:new Error(i.toString()),o=this._getNextRetryDelay(n++,Date.now()-t,s)}}this._logger.log(v.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${n} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,n){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:n})}catch(s){return this._logger.log(v.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${s}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(n=>{const s=t[n];try{s(null,e)}catch(o){this._logger.log(v.Error,`Stream 'error' callback called with '${e}' threw error: ${rr(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,n,s){if(n)return s.length!==0?{arguments:t,streamIds:s,target:e,type:H.Invocation}:{arguments:t,target:e,type:H.Invocation};{const o=this._invocationId;return this._invocationId++,s.length!==0?{arguments:t,invocationId:o.toString(),streamIds:s,target:e,type:H.Invocation}:{arguments:t,invocationId:o.toString(),target:e,type:H.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const n in e)e[n].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n)))},error:s=>{let o;s instanceof Error?o=s.message:s&&s.toString?o=s.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(n,o)))},next:s=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(n,s)))}})}}_replaceStreamingParams(e){const t=[],n=[];for(let s=0;s<e.length;s++){const o=e[s];if(this._isObservable(o)){const i=this._invocationId;this._invocationId++,t[i]=o,n.push(i.toString()),e.splice(s,1)}}return[t,n]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,n){const s=this._invocationId;return this._invocationId++,n.length!==0?{arguments:t,invocationId:s.toString(),streamIds:n,target:e,type:H.StreamInvocation}:{arguments:t,invocationId:s.toString(),target:e,type:H.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:H.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:H.StreamItem}}_createCompletionMessage(e,t,n){return t?{error:t,invocationId:e,type:H.Completion}:{invocationId:e,result:n,type:H.Completion}}}const Is=[0,2e3,1e4,3e4,null];class sr{constructor(e){this._retryDelays=e!==void 0?[...e,null]:Is}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Ee{}Ee.Authorization="Authorization";Ee.Cookie="Cookie";class Os extends mt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const n=await this._innerClient.send(e);return t&&n.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):n}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Ee.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Ee.Authorization]&&delete e.headers[Ee.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var K;(function(r){r[r.None=0]="None",r[r.WebSockets=1]="WebSockets",r[r.ServerSentEvents=2]="ServerSentEvents",r[r.LongPolling=4]="LongPolling"})(K||(K={}));var se;(function(r){r[r.Text=1]="Text",r[r.Binary=2]="Binary"})(se||(se={}));let Ds=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class or{constructor(e,t,n){this._httpClient=e,this._logger=t,this._pollAbort=new Ds,this._options=n,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}async connect(e,t){if(X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,se,"transferFormat"),this._url=e,this._logger.log(v.Trace,"(LongPolling transport) Connecting."),t===se.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[n,s]=De(),o={[n]:s,...this._options.headers},i={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===se.Binary&&(i.responseType="arraybuffer");const c=`${e}&_=${Date.now()}`;this._logger.log(v.Trace,`(LongPolling transport) polling: ${c}.`);const a=await this._httpClient.get(c,i);a.statusCode!==200?(this._logger.log(v.Error,`(LongPolling transport) Unexpected response code: ${a.statusCode}.`),this._closeError=new Oe(a.statusText||"",a.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,i)}async _poll(e,t){try{for(;this._running;)try{const n=`${e}&_=${Date.now()}`;this._logger.log(v.Trace,`(LongPolling transport) polling: ${n}.`);const s=await this._httpClient.get(n,t);s.statusCode===204?(this._logger.log(v.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):s.statusCode!==200?(this._logger.log(v.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new Oe(s.statusText||"",s.statusCode),this._running=!1):s.content?(this._logger.log(v.Trace,`(LongPolling transport) data received. ${Ge(s.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(s.content)):this._logger.log(v.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(n){this._running?n instanceof Mt?this._logger.log(v.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=n,this._running=!1):this._logger.log(v.Trace,`(LongPolling transport) Poll errored after shutdown: ${n.message}`)}}finally{this._logger.log(v.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?zr(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(v.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(v.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,n]=De();e[t]=n;const s={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};await this._httpClient.delete(this._url,s),this._logger.log(v.Trace,"(LongPolling transport) DELETE request sent.")}finally{this._logger.log(v.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(v.Trace,e),this.onclose(this._closeError)}}}class Bs{constructor(e,t,n,s){this._httpClient=e,this._accessToken=t,this._logger=n,this._options=s,this.onreceive=null,this.onclose=null}async connect(e,t){return X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,se,"transferFormat"),this._logger.log(v.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((n,s)=>{let o=!1;if(t!==se.Text){s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let i;if(Y.isBrowser||Y.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const c=this._httpClient.getCookieString(e),a={};a.Cookie=c;const[l,h]=De();a[l]=h,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...a,...this._options.headers}})}try{i.onmessage=c=>{if(this.onreceive)try{this._logger.log(v.Trace,`(SSE transport) data received. ${Ge(c.data,this._options.logMessageContent)}.`),this.onreceive(c.data)}catch(a){this._close(a);return}},i.onerror=c=>{o?this._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(v.Information,`SSE connected to ${this._url}`),this._eventSource=i,o=!0,n()}}catch(c){s(c);return}})}async send(e){return this._eventSource?zr(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class $s{constructor(e,t,n,s,o,i){this._logger=n,this._accessTokenFactory=t,this._logMessageContent=s,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=i}async connect(e,t){X.isRequired(e,"url"),X.isRequired(t,"transferFormat"),X.isIn(t,se,"transferFormat"),this._logger.log(v.Trace,"(WebSockets transport) Connecting.");let n;return this._accessTokenFactory&&(n=await this._accessTokenFactory()),new Promise((s,o)=>{e=e.replace(/^http/,"ws");let i;const c=this._httpClient.getCookieString(e);let a=!1;if(Y.isNode||Y.isReactNative){const l={},[h,u]=De();l[h]=u,n&&(l[Ee.Authorization]=`Bearer ${n}`),c&&(l[Ee.Cookie]=c),i=new this._webSocketConstructor(e,void 0,{headers:{...l,...this._headers}})}else n&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(n)}`);i||(i=new this._webSocketConstructor(e)),t===se.Binary&&(i.binaryType="arraybuffer"),i.onopen=l=>{this._logger.log(v.Information,`WebSocket connected to ${e}.`),this._webSocket=i,a=!0,s()},i.onerror=l=>{let h=null;typeof ErrorEvent<"u"&&l instanceof ErrorEvent?h=l.error:h="There was an error with the transport",this._logger.log(v.Information,`(WebSockets transport) ${h}.`)},i.onmessage=l=>{if(this._logger.log(v.Trace,`(WebSockets transport) data received. ${Ge(l.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(l.data)}catch(h){this._close(h);return}},i.onclose=l=>{if(a)this._close(l);else{let h=null;typeof ErrorEvent<"u"&&l instanceof ErrorEvent?h=l.error:h="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(h))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(v.Trace,`(WebSockets transport) sending data. ${Ge(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(v.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const ir=100;class Ns{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,X.isRequired(e,"url"),this._logger=_s(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let n=null,s=null;if(Y.isNode&&typeof require<"u"){const o=typeof __webpack_require__=="function"?__non_webpack_require__:require;n=o("ws"),s=o("eventsource")}!Y.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:Y.isNode&&!t.WebSocket&&n&&(t.WebSocket=n),!Y.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:Y.isNode&&!t.EventSource&&typeof s<"u"&&(t.EventSource=s),this._httpClient=new Os(t.httpClient||new Ts(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||se.Binary,X.isIn(e,se,"transferFormat"),this._logger.log(v.Debug,`Starting connection with transfer format '${se[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(v.Error,t),await this._stopPromise,Promise.reject(new _e(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(v.Error,t),Promise.reject(new _e(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Ft(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(v.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(v.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(v.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(v.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===K.WebSockets)this.transport=this._constructTransport(K.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let n=null,s=0;do{if(n=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new _e("The connection was stopped during negotiation.");if(n.error)throw new Error(n.error);if(n.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(n.url&&(t=n.url),n.accessToken){const o=n.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}s++}while(n.url&&s<ir);if(s===ir&&n.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,n,e)}this.transport instanceof or&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(v.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(n){return this._logger.log(v.Error,"Failed to start the connection: "+n),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(n)}}async _getNegotiationResponse(e){const t={},[n,s]=De();t[n]=s;const o=this._resolveNegotiateUrl(e);this._logger.log(v.Debug,`Sending negotiation request: ${o}.`);try{const i=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(i.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${i.statusCode}'`));const c=JSON.parse(i.content);return(!c.negotiateVersion||c.negotiateVersion<1)&&(c.connectionToken=c.connectionId),c}catch(i){let c="Failed to complete negotiation with the server: "+i;return i instanceof Oe&&i.statusCode===404&&(c=c+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(v.Error,c),Promise.reject(new fs(c))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,n,s){let o=this._createConnectUrl(e,n.connectionToken);if(this._isITransport(t)){this._logger.log(v.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,s),this.connectionId=n.connectionId;return}const i=[],c=n.availableTransports||[];let a=n;for(const l of c){const h=this._resolveTransportOrError(l,t,s);if(h instanceof Error)i.push(`${l.transport} failed:`),i.push(h);else if(this._isITransport(h)){if(this.transport=h,!a){try{a=await this._getNegotiationResponse(e)}catch(u){return Promise.reject(u)}o=this._createConnectUrl(e,a.connectionToken)}try{await this._startTransport(o,s),this.connectionId=a.connectionId;return}catch(u){if(this._logger.log(v.Error,`Failed to start the transport '${l.transport}': ${u}`),a=void 0,i.push(new us(`${l.transport} failed: ${u}`,K[l.transport])),this._connectionState!=="Connecting"){const f="Failed to select transport before stop() was called.";return this._logger.log(v.Debug,f),Promise.reject(new _e(f))}}}}return i.length>0?Promise.reject(new ps(`Unable to connect to the server with any of the available transports. ${i.join(" ")}`,i)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case K.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new $s(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case K.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new Bs(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case K.LongPolling:return new or(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=n=>this._stopConnection(n),this.transport.connect(e,t)}_resolveTransportOrError(e,t,n){const s=K[e.transport];if(s==null)return this._logger.log(v.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(Ms(t,s))if(e.transferFormats.map(i=>se[i]).indexOf(n)>=0){if(s===K.WebSockets&&!this._options.WebSocket||s===K.ServerSentEvents&&!this._options.EventSource)return this._logger.log(v.Debug,`Skipping transport '${K[s]}' because it is not supported in your environment.'`),new ds(`'${K[s]}' is not supported in your environment.`,s);this._logger.log(v.Debug,`Selecting transport '${K[s]}'.`);try{return this._constructTransport(s)}catch(i){return i}}else return this._logger.log(v.Debug,`Skipping transport '${K[s]}' because it does not support the requested transfer format '${se[n]}'.`),new Error(`'${K[s]}' does not support ${se[n]}.`);else return this._logger.log(v.Debug,`Skipping transport '${K[s]}' because it was disabled by the client.`),new hs(`'${K[s]}' is disabled by the client.`,s)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(v.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(v.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(v.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(v.Error,`Connection disconnected with error '${e}'.`):this._logger.log(v.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(v.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(v.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Y.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(v.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=e.indexOf("?");let n=e.substring(0,t===-1?e.length:t);return n[n.length-1]!=="/"&&(n+="/"),n+="negotiate",n+=t===-1?"":e.substring(t),n.indexOf("negotiateVersion")===-1&&(n+=t===-1?"?":"&",n+="negotiateVersion="+this._negotiateVersion),n}}function Ms(r,e){return!r||(e&r)!==0}class Ft{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new Xe,this._transportResult=new Xe,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new Xe),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new Xe;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):Ft._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(n){e.reject(n)}}}static _concatBuffers(e){const t=e.map(o=>o.byteLength).reduce((o,i)=>o+i),n=new Uint8Array(t);let s=0;for(const o of e)n.set(new Uint8Array(o),s),s+=o.byteLength;return n.buffer}}class Xe{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const js="json";class Fs{constructor(){this.name=js,this.version=1,this.transferFormat=se.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=Ve.instance);const n=he.parse(e),s=[];for(const o of n){const i=JSON.parse(o);if(typeof i.type!="number")throw new Error("Invalid payload.");switch(i.type){case H.Invocation:this._isInvocationMessage(i);break;case H.StreamItem:this._isStreamItemMessage(i);break;case H.Completion:this._isCompletionMessage(i);break;case H.Ping:break;case H.Close:break;default:t.log(v.Information,"Unknown message type '"+i.type+"' ignored.");continue}s.push(i)}return s}writeMessage(e){return he.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const Ls={trace:v.Trace,debug:v.Debug,info:v.Information,information:v.Information,warn:v.Warning,warning:v.Warning,error:v.Error,critical:v.Critical,none:v.None};function Us(r){const e=Ls[r.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${r}`)}class Hs{configureLogging(e){if(X.isRequired(e,"logging"),zs(e))this.logger=e;else if(typeof e=="string"){const t=Us(e);this.logger=new lt(t)}else this.logger=new lt(e);return this}withUrl(e,t){return X.isRequired(e,"url"),X.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return X.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new sr(e):this.reconnectPolicy=e:this.reconnectPolicy=new sr,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new Ns(this.url,e);return jt.create(t,this.logger||Ve.instance,this.protocol||new Fs,this.reconnectPolicy)}}function zs(r){return r.log!==void 0}const ye=Object.create(null);ye.open="0";ye.close="1";ye.ping="2";ye.pong="3";ye.message="4";ye.upgrade="5";ye.noop="6";const nt=Object.create(null);Object.keys(ye).forEach(r=>{nt[ye[r]]=r});const qs={type:"error",data:"parser error"},qr=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Wr=typeof ArrayBuffer=="function",Vr=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Lt=({type:r,data:e},t,n)=>qr&&e instanceof Blob?t?n(e):ar(e,n):Wr&&(e instanceof ArrayBuffer||Vr(e))?t?n(e):ar(new Blob([e]),n):n(ye[r]+(e||"")),ar=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function cr(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let bt;function Ws(r,e){if(qr&&r.data instanceof Blob)return r.data.arrayBuffer().then(cr).then(e);if(Wr&&(r.data instanceof ArrayBuffer||Vr(r.data)))return e(cr(r.data));Lt(r,!1,t=>{bt||(bt=new TextEncoder),e(bt.encode(t))})}const lr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Le=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<lr.length;r++)Le[lr.charCodeAt(r)]=r;const Vs=r=>{let e=r.length*.75,t=r.length,n,s=0,o,i,c,a;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const l=new ArrayBuffer(e),h=new Uint8Array(l);for(n=0;n<t;n+=4)o=Le[r.charCodeAt(n)],i=Le[r.charCodeAt(n+1)],c=Le[r.charCodeAt(n+2)],a=Le[r.charCodeAt(n+3)],h[s++]=o<<2|i>>4,h[s++]=(i&15)<<4|c>>2,h[s++]=(c&3)<<6|a&63;return l},Gs=typeof ArrayBuffer=="function",Ut=(r,e)=>{if(typeof r!="string")return{type:"message",data:Gr(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Js(r.substring(1),e)}:nt[t]?r.length>1?{type:nt[t],data:r.substring(1)}:{type:nt[t]}:qs},Js=(r,e)=>{if(Gs){const t=Vs(r);return Gr(t,e)}else return{base64:!0,data:r}},Gr=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Jr=String.fromCharCode(30),Ks=(r,e)=>{const t=r.length,n=new Array(t);let s=0;r.forEach((o,i)=>{Lt(o,!1,c=>{n[i]=c,++s===t&&e(n.join(Jr))})})},Ys=(r,e)=>{const t=r.split(Jr),n=[];for(let s=0;s<t.length;s++){const o=Ut(t[s],e);if(n.push(o),o.type==="error")break}return n};let kt;function Xs(r,e,t){kt||(kt=new TextDecoder);const n=e||r[0]<48||r[0]>54;return Ut(n?r:kt.decode(r),t)}const Kr=4;function J(r){if(r)return Qs(r)}function Qs(r){for(var e in J.prototype)r[e]=J.prototype[e];return r}J.prototype.on=J.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};J.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};J.prototype.off=J.prototype.removeListener=J.prototype.removeAllListeners=J.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,s=0;s<t.length;s++)if(n=t[s],n===e||n.fn===e){t.splice(s,1);break}return t.length===0&&delete this._callbacks["$"+r],this};J.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,s=t.length;n<s;++n)t[n].apply(this,e)}return this};J.prototype.emitReserved=J.prototype.emit;J.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};J.prototype.hasListeners=function(r){return!!this.listeners(r).length};const fe=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())();function Yr(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const Zs=fe.setTimeout,eo=fe.clearTimeout;function gt(r,e){e.useNativeTimers?(r.setTimeoutFn=Zs.bind(fe),r.clearTimeoutFn=eo.bind(fe)):(r.setTimeoutFn=fe.setTimeout.bind(fe),r.clearTimeoutFn=fe.clearTimeout.bind(fe))}const to=1.33;function ro(r){return typeof r=="string"?no(r):Math.ceil((r.byteLength||r.size)*to)}function no(r){let e=0,t=0;for(let n=0,s=r.length;n<s;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function so(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function oo(r){let e={},t=r.split("&");for(let n=0,s=t.length;n<s;n++){let o=t[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class io extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class Ht extends J{constructor(e){super(),this.writable=!1,gt(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new io(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Ut(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=so(e);return t.length?"?"+t:""}}const Xr="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),xt=64,ao={};let dr=0,Qe=0,hr;function ur(r){let e="";do e=Xr[r%xt]+e,r=Math.floor(r/xt);while(r>0);return e}function Qr(){const r=ur(+new Date);return r!==hr?(dr=0,hr=r):r+"."+ur(dr++)}for(;Qe<xt;Qe++)ao[Xr[Qe]]=Qe;let Zr=!1;try{Zr=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const co=Zr;function en(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||co))return new XMLHttpRequest}catch{}if(!e)try{return new fe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function lo(){}const ho=function(){return new en({xdomain:!1}).responseType!=null}();class uo extends Ht{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||s!==e.port}const t=e&&e.forceBase64;this.supportsBinary=ho&&!t,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Ys(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Ks(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Qr()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new ve(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(s,o)=>{this.onError("xhr post error",s,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}class ve extends J{constructor(e,t){super(),gt(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.data=t.data!==void 0?t.data:null,this.create()}create(){var e;const t=Yr(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd;const n=this.xhr=new en(t);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let s in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(s)&&n.setRequestHeader(s,this.opts.extraHeaders[s])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var s;n.readyState===3&&((s=this.opts.cookieJar)===null||s===void 0||s.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(s){this.setTimeoutFn(()=>{this.onError(s)},0);return}typeof document<"u"&&(this.index=ve.requestsCount++,ve.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=lo,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete ve.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}ve.requestsCount=0;ve.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",fr);else if(typeof addEventListener=="function"){const r="onpagehide"in fe?"pagehide":"unload";addEventListener(r,fr,!1)}}function fr(){for(let r in ve.requests)ve.requests.hasOwnProperty(r)&&ve.requests[r].abort()}const zt=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Ze=fe.WebSocket||fe.MozWebSocket,pr=!0,fo="arraybuffer",mr=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class po extends Ht{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=mr?{}:Yr(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=pr&&!mr?t?new Ze(e,t):new Ze(e):new Ze(e,t,n)}catch(s){return this.emitReserved("error",s)}this.ws.binaryType=this.socket.binaryType||fo,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;Lt(n,this.supportsBinary,o=>{const i={};try{pr&&this.ws.send(o)}catch{}s&&zt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Qr()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}check(){return!!Ze}}function mo(r,e){return r.type==="message"&&typeof r.data!="string"&&e[0]>=48&&e[0]<=54}class go extends Ht{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>this.onClose()),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const t=e.readable.getReader();this.writer=e.writable.getWriter();let n;const s=()=>{t.read().then(({done:i,value:c})=>{i||(!n&&c.byteLength===1&&c[0]===54?n=!0:(this.onPacket(Xs(c,n,"arraybuffer")),n=!1),s())})};s();const o=this.query.sid?`0{"sid":"${this.query.sid}"}`:"0";this.writer.write(new TextEncoder().encode(o)).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],s=t===e.length-1;Ws(n,o=>{mo(n,o)&&this.writer.write(Uint8Array.of(54)),this.writer.write(o).then(()=>{s&&zt(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const _o={websocket:po,webtransport:go,polling:uo},vo=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yo=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function St(r){const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let s=vo.exec(r||""),o={},i=14;for(;i--;)o[yo[i]]=s[i]||"";return t!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=bo(o,o.path),o.queryKey=ko(o,o.query),o}function bo(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function ko(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,s,o){s&&(t[s]=o)}),t}let tn=class Ie extends J{constructor(e,t={}){super(),this.writeBuffer=[],e&&typeof e=="object"&&(t=e,e=null),e?(e=St(e),t.hostname=e.host,t.secure=e.protocol==="https"||e.protocol==="wss",t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=St(t.host).host),gt(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=oo(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Kr,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new _o[e](n)}open(){let e;if(this.opts.rememberUpgrade&&Ie.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",t=>this.onClose("transport close",t))}probe(e){let t=this.createTransport(e),n=!1;Ie.priorWebsocketSuccess=!1;const s=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Ie.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function o(){n||(n=!0,h(),t.close(),t=null)}const i=u=>{const f=new Error("probe error: "+u);f.transport=t.name,o(),this.emitReserved("upgradeError",f)};function c(){i("transport closed")}function a(){i("socket closed")}function l(u){t&&u.name!==t.name&&o()}const h=()=>{t.removeListener("open",s),t.removeListener("error",i),t.removeListener("close",c),this.off("close",a),this.off("upgrading",l)};t.once("open",s),t.once("error",i),t.once("close",c),this.once("close",a),this.once("upgrading",l),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onOpen(){if(this.readyState="open",Ie.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const s=this.writeBuffer[n].data;if(s&&(t+=ro(s)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,s){if(typeof t=="function"&&(s=t,t=void 0),typeof n=="function"&&(s=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:t,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),s&&this.once("flush",s),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){Ie.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const s=e.length;for(;n<s;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}};tn.protocol=Kr;function Co(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=St(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(t&&t.port===n.port?"":":"+n.port),n}const wo=typeof ArrayBuffer=="function",xo=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,rn=Object.prototype.toString,So=typeof Blob=="function"||typeof Blob<"u"&&rn.call(Blob)==="[object BlobConstructor]",To=typeof File=="function"||typeof File<"u"&&rn.call(File)==="[object FileConstructor]";function qt(r){return wo&&(r instanceof ArrayBuffer||xo(r))||So&&r instanceof Blob||To&&r instanceof File}function st(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(st(r[t]))return!0;return!1}if(qt(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return st(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&st(r[t]))return!0;return!1}function Ro(r){const e=[],t=r.data,n=r;return n.data=Tt(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Tt(r,e){if(!r)return r;if(qt(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Tt(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Tt(r[n],e));return t}return r}function Eo(r,e){return r.data=Rt(r.data,e),delete r.attachments,r}function Rt(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=Rt(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=Rt(r[t],e));return r}const Po=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ao=5;var B;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(B||(B={}));class Io{constructor(e){this.replacer=e}encode(e){return(e.type===B.EVENT||e.type===B.ACK)&&st(e)?this.encodeAsBinary({type:e.type===B.EVENT?B.BINARY_EVENT:B.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===B.BINARY_EVENT||e.type===B.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Ro(e),n=this.encodeAsString(t.packet),s=t.buffers;return s.unshift(n),s}}function gr(r){return Object.prototype.toString.call(r)==="[object Object]"}class Wt extends J{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===B.BINARY_EVENT;n||t.type===B.BINARY_ACK?(t.type=n?B.EVENT:B.ACK,this.reconstructor=new Oo(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(qt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(B[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===B.BINARY_EVENT||n.type===B.BINARY_ACK){const o=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const i=e.substring(o,t);if(i!=Number(i)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(i)}if(e.charAt(t+1)==="/"){const o=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(o,t)}else n.nsp="/";const s=e.charAt(t+1);if(s!==""&&Number(s)==s){const o=t+1;for(;++t;){const i=e.charAt(t);if(i==null||Number(i)!=i){--t;break}if(t===e.length)break}n.id=Number(e.substring(o,t+1))}if(e.charAt(++t)){const o=this.tryParse(e.substr(t));if(Wt.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case B.CONNECT:return gr(t);case B.DISCONNECT:return t===void 0;case B.CONNECT_ERROR:return typeof t=="string"||gr(t);case B.EVENT:case B.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Po.indexOf(t[0])===-1);case B.ACK:case B.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Oo{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Eo(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Do=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Wt,Encoder:Io,get PacketType(){return B},protocol:Ao},Symbol.toStringTag,{value:"Module"}));function me(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Bo=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class nn extends J{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[me(e,"open",this.onopen.bind(this)),me(e,"packet",this.onpacket.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Bo.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const n={type:B.EVENT,data:t};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const i=this.ids++,c=t.pop();this._registerAckCallback(i,c),n.id=i}const s=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!s||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){var n;const s=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(s===void 0){this.acks[e]=t;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let i=0;i<this.sendBuffer.length;i++)this.sendBuffer[i].id===e&&this.sendBuffer.splice(i,1);t.call(this,new Error("operation has timed out"))},s);this.acks[e]=(...i)=>{this.io.clearTimeoutFn(o),t.apply(this,[null,...i])}}emitWithAck(e,...t){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((s,o)=>{t.push((i,c)=>n?i?o(i):s(c):s(i)),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((s,...o)=>n!==this._queue[0]?void 0:(s!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(s)):(this._queue.shift(),t&&t(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:B.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case B.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case B.EVENT:case B.BINARY_EVENT:this.onevent(e);break;case B.ACK:case B.BINARY_ACK:this.onack(e);break;case B.DISCONNECT:this.ondisconnect();break;case B.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...s){n||(n=!0,t.packet({type:B.ACK,id:e,data:s}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:B.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Be(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Be.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};Be.prototype.reset=function(){this.attempts=0};Be.prototype.setMin=function(r){this.ms=r};Be.prototype.setMax=function(r){this.max=r};Be.prototype.setJitter=function(r){this.jitter=r};class Et extends J{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,gt(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Be({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const s=t.parser||Do;this.encoder=new s.Encoder,this.decoder=new s.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new tn(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const s=me(t,"open",function(){n.onopen(),e&&e()}),o=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),e?e(c):this.maybeReconnectOnOpen()},i=me(t,"error",o);if(this._timeout!==!1){const c=this._timeout,a=this.setTimeoutFn(()=>{s(),o(new Error("timeout")),t.close()},c);this.opts.autoUnref&&a.unref(),this.subs.push(()=>{this.clearTimeoutFn(a)})}return this.subs.push(s),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(me(e,"ping",this.onping.bind(this)),me(e,"data",this.ondata.bind(this)),me(e,"error",this.onerror.bind(this)),me(e,"close",this.onclose.bind(this)),me(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){zt(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new nn(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(s=>{s?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",s)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Ne={};function qe(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=Co(r,e.path||"/socket.io"),n=t.source,s=t.id,o=t.path,i=Ne[s]&&o in Ne[s].nsps,c=e.forceNew||e["force new connection"]||e.multiplex===!1||i;let a;return c?a=new Et(n,e):(Ne[s]||(Ne[s]=new Et(n,e)),a=Ne[s]),t.query&&!e.query&&(e.query=t.queryKey),a.socket(t.path,e)}Object.assign(qe,{Manager:Et,Socket:nn,io:qe,connect:qe});let $o=class{constructor(){tr(this,"socket")}setupSocketConnection(){this.socket=qe("http://localhost:3000"),this.socket.emit("my message","Hello there from Vue."),this.socket.on("my broadcast",e=>{console.log(e)})}subscribeToMessages(e){if(!this.socket)return!0;this.socket.on("message",t=>(console.log("Room event received!"),e(null,t)))}sendMessage({message:e,roomName:t},n){this.socket&&this.socket.emit("message",{message:e,roomName:t},n)}disconnect(){this.socket&&this.socket.disconnect()}};const _r=new $o,No={data(){return{}},props:["action","to","from","toAction","comment"]},Mo={class:"flex flex-row pl-10 w-full bg-white"},jo={class:"w-1/4 flex flex-row justify-between"},Fo=d("div",null,":",-1),Lo={class:"w-3/4 ml-4"},Uo=d("br",null,null,-1),Ho={key:0,class:"flex flex-row pl-10 mt-1"},zo=d("div",{class:"w-1/4 flex flex-row justify-between"},[d("div",null,"Comment"),d("div",null,":")],-1),qo={class:"w-3/4 ml-4"},Wo={key:1,class:"flex flex-row pl-10 mt-1 bg-white"},Vo={class:"w-1/4 flex flex-row justify-between bg-white"},Go=d("div",null,":",-1),Jo={class:"w-3/4 ml-4"},Ko=d("br",null,null,-1);function Yo(r,e,t,n,s,o){return p(),m(k,null,[d("div",Mo,[d("div",jo,[d("div",null,g(t.action),1),Fo]),d("div",Lo,[y(g(t.from.empName)+", ",1),d("i",null,g(t.from.designation)+", "+g(t.from.unit),1),y(),Uo,d("i",null,[y("Extension:"),t.from.pabx?(p(),m(k,{key:0},[y(g(t.from.pabx)+",",1)],64)):(p(),m(k,{key:1},[y("N/A,")],64)),y(" Phone:"),t.from.phone?(p(),m(k,{key:2},[y(g(t.from.phone)+",",1)],64)):(p(),m(k,{key:3},[y("N/A,")],64)),y(" Email:"),t.from.email?(p(),m(k,{key:4},[y(g(t.from.email),1)],64)):(p(),m(k,{key:5},[y("N/A,")],64))])])]),t.comment?(p(),m("div",Ho,[zo,d("div",qo,g(t.comment),1)])):D("",!0),t.to?(p(),m("div",Wo,[d("div",Vo,[d("div",null,g(t.toAction),1),Go]),d("div",Jo,[y(g(t.to.empName)+", ",1),d("i",null,g(t.to.designation)+", "+g(t.to.unit),1),y(),Ko,d("i",null,[y("Extension:"),t.to.pabx?(p(),m(k,{key:0},[y(g(t.to.pabx)+",",1)],64)):(p(),m(k,{key:1},[y("N/A,")],64)),y(" Phone:"),t.to.phone?(p(),m(k,{key:2},[y(g(t.to.phone)+",",1)],64)):(p(),m(k,{key:3},[y("N/A,")],64)),y(" Email:"),t.to.email?(p(),m(k,{key:4},[y(g(t.to.mailAddress),1)],64)):(p(),m(k,{key:5},[y("N/A,")],64))])])])):D("",!0)],64)}const sn=pe(No,[["render",Yo]]),Xo={data(r){return{user:null}},created(){this.user=this.authStore.getUser},computed:{lastAction(){return this.ticket.actions[this.ticket.actions.length-1]}},props:["ticket"]},Qo={class:"flex flex-row flex-wrap justify-end items-end w-full pb-10"},Zo={key:0,class:"flex flex-row justify-end items-end flex-wrap"};function ei(r,e,t,n,s,o){return p(),m("div",Qo,[t.ticket.currentHandler.mailAddress==s.user.mailAddress||s.user.userType=="admin"?(p(),m("div",Zo,[(o.lastAction.type==0||o.lastAction.type==3||o.lastAction.type==1)&&t.ticket.currentHandler.mailAddress==t.ticket.ticketingHead.mailAddress?(p(),m(k,{key:0},[d("button",{class:"bg-green-500 w-auto text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[0]||(e[0]=i=>r.$emit("call","Ticket Assigned"))},"Assign"),d("button",{class:"bg-blue-500 w-auto text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[1]||(e[1]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-lime-500 w-auto text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[2]||(e[2]=i=>r.$emit("call","Ticket Accept"))},"Accept"),d("button",{class:"bg-red-500 w-auto text-white shadow-sm shadow-black font-bold mr-2 mt-2 p-2 rounded-sm",onClick:e[3]||(e[3]=i=>r.$emit("call","reject"))},"Reject"),d("button",{class:"bg-fuchsia-500 w-auto text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[4]||(e[4]=i=>r.$emit("call","Request For Higher Approval"))},"Request For Higher Approval")],64)):o.lastAction.type==2?(p(),m(k,{key:1},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[5]||(e[5]=i=>r.$emit("call","Higher Authority Approved"))},"Approve"),d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[6]||(e[6]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-red-500 text-white border border-solid b font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[7]||(e[7]=i=>r.$emit("call","reject"))},"Reject")],64)):o.lastAction.type==0&&t.ticket.supervisor&&t.ticket.currentHandler.mailAddress==t.ticket.supervisor.mailAddress?(p(),m(k,{key:2},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 border border-solid rounded-sm shadow-sm shadow-black",onClick:e[8]||(e[8]=i=>r.$emit("call","Supervisor Approved"))},"Approve"),d("button",{class:"bg-red-500 text-white border border-solid b font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[9]||(e[9]=i=>r.$emit("call","reject"))},"Reject")],64)):o.lastAction.type==5?(p(),m(k,{key:3},[d("button",{class:"bg-blue-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[10]||(e[10]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-fuchsia-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[11]||(e[11]=i=>r.$emit("call","Reassign"))},"Reassign"),d("button",{class:"bg-lime-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[12]||(e[12]=i=>r.$emit("call","Ticket Accept"))},"Accept"),d("button",{class:"bg-red-500 text-white shadow-sm shadow-black font-bold mr-2 mt-2 p-2 rounded-sm",onClick:e[13]||(e[13]=i=>r.$emit("call","reject"))},"Reject")],64)):o.lastAction.type==12?(p(),m(k,{key:4},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[14]||(e[14]=i=>r.$emit("call","Close Request"))},"Close Request"),d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[15]||(e[15]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-fuchsia-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[16]||(e[16]=i=>r.$emit("call","Reassign"))},"Reassign")],64)):(o.lastAction.type==4||o.lastAction.type==12||o.lastAction.type==7)&&t.ticket.accepted==!0?(p(),m(k,{key:5},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[17]||(e[17]=i=>r.$emit("call","Close Request"))},"Close Request"),d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[18]||(e[18]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-fuchsia-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[19]||(e[19]=i=>r.$emit("call","Reassign"))},"Reassign")],64)):o.lastAction.type==7&&t.ticket.accepted==!1&&t.ticket.currentHandler.mailAddress==t.ticket.ticketingHead.mailAddress?(p(),m(k,{key:6},[d("button",{class:"bg-green-500 text-white font-bold mr-2 drop-shadow-2xl shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[20]||(e[20]=i=>r.$emit("call","Ticket Assigned"))},"Assign"),d("button",{class:"bg-blue-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[21]||(e[21]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-lime-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[22]||(e[22]=i=>r.$emit("call","Ticket Accept"))},"Accept"),d("button",{class:"bg-red-500 text-white shadow-sm shadow-black font-bold mr-2 mt-2 p-2 rounded-sm",onClick:e[23]||(e[23]=i=>r.$emit("call","reject"))},"Reject"),d("button",{class:"bg-fuchsia-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[24]||(e[24]=i=>r.$emit("call","Request For Higher Approval"))},"Request For Higher Approval")],64)):o.lastAction.type==7&&t.ticket.accepted==!1&&t.ticket.assignedTo&&t.ticket.currentHandler.mailAddress==t.ticket.assignedTo.mailAddress?(p(),m(k,{key:7},[d("button",{class:"bg-blue-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[25]||(e[25]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-fuchsia-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[26]||(e[26]=i=>r.$emit("call","Reassign"))},"Reassign"),d("button",{class:"bg-lime-500 text-white font-bold mr-2 shadow-sm shadow-black mt-2 p-2 rounded-sm",onClick:e[27]||(e[27]=i=>r.$emit("call","Ticket Accept"))},"Accept"),d("button",{class:"bg-red-500 text-white shadow-sm shadow-black font-bold mr-2 mt-2 p-2 rounded-sm",onClick:e[28]||(e[28]=i=>r.$emit("call","reject"))},"Reject")],64)):o.lastAction.type==7&&t.ticket.accepted==!1&&t.ticket.higherApprover&&t.ticket.currentHandler.mailAddress==t.ticket.higherApprover.mailAddress?(p(),m(k,{key:8},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[29]||(e[29]=i=>r.$emit("call","Higher Authority Approved"))},"Approve"),d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[30]||(e[30]=i=>r.$emit("call","Asking For Information"))},"Ask For Info"),d("button",{class:"bg-red-500 text-white border border-solid b font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[31]||(e[31]=i=>r.$emit("call","reject"))},"Reject")],64)):o.lastAction.type==10?(p(),m(k,{key:9},[d("button",{class:"bg-green-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[32]||(e[32]=i=>r.$emit("call","Close Request Accepted"))},"Accept"),d("button",{class:"bg-red-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[33]||(e[33]=i=>r.$emit("call","Close Request Rejected"))},"Reject")],64)):o.lastAction.type==6?(p(),m("button",{key:10,class:"bg-green-500 text-white font-bold mr-40 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[34]||(e[34]=i=>r.$emit("call","Giving Information"))},"Give Info")):D("",!0)])):D("",!0),d("button",{class:"bg-amber-500 text-white font-bold mr-2 mt-2 p-2 rounded-sm shadow-sm shadow-black",onClick:e[35]||(e[35]=i=>r.$emit("showDetails"))},"Show Details")])}const on=pe(Xo,[["render",ei]]);var an={exports:{}};(function(r){r.exports=function(e){var t={};function n(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(s,o,i){n.o(s,o)||Object.defineProperty(s,o,{enumerable:!0,get:i})},n.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,o){if(o&1&&(s=n(s)),o&8||o&4&&typeof s=="object"&&s&&s.__esModule)return s;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:s}),o&2&&typeof s!="string")for(var c in s)n.d(i,c,function(a){return s[a]}.bind(null,c));return i},n.n=function(s){var o=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(o,"a",o),o},n.o=function(s,o){return Object.prototype.hasOwnProperty.call(s,o)},n.p="",n(n.s="fb15")}({"0a04":function(e,t,n){var s=n("4bad");t=s(!1),t.push([e.i,".vue-star-rating-star[data-v-f675a548]{display:inline-block;-webkit-tap-highlight-color:rgba(0,0,0,0);-webkit-tap-highlight-color:transparent}.vue-star-rating-pointer[data-v-f675a548]{cursor:pointer}.vue-star-rating[data-v-f675a548]{display:flex;align-items:center}.vue-star-rating-inline[data-v-f675a548]{display:inline-flex}.vue-star-rating-rating-text[data-v-f675a548]{margin-left:7px}.vue-star-rating-rtl[data-v-f675a548]{direction:rtl}.vue-star-rating-rtl .vue-star-rating-rating-text[data-v-f675a548]{margin-right:10px;direction:rtl}.sr-only[data-v-f675a548]{position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden}",""]),e.exports=t},"0fde":function(e,t,n){var s=n("4bad");t=s(!1),t.push([e.i,".vue-star-rating-star[data-v-11edf2d6]{overflow:visible!important}.vue-star-rating-star-rotate[data-v-11edf2d6]{transition:all .25s}.vue-star-rating-star-rotate[data-v-11edf2d6]:hover{transition:transform .25s;transform:rotate(-15deg) scale(1.3)}",""]),e.exports=t},"499e":function(e,t,n){n.r(t),n.d(t,"default",function(){return x});function s(T,S){for(var C=[],$={},w=0;w<S.length;w++){var I=S[w],N=I[0],ie=I[1],V=I[2],Se=I[3],ce={id:T+":"+w,css:ie,media:V,sourceMap:Se};$[N]?$[N].parts.push(ce):C.push($[N]={id:N,parts:[ce]})}return C}var o=typeof document<"u";if(typeof DEBUG<"u"&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},c=o&&(document.head||document.getElementsByTagName("head")[0]),a=null,l=0,h=!1,u=function(){},f=null,b="data-vue-ssr-id",_=typeof navigator<"u"&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function x(T,S,C,$){h=C,f=$||{};var w=s(T,S);return M(w),function(N){for(var ie=[],V=0;V<w.length;V++){var Se=w[V],ce=i[Se.id];ce.refs--,ie.push(ce)}N?(w=s(T,N),M(w)):w=[];for(var V=0;V<ie.length;V++){var ce=ie[V];if(ce.refs===0){for(var ke=0;ke<ce.parts.length;ke++)ce.parts[ke]();delete i[ce.id]}}}}function M(T){for(var S=0;S<T.length;S++){var C=T[S],$=i[C.id];if($){$.refs++;for(var w=0;w<$.parts.length;w++)$.parts[w](C.parts[w]);for(;w<C.parts.length;w++)$.parts.push(E(C.parts[w]));$.parts.length>C.parts.length&&($.parts.length=C.parts.length)}else{for(var I=[],w=0;w<C.parts.length;w++)I.push(E(C.parts[w]));i[C.id]={id:C.id,refs:1,parts:I}}}}function A(){var T=document.createElement("style");return T.type="text/css",c.appendChild(T),T}function E(T){var S,C,$=document.querySelector("style["+b+'~="'+T.id+'"]');if($){if(h)return u;$.parentNode.removeChild($)}if(_){var w=l++;$=a||(a=A()),S=U.bind(null,$,w,!1),C=U.bind(null,$,w,!0)}else $=A(),S=P.bind(null,$),C=function(){$.parentNode.removeChild($)};return S(T),function(N){if(N){if(N.css===T.css&&N.media===T.media&&N.sourceMap===T.sourceMap)return;S(T=N)}else C()}}var L=function(){var T=[];return function(S,C){return T[S]=C,T.filter(Boolean).join(`
`)}}();function U(T,S,C,$){var w=C?"":$.css;if(T.styleSheet)T.styleSheet.cssText=L(S,w);else{var I=document.createTextNode(w),N=T.childNodes;N[S]&&T.removeChild(N[S]),N.length?T.insertBefore(I,N[S]):T.appendChild(I)}}function P(T,S){var C=S.css,$=S.media,w=S.sourceMap;if($&&T.setAttribute("media",$),f.ssrId&&T.setAttribute(b,S.id),w&&(C+=`
/*# sourceURL=`+w.sources[0]+" */",C+=`
/*# sourceMappingURL=data:application/json;base64,`+btoa(unescape(encodeURIComponent(JSON.stringify(w))))+" */"),T.styleSheet)T.styleSheet.cssText=C;else{for(;T.firstChild;)T.removeChild(T.firstChild);T.appendChild(document.createTextNode(C))}}},"4bad":function(e,t,n){e.exports=function(i){var c=[];return c.toString=function(){return this.map(function(l){var h=s(l,i);return l[2]?"@media ".concat(l[2]," {").concat(h,"}"):h}).join("")},c.i=function(a,l,h){typeof a=="string"&&(a=[[null,a,""]]);var u={};if(h)for(var f=0;f<this.length;f++){var b=this[f][0];b!=null&&(u[b]=!0)}for(var _=0;_<a.length;_++){var x=[].concat(a[_]);h&&u[x[0]]||(l&&(x[2]?x[2]="".concat(l," and ").concat(x[2]):x[2]=l),c.push(x))}},c};function s(i,c){var a=i[1]||"",l=i[3];if(!l)return a;if(c&&typeof btoa=="function"){var h=o(l),u=l.sources.map(function(f){return"/*# sourceURL=".concat(l.sourceRoot||"").concat(f," */")});return[a].concat(u).concat([h]).join(`
`)}return[a].join(`
`)}function o(i){var c=btoa(unescape(encodeURIComponent(JSON.stringify(i)))),a="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(c);return"/*# ".concat(a," */")}},"5bef":function(e,t,n){var s=n("0fde");typeof s=="string"&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=n("499e").default;o("f426be92",s,!0,{sourceMap:!1,shadowMode:!1})},8875:function(e,t,n){var s,o,i;(function(c,a){o=[],s=a,i=typeof s=="function"?s.apply(t,o):s,i!==void 0&&(e.exports=i)})(typeof self<"u"?self:this,function(){function c(){var a=Object.getOwnPropertyDescriptor(document,"currentScript");if(!a&&"currentScript"in document&&document.currentScript||a&&a.get!==c&&document.currentScript)return document.currentScript;try{throw new Error}catch(U){var l=/.*at [^(]*\((.*):(.+):(.+)\)$/ig,h=/@([^@]*):(\d+):(\d+)\s*$/ig,u=l.exec(U.stack)||h.exec(U.stack),f=u&&u[1]||!1,b=u&&u[2]||!1,_=document.location.href.replace(document.location.hash,""),x,M,A,E=document.getElementsByTagName("script");f===_&&(x=document.documentElement.outerHTML,M=new RegExp("(?:[^\\n]+?\\n){0,"+(b-2)+"}[^<]*<script>([\\d\\D]*?)<\\/script>[\\d\\D]*","i"),A=x.replace(M,"$1").trim());for(var L=0;L<E.length;L++)if(E[L].readyState==="interactive"||E[L].src===f||f===_&&E[L].innerHTML&&E[L].innerHTML.trim()===A)return E[L];return null}}return c})},"8bbf":function(e,t){e.exports=as},"9ff5":function(e,t,n){n("eed3")},d1b1:function(e,t,n){n("5bef")},d4aa:function(e,t){class n{constructor(o){this.color=o}parseAlphaColor(){return/^rgba\((\d{1,3}%?\s*,\s*){3}(\d*(?:\.\d+)?)\)$/.test(this.color)?this.parseRgba():/^hsla\(\d+\s*,\s*([\d.]+%\s*,\s*){2}(\d*(?:\.\d+)?)\)$/.test(this.color)?this.parseHsla():/^#([0-9A-Fa-f]{4}|[0-9A-Fa-f]{8})$/.test(this.color)?this.parseAlphaHex():/^transparent$/.test(this.color)?this.parseTransparent():{color:this.color,opacity:"1"}}parseRgba(){return{color:this.color.replace(/,(?!.*,).*(?=\))|a/g,""),opacity:this.color.match(/\.\d+|[01](?=\))/)[0]}}parseHsla(){return{color:this.color.replace(/,(?!.*,).*(?=\))|a/g,""),opacity:this.color.match(/\.\d+|[01](?=\))/)[0]}}parseAlphaHex(){return{color:this.color.length===5?this.color.substring(0,4):this.color.substring(0,7),opacity:this.color.length===5?(parseInt(this.color.substring(4,5)+this.color.substring(4,5),16)/255).toFixed(2):(parseInt(this.color.substring(7,9),16)/255).toFixed(2)}}parseTransparent(){return{color:"#fff",opacity:0}}}e.exports=n},eed3:function(e,t,n){var s=n("0a04");typeof s=="string"&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var o=n("499e").default;o("87bea518",s,!0,{sourceMap:!1,shadowMode:!1})},fb15:function(e,t,n){if(n.r(t),typeof window<"u"){var s=window.document.currentScript;{var o=n("8875");s=o(),"currentScript"in document||Object.defineProperty(document,"currentScript",{get:o})}var i=s&&s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);i&&(n.p=i[1])}var c=n("8bbf");const a=Object(c.withScopeId)("data-v-f675a548");Object(c.pushScopeId)("data-v-f675a548");const l={class:"sr-only"};Object(c.popScopeId)();const h=a(function(T,S,C,$,w,I){const N=Object(c.resolveComponent)("star");return Object(c.openBlock)(),Object(c.createBlock)("div",{class:["vue-star-rating",{"vue-star-rating-rtl":C.rtl},{"vue-star-rating-inline":C.inline}]},[Object(c.createVNode)("div",l,[Object(c.renderSlot)(T.$slots,"screen-reader",{rating:w.selectedRating,stars:C.maxRating},()=>[Object(c.createVNode)("span",null,"Rated "+Object(c.toDisplayString)(w.selectedRating)+" stars out of "+Object(c.toDisplayString)(C.maxRating),1)])]),Object(c.createVNode)("div",{class:"vue-star-rating",onMouseleave:S[2]||(S[2]=(...ie)=>I.resetRating(...ie))},[(Object(c.openBlock)(!0),Object(c.createBlock)(c.Fragment,null,Object(c.renderList)(C.maxRating,ie=>(Object(c.openBlock)(),Object(c.createBlock)("span",{key:ie,class:[{"vue-star-rating-pointer":!C.readOnly},"vue-star-rating-star"],style:{"margin-right":I.margin+"px"}},[Object(c.createVNode)(N,{fill:w.fillLevel[ie-1],size:C.starSize,points:C.starPoints,"star-id":ie,step:w.step,"active-color":I.currentActiveColor,"inactive-color":C.inactiveColor,"border-color":C.borderColor,"active-border-color":I.currentActiveBorderColor,"border-width":C.borderWidth,"rounded-corners":C.roundedCorners,rtl:C.rtl,glow:C.glow,"glow-color":C.glowColor,animate:C.animate,"onStar-selected":S[1]||(S[1]=V=>I.setRating(V,!0)),"onStar-mouse-move":I.setRating},null,8,["fill","size","points","star-id","step","active-color","inactive-color","border-color","active-border-color","border-width","rounded-corners","rtl","glow","glow-color","animate","onStar-mouse-move"])],6))),128)),C.showRating?(Object(c.openBlock)(),Object(c.createBlock)("span",{key:0,class:["vue-star-rating-rating-text",C.textClass]},Object(c.toDisplayString)(I.formattedRating),3)):Object(c.createCommentVNode)("",!0)],32)],2)}),u=Object(c.withScopeId)("data-v-11edf2d6");Object(c.pushScopeId)("data-v-11edf2d6");const f=Object(c.createVNode)("feMerge",null,[Object(c.createVNode)("feMergeNode",{in:"coloredBlur"}),Object(c.createVNode)("feMergeNode",{in:"SourceGraphic"})],-1);Object(c.popScopeId)();const b=u(function(T,S,C,$,w,I){return Object(c.openBlock)(),Object(c.createBlock)("svg",{class:["vue-star-rating-star",{"vue-star-rating-star-rotate":I.shouldAnimate}],height:I.starSize,width:I.starSize,viewBox:I.viewBox,onMousemove:S[1]||(S[1]=(...N)=>I.mouseMoving(...N)),onClick:S[2]||(S[2]=(...N)=>I.selected(...N)),onTouchstart:S[3]||(S[3]=(...N)=>I.touchStart(...N)),onTouchend:S[4]||(S[4]=(...N)=>I.touchEnd(...N))},[Object(c.createVNode)("linearGradient",{id:w.grad,x1:"0",x2:"100%",y1:"0",y2:"0"},[Object(c.createVNode)("stop",{offset:I.starFill,"stop-color":C.rtl?I.getColor(C.inactiveColor):I.getColor(C.activeColor),"stop-opacity":C.rtl?I.getOpacity(C.inactiveColor):I.getOpacity(C.activeColor)},null,8,["offset","stop-color","stop-opacity"]),Object(c.createVNode)("stop",{offset:I.starFill,"stop-color":C.rtl?I.getColor(C.activeColor):I.getColor(C.inactiveColor),"stop-opacity":C.rtl?I.getOpacity(C.activeColor):I.getOpacity(C.inactiveColor)},null,8,["offset","stop-color","stop-opacity"])],8,["id"]),Object(c.createVNode)("filter",{id:w.glowId,height:"130%",width:"130%",filterUnits:"userSpaceOnUse"},[Object(c.createVNode)("feGaussianBlur",{stdDeviation:C.glow,result:"coloredBlur"},null,8,["stdDeviation"]),f],8,["id"]),Object(c.withDirectives)(Object(c.createVNode)("polygon",{points:I.starPointsToString,fill:I.gradId,stroke:C.glowColor,filter:"url(#"+w.glowId+")","stroke-width":I.border},null,8,["points","fill","stroke","filter","stroke-width"]),[[c.vShow,C.glowColor&&C.glow>0&&C.fill>0]]),Object(c.createVNode)("polygon",{points:I.starPointsToString,fill:I.gradId,stroke:I.getBorderColor,"stroke-width":I.border,"stroke-linejoin":I.strokeLinejoin},null,8,["points","fill","stroke","stroke-width","stroke-linejoin"]),Object(c.createVNode)("polygon",{points:I.starPointsToString,fill:I.gradId},null,8,["points","fill"])],42,["height","width","viewBox"])});var _=n("d4aa"),x=n.n(_),M={name:"Star",props:{fill:{type:Number,default:0},points:{type:Array,default(){return[]}},size:{type:Number,default:50},starId:{type:Number,required:!0},activeColor:{type:String,required:!0},inactiveColor:{type:String,required:!0},borderColor:{type:String,default:"#000"},activeBorderColor:{type:String,default:"#000"},borderWidth:{type:Number,default:0},roundedCorners:{type:Boolean,default:!1},rtl:{type:Boolean,default:!1},glow:{type:Number,default:0},glowColor:{type:String,default:null,required:!1},animate:{type:Boolean,default:!1}},emits:["star-mouse-move","star-selected"],data(){return{starPoints:[19.8,2.2,6.6,43.56,39.6,17.16,0,17.16,33,43.56],grad:"",glowId:"",isStarActive:!0}},computed:{starPointsToString(){return this.starPoints.join(",")},gradId(){return"url(#"+this.grad+")"},starSize(){const P=this.roundedCorners&&this.borderWidth<=0?parseInt(this.size)-parseInt(this.border):this.size;return parseInt(P)+parseInt(this.border)},starFill(){return this.rtl?100-this.fill+"%":this.fill+"%"},border(){return this.roundedCorners&&this.borderWidth<=0?6:this.borderWidth},getBorderColor(){return this.roundedCorners&&this.borderWidth<=0?this.fill<=0?this.inactiveColor:this.activeColor:this.fill<=0?this.borderColor:this.activeBorderColor},maxSize(){return this.starPoints.reduce(function(P,T){return Math.max(P,T)})},viewBox(){return"0 0 "+this.maxSize+" "+this.maxSize},shouldAnimate(){return this.animate&&this.isStarActive},strokeLinejoin(){return this.roundedCorners?"round":"miter"}},created(){this.starPoints=this.points.length?this.points:this.starPoints,this.calculatePoints(),this.grad=this.getRandomId(),this.glowId=this.getRandomId()},methods:{mouseMoving(P){P.touchAction!=="undefined"&&this.$emit("star-mouse-move",{event:P,position:this.getPosition(P),id:this.starId})},touchStart(){this.$nextTick(()=>{this.isStarActive=!0})},touchEnd(){this.$nextTick(()=>{this.isStarActive=!1})},getPosition(P){var T=.92*this.size;const S=this.rtl?Math.min(P.offsetX,45):Math.max(P.offsetX,1);var C=Math.round(100/T*S);return Math.min(C,100)},selected(P){this.$emit("star-selected",{id:this.starId,position:this.getPosition(P)})},getRandomId(){return Math.random().toString(36).substring(7)},calculatePoints(){this.starPoints=this.starPoints.map((P,T)=>{const S=T%2===0?this.border*1.5:0;return this.size/this.maxSize*P+S})},getColor(P){return new x.a(P).parseAlphaColor().color},getOpacity(P){return new x.a(P).parseAlphaColor().opacity}}};n("d1b1"),M.render=b,M.__scopeId="data-v-11edf2d6";var A=M,E={name:"VueStarRating",components:{Star:A},props:{increment:{type:Number,default:1},rating:{type:Number,default:0},roundStartRating:{type:Boolean,default:!0},activeColor:{type:[String,Array],default:"#ffd055"},inactiveColor:{type:String,default:"#d8d8d8"},maxRating:{type:Number,default:5},starPoints:{type:Array,default(){return[]}},starSize:{type:Number,default:50},showRating:{type:Boolean,default:!0},readOnly:{type:Boolean,default:!1},textClass:{type:String,default:""},inline:{type:Boolean,default:!1},borderColor:{type:String,default:"#999"},activeBorderColor:{type:[String,Array],default:null},borderWidth:{type:Number,default:0},roundedCorners:{type:Boolean,default:!1},padding:{type:Number,default:0},rtl:{type:Boolean,default:!1},fixedPoints:{type:Number,default:null},glow:{type:Number,default:0},glowColor:{type:String,default:"#fff"},clearable:{type:Boolean,default:!1},activeOnClick:{type:Boolean,default:!1},animate:{type:Boolean,default:!1}},emits:["update:rating","hover:rating"],data(){return{step:0,fillLevel:[],currentRating:0,selectedRating:0,ratingSelected:!1}},computed:{formattedRating(){return this.fixedPoints===null?this.currentRating:this.currentRating.toFixed(this.fixedPoints)},shouldRound(){return this.ratingSelected||this.roundStartRating},margin(){return this.padding+this.borderWidth},activeColors(){return Array.isArray(this.activeColor)?this.padColors(this.activeColor,this.maxRating,this.activeColor.slice(-1)[0]):new Array(this.maxRating).fill(this.activeColor)},currentActiveColor(){return this.activeOnClick?this.selectedRating>0?this.activeColors[Math.ceil(this.selectedRating)-1]:this.inactiveColor:this.currentRating>0?this.activeColors[Math.ceil(this.currentRating)-1]:this.inactiveColor},activeBorderColors(){if(Array.isArray(this.activeBorderColor))return this.padColors(this.activeBorderColor,this.maxRating,this.activeBorderColor.slice(-1)[0]);let P=this.activeBorderColor?this.activeBorderColor:this.borderColor;return new Array(this.maxRating).fill(P)},currentActiveBorderColor(){return this.activeOnClick?this.selectedRating>0?this.activeBorderColors[Math.ceil(this.selectedRating)-1]:this.borderColor:this.currentRating>0?this.activeBorderColors[Math.ceil(this.currentRating)-1]:this.borderColor}},watch:{rating(P){this.currentRating=P,this.selectedRating=P,this.createStars(this.shouldRound)}},created(){this.step=this.increment*100,this.currentRating=this.rating,this.selectedRating=this.currentRating,this.createStars(this.roundStartRating)},methods:{setRating(P,T){if(!this.readOnly){const S=this.rtl?(100-P.position)/100:P.position/100;this.currentRating=(P.id+S-1).toFixed(2),this.currentRating=this.currentRating>this.maxRating?this.maxRating:this.currentRating,T?(this.createStars(!0,!0),this.clearable&&this.currentRating===this.selectedRating?this.selectedRating=0:this.selectedRating=this.currentRating,this.$emit("update:rating",this.selectedRating),this.ratingSelected=!0):(this.createStars(!0,!this.activeOnClick),this.$emit("hover:rating",this.currentRating))}},resetRating(){this.readOnly||(this.currentRating=this.selectedRating,this.createStars(this.shouldRound))},createStars(P=!0,T=!0){P&&this.round();for(var S=0;S<this.maxRating;S++){let C=0;S<this.currentRating&&(C=this.currentRating-S>1?100:(this.currentRating-S)*100),T&&(this.fillLevel[S]=Math.round(C))}},round(){var P=1/this.increment;this.currentRating=Math.min(this.maxRating,Math.ceil(this.currentRating*P)/P)},padColors(P,T,S){return Object.assign(new Array(T).fill(S),P)}}};n("9ff5"),E.render=h,E.__scopeId="data-v-f675a548";var L=E,U=L;t.default=U}})})(an);var ti=an.exports;const cn=ut(ti),ri={data(r){return{modalCheck:!1,comment:"",files:[],value:"",users:[],support:[],filesCheck:!1}},components:{StarRating:cn},props:["ticket"],computed:{computedUsers(){var r=this.users.map(e=>`${e.empName} --- ${e.mailAddress} (${e.designation})`);return r}},created(){this.getApprovers(),this.getSupport()},updated(){console.log("from the updated method");var r=document.getElementById("modal");this.modalCheck&&(console.log("entered gsap function"),this.$gsap.set(r,{top:100,visibility:"visible"}),this.modalCheck=!0)},methods:{setRating(r){this.$emit("rating",r)},commentBox(r){this.value=r;const e=this.$refs.modal;this.modalCheck==!1?(this.$gsap.to(e,{top:100}),this.modalCheck=!0):this.modalCheck==!0&&(this.$gsap.to(e,{top:-300}),this.modalCheck=!1)},handleFileChange(r){var e=this;this.$emit("fileChange",r.target.files);for(var t of r.target.files)e.files.push(t);this.filesCheck=!0},removeFile(r){this.$emit("removeFile",r),this.files.splice(r,1)},handleCommentChange(r){this.$emit("commentChange",r.target.value)},handleInfoChange(r){this.$emit("infoChange",r.target.value)},handleApproverChange(r){console.log("this is the event"),console.log(r);var e=r;console.log("this is the splitted value");var t=e.split("---")[1].split("(")[0].trim();console.log(t);var n=this.users.find(s=>s.mailAddress==t);console.log("this is the user"),console.log(n),this.$emit("approverChange",n)},getApprovers(){var r=this,e=this.authStore.getToken,t={token:e};q.post(r.globalUrl+"getUsers",t).then(function(n){r.users=n.data.filter(s=>s.userType=="normal"||s.userType=="leader"||s.userType=="support"),console.log(n.data)}).catch(function(n){console.log(n)})},getSupport(){var r=this,e=this.authStore.getToken,t=this.authStore.getUser,n=this.ticket,s=new FormData;s.append("token",e),s.append("user",JSON.stringify(t)),s.append("ticket",JSON.stringify(n)),console.log("from get support"),console.log(n),q.post(r.globalUrl+"getSupport",s).then(o=>{r.support=o.data.map(i=>`${i.user.empName} --- ${i.user.mailAddress} (${i.user.designation})`),console.log("this is the support"),console.log(o.data)}).catch(o=>r.$toast.warning(o))}}},ni={class:"w-2/4 h-auto bg-white flex flex-col rounded-md p-5 pt-10 border border-solid border-black",style:{left:"350px",top:"-200px","z-index":"4000",transition:"0.5s smooth",position:"fixed"},ref:"modal",id:"modal"},si={key:0,class:"flex flex-row w-full h-full"},oi=d("div",{class:"w-1/6 font-bold text-center"}," Comment: ",-1),ii={class:"w-5/6"},ai={key:1,class:"flex flex-col w-full h-full"},ci={class:"flex flex-col justify-center items-center w-full mb-5"},li=d("div",{class:"w-full font-bold text-center"}," Please Rate Your Handler: ",-1),di={class:"w-full flex flex-row justify-center items-center"},hi={class:"flex flex-row w-full mt-4"},ui=d("div",{class:"w-1/6 font-bold text-center"}," Comment: ",-1),fi={class:"w-5/6"},pi={key:2,class:"flex flex-col w-full h-full"},mi={class:"flex flex-row w-full h-full mb-2"},gi=d("div",{class:"w-1/6 font-bold text-center"}," Approver: ",-1),_i={class:"w-5/6 border-2 border-solid border-slate-300"},vi={class:"flex flex-row w-full h-full"},yi=d("div",{class:"w-1/6 font-bold text-center"}," Comment: ",-1),bi={class:"w-5/6"},ki={key:3,class:"flex flex-col w-full h-full"},Ci={class:"flex flex-row w-full h-full mt-2 mb-2"},wi=d("div",{class:"w-1/6 font-bold text-center"}," Assign To: ",-1),xi={class:"w-5/6 border-2 border-solid border-slate-300"},Si={class:"flex flex-row w-full h-full"},Ti=d("div",{class:"w-1/6 text-center font-bold"}," Comment: ",-1),Ri={class:"w-5/6"},Ei={key:4,class:"flex flex-col w-full h-full"},Pi={class:"flex flex-row w-full h-full mt-2 mb-2"},Ai=d("div",{class:"w-1/6 font-bold text-center"}," Assign To: ",-1),Ii={class:"w-5/6 border-2 border-solid border-slate-300"},Oi={class:"flex flex-row w-full h-full"},Di=d("div",{class:"w-1/6 text-center font-bold"}," Comment: ",-1),Bi={class:"w-5/6"},$i={key:5,class:"flex flex-col w-full h-full"},Ni={class:"flex flex-row w-full h-full"},Mi=d("div",{class:"w-1/6 text-center font-bold"}," Comment: ",-1),ji={class:"w-5/6"},Fi={key:6,class:"flex flex-col w-full h-full"},Li={class:"flex flex-row mt-2 mb-2"},Ui=d("div",{class:"w-1/6 font-bold text-center"}," Extra Files: ",-1),Hi={class:"w-5/6"},zi={class:"w-1/2"},qi={class:"w-1/2"},Wi={class:"flex flex-row"},Vi=d("div",{class:"w-1/6 font-bold text-center mt-2"}," Comment: ",-1),Gi={class:"w-5/6"},Ji={class:"flex flex-row w-full h-full justify-end"};function Ki(r,e,t,n,s,o){const i=ne("StarRating"),c=ne("vss"),a=ne("font-awesome-icon");return p(),m("div",ni,[s.value=="Supervisor Approved"||s.value=="Higher Authority Approved"||s.value=="Close Request Rejected"||s.value=="Asking For Information"||s.value=="reject"?(p(),m("div",si,[oi,d("div",ii,[d("textarea",{class:"border-2 border-solid w-full border-slate-300 p-3",onChange:e[0]||(e[0]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])):s.value=="Close Request Accepted"?(p(),m("div",ai,[d("div",ci,[li,d("div",di,[Z(i,{"onUpdate:rating":o.setRating,"max-rating":10,"show-rating":!0,"active-on-click":!0,"star-size":30},null,8,["onUpdate:rating"])])]),d("div",hi,[ui,d("div",fi,[d("textarea",{class:"border-2 border-solid w-full border-slate-300 p-3",onChange:e[1]||(e[1]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):s.value=="Request For Higher Approval"?(p(),m("div",pi,[d("div",mi,[gi,d("div",_i,[Z(c,{searchable:"true",options:o.computedUsers,onChange:o.handleApproverChange},null,8,["options","onChange"])])]),d("div",vi,[yi,d("div",bi,[d("textarea",{class:"border-2 border-solid border-slate-300 w-full p-2",onChange:e[2]||(e[2]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):s.value=="Ticket Assigned"?(p(),m("div",ki,[d("div",Ci,[wi,d("div",xi,[Z(c,{searchable:"true",options:s.support,onChange:o.handleApproverChange},null,8,["options","onChange"])])]),d("div",Si,[Ti,d("div",Ri,[d("textarea",{class:"border-2 border-solid border-slate-300 w-full p-2",onChange:e[3]||(e[3]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):s.value=="Reassign"?(p(),m("div",Ei,[d("div",Pi,[Ai,d("div",Ii,[Z(c,{searchable:"true",options:s.support,onChange:o.handleApproverChange},null,8,["options","onChange"])])]),d("div",Oi,[Di,d("div",Bi,[d("textarea",{class:"border-2 border-solid border-slate-300 w-full p-2",onChange:e[4]||(e[4]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):s.value=="Ticket Accept"?(p(),m("div",$i,[d("div",Ni,[Mi,d("div",ji,[d("textarea",{class:"border-2 border-solid border-slate-300 w-full p-2",onChange:e[5]||(e[5]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):s.value=="Giving Information"||s.value=="Close Request"?(p(),m("div",Fi,[d("div",Li,[Ui,d("div",Hi,[d("input",{type:"file",onChange:e[6]||(e[6]=(...l)=>o.handleFileChange&&o.handleFileChange(...l)),multiple:""},null,32),(p(!0),m(k,null,W(s.files,(l,h)=>(p(),m("div",{key:h,class:"flex-row flex mt-1 w-full"},[d("div",zi,g(l.name),1),d("div",qi,[Z(a,{icon:"fa-solid fa-circle-minus",class:"ml-4 hover:cursor-pointer",onClick:u=>o.removeFile(h)},null,8,["onClick"])])]))),128))])]),d("div",Wi,[Vi,d("div",Gi,[d("textarea",{class:"border-2 border-solid border-slate-300 w-full",onChange:e[7]||(e[7]=(...l)=>o.handleCommentChange&&o.handleCommentChange(...l))},null,32)])])])):D("",!0),d("div",Ji,[d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-10 p-2 border border-solid rounded-sm",onClick:e[8]||(e[8]=l=>r.$emit("modalCall",s.value))},"Proceed"),d("button",{class:"bg-slate-300 text-black border border-solid b font-bold mr-2 mt-10 p-2 rounded-sm",onClick:e[9]||(e[9]=l=>r.$emit("cancel"))},"Cancel")])],512)}const ln=pe(ri,[["render",Ki]]);var dn={data(){return{files:[]}},methods:{setFile(r){for(var e of r.target.files)this.files.push(e)},removeFile(r){this.files.splice(r,1)},supervisorApprove(o,e){var t=this;this.$toast.info("Approving...");var n=this.authStore.getUser,s=this.authStore.getToken,o=o,i=new FormData;i.append("user",JSON.stringify(n)),i.append("token",s),i.append("comment",o),i.append("ticket",JSON.stringify(e)),q.post(t.globalUrl+"supervisorApprove",i).then(c=>{c.data==!0?(t.$toast.clear(),t.$toast.success("Approved"),this.$router.push("/ticketing/myTickets")):(t.$toast.clear(),t.$toast.warning(c.data))}).catch(c=>{t.$toast.clear(),t.$toast.warning(c)})},higherApprove(o,e){var t=this;this.$toast.info("Approving...");var n=this.authStore.getUser,s=this.authStore.getToken,o=o,i=new FormData;i.append("user",JSON.stringify(n)),i.append("token",s),i.append("ticket",JSON.stringify(e)),i.append("comment",o),q.post(t.globalUrl+"higherApprove",i).then(c=>{c.data==!0?(t.$toast.clear(),t.$toast.success("Approved"),this.$router.push("/ticketing/myTickets")):(t.$toast.clear(),t.$toast.warning(c.data))}).catch(c=>{t.$toast.clear(),t.$toast.warning(c)})},assignTicket(i,e,a){console.log("from assign ticket");var n=this;this.$toast.info("Assigning Ticket...");var s=this.authStore.getUser,o=this.authStore.getToken,i=i,c=new FormData,a=a;c.append("token",o),c.append("user",JSON.stringify(s)),c.append("comment",i),c.append("ticket",JSON.stringify(a)),c.append("approver",JSON.stringify(e)),q.post(n.globalUrl+"assign",c).then(l=>{l.data==!0?(n.$toast.clear(),n.$toast.success("Done"),this.$router.push("/ticketing/myTickets")):(n.$toast.clear(),n.$toast.warning(l.data))}).catch(l=>{n.$toast.clear(),n.$toast.warning(l)})},closeRequest(c,e,t,n){var s=this;this.$toast.info("Requesting...");var o=this.authStore.getUser,i=this.authStore.getToken,c=c,a=new FormData;for(var l of e)a.append("file",l);a.append("additionalInfo",n),a.append("user",JSON.stringify(o)),a.append("token",i),a.append("comment",c),a.append("ticket",JSON.stringify(t)),console.log("this is the value from the close ticket"),console.log(c),q.post(s.globalUrl+"closeRequest",a).then(h=>{h.data==!0?(s.$toast.clear(),s.$toast.success("Request Sent"),this.$router.push("/ticketing/myTickets")):(s.$toast.clear(),s.$toast.warning(h.data))}).catch(h=>{s.$toast.clear(),s.$toast.warning(h)})},closeTicket(i,e,a){var n=this;this.$toast.info("Closing Ticket...");var s=this.authStore.getUser,o=this.authStore.getToken,i=i,c=this.componentTicket,a=a,l=new FormData;l.append("user",JSON.stringify(s)),l.append("token",o),l.append("comment",i),l.append("ticket",JSON.stringify(c)),l.append("rating",a),q.post(n.globalUrl+"closeTicket",l).then(h=>{h.data==!0?(n.$toast.clear(),n.$toast.success("Ticket Closed"),this.$router.push("/ticketing/myTickets")):(n.$toast.clear(),n.$toast.warning(h.data))}).catch(h=>{n.$toast.clear(),n.$toast.warning(h)})},closeRequestReject(s){var e=this;this.$toast.info("Rejecting...");var t=this.authStore.getUser,n=this.authStore.getToken,s=s,o=this.componentTicket,i=new FormData;i.append("user",JSON.stringify(t)),i.append("token",n),i.append("comment",s),i.append("ticket",JSON.stringify(o)),console.log("this is the comment from the close request reject"),console.log(s),q.post(e.globalUrl+"closeRequestReject",i).then(c=>{c.data==!0?(e.$toast.clear(),e.$toast.success("Rejected"),this.$router.push("/ticketing/myTickets")):(e.$toast.clear(),e.$toast.warning(c.data))}).catch(c=>{e.$toast.clear(),e.$toast.warning(c)})},ask(s){var e=this;this.$toast.info("asking for additional info...");var t=this.authStore.getUser,n=this.authStore.getToken,s=s,o=this.componentTicket,i=new FormData;i.append("user",JSON.stringify(t)),i.append("token",n),i.append("comment",s),i.append("ticket",JSON.stringify(o)),console.log("asking ticket info"),console.log(o),q.post(e.globalUrl+"askInfo",i).then(c=>{c.data==!0?(e.$toast.clear(),e.$toast.success("Asked"),this.$router.push("/ticketing/myTickets")):(e.$toast.clear(),e.$toast.warning(c.data))}).catch(c=>{e.$toast.clear(),e.$toast.warning(c)})},assignSelf(r,e){var t=this,n=this.authStore.getUser,s=this.authStore.getToken,o=new FormData;console.log("this is the ticket from the main function"),console.log(e),console.log(r),o.append("token",s),o.append("comment",r),o.append("ticket",JSON.stringify(e)),o.append("user",JSON.stringify(n)),this.axios.post(t.globalUrl+"assignSelf",o).then(i=>{t.$toast.clear(),t.$toast.success("Done"),console.log("this is the got ticket"),console.log(this.ticket),location.reload()}).catch(i=>{t.$toast.clear(),t.$toast.warning(i)})},Reassign(i,e,a){var n=this,s=this.authStore.getUser,o=this.authStore.getToken,i=i,c=new FormData,a=a;c.append("token",o),c.append("user",JSON.stringify(s)),c.append("comment",i),c.append("ticket",JSON.stringify(a)),c.append("approver",JSON.stringify(e)),q.post(n.globalUrl+"reassign",c).then(l=>{l.data==!0?(n.$toast.clear(),n.$toast.success("Done"),this.$router.push("/ticketing/myTickets")):(n.$toast.clear(),n.$toast.warning(l.data))}).catch(l=>{n.$toast.clear(),n.$toast.warning(l)})},giveInfo(c,e,a,n){var s=this;this.$toast.info("Giving Info...");var o=this.authStore.getUser,i=this.authStore.getToken,c=c,a=this.componentTicket;console.log("this is the ticket being sent"),console.log(a);var l=new FormData;for(var h of e)l.append("file",h);l.append("user",JSON.stringify(o)),l.append("token",i),l.append("comment",c),l.append("ticket",JSON.stringify(a)),l.append("additionalInfo",n),q.post(s.globalUrl+"giveInfo",l).then(u=>{u.data==!0?(s.$toast.clear(),s.$toast.success("Done"),this.$router.push("/ticketing/myTickets")):(s.$toast.clear(),s.$toast.warning(u.data))}).catch(u=>{s.$toast.clear(),s.$toast.warning(u)})},seekHigherApproval(i,e,c){var n=this;this.$toast.info("Requesting...");var s=this.authStore.getUser,o=this.authStore.getToken,i=i,c=c;console.log("from seek higher approval"),console.log(c);var a=new FormData;a.append("user",JSON.stringify(s)),a.append("token",o),a.append("ticket",JSON.stringify(c)),a.append("comment",i),a.append("approver",JSON.stringify(e)),q.post(n.globalUrl+"seekHigherApproval",a).then(l=>{l.data==!0?(n.$toast.clear(),n.$toast.success("Done"),this.$router.push("/ticketing/myTickets")):(n.$toast.clear(),n.$toast.warning(l.data))}).catch(l=>{n.$toast.clear(),n.$toast.warning(l)})},rejectTicket(r,e){var t=this;this.$toast.info("Rejecting...");var n=this.authStore.getUser,s=this.authStore.getToken,o=new FormData;o.append("user",JSON.stringify(n)),o.append("token",s),o.append("comment",r),o.append("ticket",JSON.stringify(e)),q.post(t.globalUrl+"rejectTicket",o).then(i=>{i.data==!0?(t.$toast.clear(),t.$toast.success("Rejected"),this.$router.push("/ticketing/myTickets")):(t.$toast.clear(),t.$toast.warning(i.data))}).catch(i=>{t.$toast.clear(),t.$toast.warning(i)})}}};const Yi={data(r){return{action:r.ticket.actions[r.ticket.actions.length-1],ticket:r.ticket}},props:["ticket"]},Xi={class:"h-auto"},Qi={key:0,class:"p-4 font-bold bg-blue-300 shadow shadow-md shadow-black"},Zi={class:"flex flex-row text-start text-lg"},ea=d("br",null,null,-1),ta=d("br",null,null,-1),ra={key:0,class:"text-start"},na=d("span",{class:"underline"},"His/Her comment:",-1),sa=d("br",null,null,-1),oa={key:1,class:"p-4 font-bold bg-blue-300 shadow shadow-md shadow-black"},ia={class:"flex flex-row text-start text-2"},aa=d("br",null,null,-1),ca=d("br",null,null,-1),la={key:0,class:"text-start"},da=d("span",{class:"underline"},"His/Her comment:",-1),ha=d("br",null,null,-1),ua={key:2,class:"p-4 font-bold bg-blue-300 shadow shadow-md shadow-black"},fa={key:0,class:"flex flex-row text-start text-lg"},pa={key:1,class:"flex flex-row text-start text-lg"},ma=d("br",null,null,-1),ga=d("br",null,null,-1),_a={key:2,class:"text-start"},va=d("span",{class:"underline"}," His/Her supervisor's comment:",-1),ya=d("br",null,null,-1),ba={key:3,class:"text-start"},ka=d("span",{class:"underline"}," His/Her comment:",-1),Ca=d("br",null,null,-1),wa={key:3,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},xa={class:"flex flex-row text-start text-lg"},Sa=d("br",null,null,-1),Ta=d("br",null,null,-1),Ra={key:0,class:"text-start"},Ea=d("span",{class:"underline"}," His/Her comment:",-1),Pa=d("br",null,null,-1),Aa={key:4,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},Ia={class:"flex flex-row text-start text-lg"},Oa=d("br",null,null,-1),Da=d("br",null,null,-1),Ba={key:0,class:"text-start"},$a=d("span",{class:"underline"}," His/Her comment:",-1),Na=d("br",null,null,-1),Ma={key:5,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},ja={class:"flex flex-row text-start text-lg"},Fa=d("br",null,null,-1),La={class:"text-start"},Ua=d("span",{class:"underline"}," His/Her comment:",-1),Ha=d("br",null,null,-1),za={key:6,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},qa={class:"flex flex-row text-start text-lg"},Wa=d("br",null,null,-1),Va=d("br",null,null,-1),Ga={key:0,class:"text-start"},Ja=d("span",{class:"underline"}," His/Her comment:",-1),Ka=d("br",null,null,-1),Ya={key:1,class:"text-start"},Xa=d("span",{class:"underline"}," Additional Information:",-1),Qa=d("br",null,null,-1),Za={key:2,class:"text-start"},ec=d("span",{class:"underline"}," Additional Files:",-1),tc=d("br",null,null,-1),rc=["href"],nc={key:7,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},sc={class:"flex flex-row text-start text-lg"},oc=d("br",null,null,-1),ic=d("br",null,null,-1),ac={key:0,class:"text-start"},cc=d("span",{class:"underline"}," His/Her comment:",-1),lc=d("br",null,null,-1),dc={key:1,class:"text-start"},hc=d("span",{class:"underline"}," Additional Information:",-1),uc=d("br",null,null,-1),fc={key:2,class:"text-start"},pc=d("span",{class:"underline"}," Additional Files:",-1),mc=d("br",null,null,-1),gc=["href"],_c={key:8,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},vc={class:"flex flex-row text-start text-lg"},yc=d("br",null,null,-1),bc=d("br",null,null,-1),kc={key:0,class:"text-start"},Cc=d("span",{class:"underline"}," His/Her comment:",-1),wc=d("br",null,null,-1),xc={key:1,class:"text-start"},Sc=d("span",{class:"underline"}," Additional Information:",-1),Tc=d("br",null,null,-1),Rc={key:2,class:"text-start"},Ec=d("span",{class:"underline"}," Additional Files:",-1),Pc=d("br",null,null,-1),Ac=["href"],Ic={key:9,class:"p-4 font-bold bg-blue-300 shadow-md shadow-black"},Oc={class:"flex flex-row text-start text-lg"},Dc=d("br",null,null,-1),Bc=d("br",null,null,-1),$c={key:0,class:"text-start"},Nc=d("span",{class:"underline"}," His/Her comment:",-1),Mc=d("br",null,null,-1);function jc(r,e,t,n,s,o){return p(),m("div",Xi,[s.action.type==0&&(t.ticket.approvalRequired==!1||t.ticket.approvalRequired==null)?(p(),m("div",Qi,[d("div",Zi,g(t.ticket.raisedBy.empName)+" has raised a new ticket for the "+g(t.ticket.department)+" department",1),y(),ea,ta,s.action.comments?(p(),m("div",ra,[na,y(),sa,y(" "+g(s.action.comments),1)])):D("",!0)])):s.action.type==4?(p(),m("div",oa,[d("div",ia," You have accepted the ticket raised by "+g(t.ticket.raisedBy.empName)+" for the "+g(t.ticket.department)+" department",1),y(),aa,ca,s.action.comments?(p(),m("div",la,[da,y(),ha,y(" "+g(s.action.comments),1)])):D("",!0)])):(s.action.type==0||s.action.type==1)&&t.ticket.approvalRequired==!0?(p(),m("div",ua,[t.ticket.approvalRequired=="yes"?(p(),m("div",fa,g(t.ticket.raisedBy.empName)+" is seeking your approval to raise a new ticket for the "+g(t.ticket.department)+" department which has been approved by his supervisor "+g(t.ticket.supervisor.empName),1)):(p(),m("div",pa,g(t.ticket.raisedBy.empName)+" is seeking your approval to raise a new ticket for the "+g(t.ticket.department)+" department. ",1)),ma,ga,s.action.comments!="undefined"&&t.ticket.approvalRequired=="yes"?(p(),m("div",_a,[va,y(),ya,y(" "+g(s.action.comments),1)])):s.action.comments!="undefined"&&t.ticket.approvalRequired=="no"?(p(),m("div",ba,[ka,y(),Ca,y(" "+g(s.action.comments),1)])):D("",!0)])):s.action.type==2?(p(),m("div",wa,[d("div",xa,g(t.ticket.ticketingHead.empName)+" is seeking your approval to allow a ticket to be raised by "+g(t.ticket.raisedBy.empName)+" for the "+g(t.ticket.department)+" department ",1),Sa,Ta,s.action.comments?(p(),m("div",Ra,[Ea,y(),Pa,y(" "+g(s.action.comments),1)])):D("",!0)])):s.action.type==3?(p(),m("div",Aa,[d("div",Ia,g(t.ticket.higherApprover.empName)+" has approved the ticket raised by "+g(t.ticket.raisedBy.empName)+" for the "+g(t.ticket.department)+" department ",1),Oa,Da,s.action.comments?(p(),m("div",Ba,[$a,y(),Na,y(" "+g(s.action.comments),1)])):D("",!0)])):s.action.type==6?(p(),m("div",Ma,[d("div",ja,g(t.ticket.prevHandler.empName)+" is asking for additional Information for your ticket raised for the "+g(t.ticket.department)+" department ",1),Fa,d("div",La,[Ua,y(),Ha,y(" "+g(s.action.comments),1)])])):s.action.type==7?(p(),m("div",za,[d("div",qa,g(t.ticket.raisedBy.empName)+" has given you the additional information that you asked for ",1),Wa,Va,s.action.comments?(p(),m("div",Ga,[Ja,y(),Ka,y(" "+g(s.action.comments),1)])):D("",!0),s.action.additionalInfo?(p(),m("div",Ya,[Xa,y(),Qa,y(" "+g(s.action.additionalInfo),1)])):D("",!0),s.action.files?(p(),m("div",Za,[ec,y(),tc,(p(!0),m(k,null,W(s.action.files,(i,c)=>(p(),m("div",{key:c},[d("a",{href:r.globalUrl+"uploads/"+i.fileName,target:"__blank",class:"underline"},g(i.originalName),9,rc)]))),128))])):D("",!0)])):s.action.type==5?(p(),m("div",nc,[d("div",sc,g(t.ticket.prevHandler.empName)+" has assigned you the ticket raised by "+g(t.ticket.raisedBy.empName)+" for the "+g(t.ticket.department)+" department ",1),oc,ic,s.action.comments?(p(),m("div",ac,[cc,y(),lc,y(" "+g(s.action.comments),1)])):D("",!0),t.ticket.addtionalInfo?(p(),m("div",dc,[hc,y(),uc,y(" "+g(s.action.additonalInfo),1)])):D("",!0),s.action.files?(p(),m("div",fc,[pc,y(),mc,(p(!0),m(k,null,W(s.action.files,(i,c)=>(p(),m("div",{key:c},[d("a",{href:r.globalUrl+"uploads/"+i.fileName,target:"__blank"},g(i.originalName),9,gc)]))),128))])):D("",!0)])):s.action.type==10?(p(),m("div",_c,[d("div",vc,g(t.ticket.assignedTo.empName)+" is requesting you to close the ticket you raised for for the "+g(t.ticket.department)+" department ",1),yc,bc,s.action.comments?(p(),m("div",kc,[Cc,y(),wc,y(" "+g(s.action.comments),1)])):D("",!0),s.action.additionalInfo?(p(),m("div",xc,[Sc,y(),Tc,y(" "+g(s.action.additionalInfo),1)])):D("",!0),s.action.files?(p(),m("div",Rc,[Ec,y(),Pc,(p(!0),m(k,null,W(s.action.files,(i,c)=>(p(),m("div",{key:c},[d("a",{href:r.globalUrl+"uploads/"+i.fileName,class:"underline",target:"__blank"},g(i.originalName),9,Ac)]))),128))])):D("",!0)])):s.action.type==12?(p(),m("div",Ic,[d("div",Oc,g(t.ticket.raisedBy.empName)+" has rejected the ticket close request you sent him/her for the ticket he raised for for the "+g(t.ticket.department)+" department ",1),Dc,Bc,s.action.comments?(p(),m("div",$c,[Nc,y(),Mc,y(" "+g(s.action.comments),1)])):D("",!0)])):D("",!0)])}const hn=pe(Yi,[["render",jc]]);var un={exports:{}};(function(r){var e={};e.useBlobBuilder=function(){try{return new Blob([]),!1}catch{return!0}}(),e.useArrayBufferView=!e.useBlobBuilder&&function(){try{return new Blob([new Uint8Array([])]).size===0}catch{return!0}}(),r.exports.binaryFeatures=e;var t=r.exports.BlobBuilder;typeof window<"u"&&(t=r.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder);function n(){this._pieces=[],this._parts=[]}n.prototype.append=function(s){typeof s=="number"?this._pieces.push(s):(this.flush(),this._parts.push(s))},n.prototype.flush=function(){if(this._pieces.length>0){var s=new Uint8Array(this._pieces);e.useArrayBufferView||(s=s.buffer),this._parts.push(s),this._pieces=[]}},n.prototype.getBuffer=function(){if(this.flush(),e.useBlobBuilder){for(var s=new t,o=0,i=this._parts.length;o<i;o++)s.append(this._parts[o]);return s.getBlob()}else return new Blob(this._parts)},r.exports.BufferBuilder=n})(un);var fn=un.exports,Fc=fn.BufferBuilder,vr=fn.binaryFeatures,Lc={unpack:function(r){var e=new ee(r);return e.unpack()},pack:function(r){var e=new te;e.pack(r);var t=e.getBuffer();return t}},Uc=Lc;function ee(r){this.index=0,this.dataBuffer=r,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}ee.prototype.unpack=function(){var r=this.unpack_uint8();if(r<128)return r;if((r^224)<32)return(r^224)-32;var e;if((e=r^160)<=15)return this.unpack_raw(e);if((e=r^176)<=15)return this.unpack_string(e);if((e=r^144)<=15)return this.unpack_array(e);if((e=r^128)<=15)return this.unpack_map(e);switch(r){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}};ee.prototype.unpack_uint8=function(){var r=this.dataView[this.index]&255;return this.index++,r};ee.prototype.unpack_uint16=function(){var r=this.read(2),e=(r[0]&255)*256+(r[1]&255);return this.index+=2,e};ee.prototype.unpack_uint32=function(){var r=this.read(4),e=((r[0]*256+r[1])*256+r[2])*256+r[3];return this.index+=4,e};ee.prototype.unpack_uint64=function(){var r=this.read(8),e=((((((r[0]*256+r[1])*256+r[2])*256+r[3])*256+r[4])*256+r[5])*256+r[6])*256+r[7];return this.index+=8,e};ee.prototype.unpack_int8=function(){var r=this.unpack_uint8();return r<128?r:r-256};ee.prototype.unpack_int16=function(){var r=this.unpack_uint16();return r<32768?r:r-65536};ee.prototype.unpack_int32=function(){var r=this.unpack_uint32();return r<Math.pow(2,31)?r:r-Math.pow(2,32)};ee.prototype.unpack_int64=function(){var r=this.unpack_uint64();return r<Math.pow(2,63)?r:r-Math.pow(2,64)};ee.prototype.unpack_raw=function(r){if(this.length<this.index+r)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+r+" "+this.length);var e=this.dataBuffer.slice(this.index,this.index+r);return this.index+=r,e};ee.prototype.unpack_string=function(r){for(var e=this.read(r),t=0,n="",s,o;t<r;)s=e[t],s<128?(n+=String.fromCharCode(s),t++):(s^192)<32?(o=(s^192)<<6|e[t+1]&63,n+=String.fromCharCode(o),t+=2):(o=(s&15)<<12|(e[t+1]&63)<<6|e[t+2]&63,n+=String.fromCharCode(o),t+=3);return this.index+=r,n};ee.prototype.unpack_array=function(r){for(var e=new Array(r),t=0;t<r;t++)e[t]=this.unpack();return e};ee.prototype.unpack_map=function(r){for(var e={},t=0;t<r;t++){var n=this.unpack(),s=this.unpack();e[n]=s}return e};ee.prototype.unpack_float=function(){var r=this.unpack_uint32(),e=r>>31,t=(r>>23&255)-127,n=r&8388607|8388608;return(e===0?1:-1)*n*Math.pow(2,t-23)};ee.prototype.unpack_double=function(){var r=this.unpack_uint32(),e=this.unpack_uint32(),t=r>>31,n=(r>>20&2047)-1023,s=r&1048575|1048576,o=s*Math.pow(2,n-20)+e*Math.pow(2,n-52);return(t===0?1:-1)*o};ee.prototype.read=function(r){var e=this.index;if(e+r<=this.length)return this.dataView.subarray(e,e+r);throw new Error("BinaryPackFailure: read index out of range")};function te(){this.bufferBuilder=new Fc}te.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()};te.prototype.pack=function(r){var e=typeof r;if(e==="string")this.pack_string(r);else if(e==="number")Math.floor(r)===r?this.pack_integer(r):this.pack_double(r);else if(e==="boolean")r===!0?this.bufferBuilder.append(195):r===!1&&this.bufferBuilder.append(194);else if(e==="undefined")this.bufferBuilder.append(192);else if(e==="object")if(r===null)this.bufferBuilder.append(192);else{var t=r.constructor;if(t==Array)this.pack_array(r);else if(t==Blob||t==File||r instanceof Blob||r instanceof File)this.pack_bin(r);else if(t==ArrayBuffer)vr.useArrayBufferView?this.pack_bin(new Uint8Array(r)):this.pack_bin(r);else if("BYTES_PER_ELEMENT"in r)vr.useArrayBufferView?this.pack_bin(new Uint8Array(r.buffer)):this.pack_bin(r.buffer);else if(t==Object||t.toString().startsWith("class"))this.pack_object(r);else if(t==Date)this.pack_string(r.toString());else if(typeof r.toBinaryPack=="function")this.bufferBuilder.append(r.toBinaryPack());else throw new Error('Type "'+t.toString()+'" not yet supported')}else throw new Error('Type "'+e+'" not yet supported');this.bufferBuilder.flush()};te.prototype.pack_bin=function(r){var e=r.length||r.byteLength||r.size;if(e<=15)this.pack_uint8(160+e);else if(e<=65535)this.bufferBuilder.append(218),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(219),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(r)};te.prototype.pack_string=function(r){var e=zc(r);if(e<=15)this.pack_uint8(176+e);else if(e<=65535)this.bufferBuilder.append(216),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(217),this.pack_uint32(e);else throw new Error("Invalid length");this.bufferBuilder.append(r)};te.prototype.pack_array=function(r){var e=r.length;if(e<=15)this.pack_uint8(144+e);else if(e<=65535)this.bufferBuilder.append(220),this.pack_uint16(e);else if(e<=4294967295)this.bufferBuilder.append(221),this.pack_uint32(e);else throw new Error("Invalid length");for(var t=0;t<e;t++)this.pack(r[t])};te.prototype.pack_integer=function(r){if(r>=-32&&r<=127)this.bufferBuilder.append(r&255);else if(r>=0&&r<=255)this.bufferBuilder.append(204),this.pack_uint8(r);else if(r>=-128&&r<=127)this.bufferBuilder.append(208),this.pack_int8(r);else if(r>=0&&r<=65535)this.bufferBuilder.append(205),this.pack_uint16(r);else if(r>=-32768&&r<=32767)this.bufferBuilder.append(209),this.pack_int16(r);else if(r>=0&&r<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(r);else if(r>=-2147483648&&r<=2147483647)this.bufferBuilder.append(210),this.pack_int32(r);else if(r>=-9223372036854776e3&&r<=9223372036854776e3)this.bufferBuilder.append(211),this.pack_int64(r);else if(r>=0&&r<=18446744073709552e3)this.bufferBuilder.append(207),this.pack_uint64(r);else throw new Error("Invalid integer")};te.prototype.pack_double=function(r){var e=0;r<0&&(e=1,r=-r);var t=Math.floor(Math.log(r)/Math.LN2),n=r/Math.pow(2,t)-1,s=Math.floor(n*Math.pow(2,52)),o=Math.pow(2,32),i=e<<31|t+1023<<20|s/o&1048575,c=s%o;this.bufferBuilder.append(203),this.pack_int32(i),this.pack_int32(c)};te.prototype.pack_object=function(r){var e=Object.keys(r),t=e.length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else if(t<=4294967295)this.bufferBuilder.append(223),this.pack_uint32(t);else throw new Error("Invalid length");for(var n in r)r.hasOwnProperty(n)&&(this.pack(n),this.pack(r[n]))};te.prototype.pack_uint8=function(r){this.bufferBuilder.append(r)};te.prototype.pack_uint16=function(r){this.bufferBuilder.append(r>>8),this.bufferBuilder.append(r&255)};te.prototype.pack_uint32=function(r){var e=r&4294967295;this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255)};te.prototype.pack_uint64=function(r){var e=r/Math.pow(2,32),t=r%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};te.prototype.pack_int8=function(r){this.bufferBuilder.append(r&255)};te.prototype.pack_int16=function(r){this.bufferBuilder.append((r&65280)>>8),this.bufferBuilder.append(r&255)};te.prototype.pack_int32=function(r){this.bufferBuilder.append(r>>>24&255),this.bufferBuilder.append((r&16711680)>>>16),this.bufferBuilder.append((r&65280)>>>8),this.bufferBuilder.append(r&255)};te.prototype.pack_int64=function(r){var e=Math.floor(r/Math.pow(2,32)),t=r%Math.pow(2,32);this.bufferBuilder.append((e&4278190080)>>>24),this.bufferBuilder.append((e&16711680)>>>16),this.bufferBuilder.append((e&65280)>>>8),this.bufferBuilder.append(e&255),this.bufferBuilder.append((t&4278190080)>>>24),this.bufferBuilder.append((t&16711680)>>>16),this.bufferBuilder.append((t&65280)>>>8),this.bufferBuilder.append(t&255)};function Hc(r){var e=r.charCodeAt(0);return e<=2047?"00":e<=65535?"000":e<=2097151?"0000":e<=67108863?"00000":"000000"}function zc(r){return r.length>600?new Blob([r]).size:r.replace(/[^\u0000-\u007F]/g,Hc).length}const yr=ut(Uc);let pn=!0,mn=!0;function Ue(r,e,t){const n=r.match(e);return n&&n.length>=t&&parseInt(n[t],10)}function $e(r,e,t){if(!r.RTCPeerConnection)return;const n=r.RTCPeerConnection.prototype,s=n.addEventListener;n.addEventListener=function(i,c){if(i!==e)return s.apply(this,arguments);const a=l=>{const h=t(l);h&&(c.handleEvent?c.handleEvent(h):c(h))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(c,a),s.apply(this,[i,a])};const o=n.removeEventListener;n.removeEventListener=function(i,c){if(i!==e||!this._eventMap||!this._eventMap[e])return o.apply(this,arguments);if(!this._eventMap[e].has(c))return o.apply(this,arguments);const a=this._eventMap[e].get(c);return this._eventMap[e].delete(c),this._eventMap[e].size===0&&delete this._eventMap[e],Object.keys(this._eventMap).length===0&&delete this._eventMap,o.apply(this,[i,a])},Object.defineProperty(n,"on"+e,{get(){return this["_on"+e]},set(i){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),i&&this.addEventListener(e,this["_on"+e]=i)},enumerable:!0,configurable:!0})}function qc(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(pn=r,r?"adapter.js logging disabled":"adapter.js logging enabled")}function Wc(r){return typeof r!="boolean"?new Error("Argument type: "+typeof r+". Please use a boolean."):(mn=!r,"adapter.js deprecation warnings "+(r?"disabled":"enabled"))}function Vt(){if(typeof window=="object"){if(pn)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _t(r,e){mn&&console.warn(r+" is deprecated, please use "+e+" instead.")}function Vc(r){const e={browser:null,version:null};if(typeof r>"u"||!r.navigator)return e.browser="Not a browser.",e;const{navigator:t}=r;if(t.mozGetUserMedia)e.browser="firefox",e.version=Ue(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||r.isSecureContext===!1&&r.webkitRTCPeerConnection&&!r.RTCIceGatherer)e.browser="chrome",e.version=Ue(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=Ue(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else if(r.RTCPeerConnection&&t.userAgent.match(/AppleWebKit\/(\d+)\./))e.browser="safari",e.version=Ue(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=r.RTCRtpTransceiver&&"currentDirection"in r.RTCRtpTransceiver.prototype;else return e.browser="Not a supported browser.",e;return e}function br(r){return Object.prototype.toString.call(r)==="[object Object]"}function gn(r){return br(r)?Object.keys(r).reduce(function(e,t){const n=br(r[t]),s=n?gn(r[t]):r[t],o=n&&!Object.keys(s).length;return s===void 0||o?e:Object.assign(e,{[t]:s})},{}):r}function Pt(r,e,t){!e||t.has(e.id)||(t.set(e.id,e),Object.keys(e).forEach(n=>{n.endsWith("Id")?Pt(r,r.get(e[n]),t):n.endsWith("Ids")&&e[n].forEach(s=>{Pt(r,r.get(s),t)})}))}function kr(r,e,t){const n=t?"outbound-rtp":"inbound-rtp",s=new Map;if(e===null)return s;const o=[];return r.forEach(i=>{i.type==="track"&&i.trackIdentifier===e.id&&o.push(i)}),o.forEach(i=>{r.forEach(c=>{c.type===n&&c.trackId===i.id&&Pt(r,c,s)})}),s}const Cr=Vt;function _n(r,e){const t=r&&r.navigator;if(!t.mediaDevices)return;const n=function(c){if(typeof c!="object"||c.mandatory||c.optional)return c;const a={};return Object.keys(c).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const h=typeof c[l]=="object"?c[l]:{ideal:c[l]};h.exact!==void 0&&typeof h.exact=="number"&&(h.min=h.max=h.exact);const u=function(f,b){return f?f+b.charAt(0).toUpperCase()+b.slice(1):b==="deviceId"?"sourceId":b};if(h.ideal!==void 0){a.optional=a.optional||[];let f={};typeof h.ideal=="number"?(f[u("min",l)]=h.ideal,a.optional.push(f),f={},f[u("max",l)]=h.ideal,a.optional.push(f)):(f[u("",l)]=h.ideal,a.optional.push(f))}h.exact!==void 0&&typeof h.exact!="number"?(a.mandatory=a.mandatory||{},a.mandatory[u("",l)]=h.exact):["min","max"].forEach(f=>{h[f]!==void 0&&(a.mandatory=a.mandatory||{},a.mandatory[u(f,l)]=h[f])})}),c.advanced&&(a.optional=(a.optional||[]).concat(c.advanced)),a},s=function(c,a){if(e.version>=61)return a(c);if(c=JSON.parse(JSON.stringify(c)),c&&typeof c.audio=="object"){const l=function(h,u,f){u in h&&!(f in h)&&(h[f]=h[u],delete h[u])};c=JSON.parse(JSON.stringify(c)),l(c.audio,"autoGainControl","googAutoGainControl"),l(c.audio,"noiseSuppression","googNoiseSuppression"),c.audio=n(c.audio)}if(c&&typeof c.video=="object"){let l=c.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const h=e.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(t.mediaDevices.getSupportedConstraints&&t.mediaDevices.getSupportedConstraints().facingMode&&!h)){delete c.video.facingMode;let u;if(l.exact==="environment"||l.ideal==="environment"?u=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(u=["front"]),u)return t.mediaDevices.enumerateDevices().then(f=>{f=f.filter(_=>_.kind==="videoinput");let b=f.find(_=>u.some(x=>_.label.toLowerCase().includes(x)));return!b&&f.length&&u.includes("back")&&(b=f[f.length-1]),b&&(c.video.deviceId=l.exact?{exact:b.deviceId}:{ideal:b.deviceId}),c.video=n(c.video),Cr("chrome: "+JSON.stringify(c)),a(c)})}c.video=n(c.video)}return Cr("chrome: "+JSON.stringify(c)),a(c)},o=function(c){return e.version>=64?c:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[c.name]||c.name,message:c.message,constraint:c.constraint||c.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},i=function(c,a,l){s(c,h=>{t.webkitGetUserMedia(h,a,u=>{l&&l(o(u))})})};if(t.getUserMedia=i.bind(t),t.mediaDevices.getUserMedia){const c=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(a){return s(a,l=>c(l).then(h=>{if(l.audio&&!h.getAudioTracks().length||l.video&&!h.getVideoTracks().length)throw h.getTracks().forEach(u=>{u.stop()}),new DOMException("","NotFoundError");return h},h=>Promise.reject(o(h))))}}}function Gc(r,e){if(!(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices)&&r.navigator.mediaDevices){if(typeof e!="function"){console.error("shimGetDisplayMedia: getSourceId argument is not a function");return}r.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then(s=>{const o=n.video&&n.video.width,i=n.video&&n.video.height,c=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:s,maxFrameRate:c||3}},o&&(n.video.mandatory.maxWidth=o),i&&(n.video.mandatory.maxHeight=i),r.navigator.mediaDevices.getUserMedia(n)})}}}function vn(r){r.MediaStream=r.MediaStream||r.webkitMediaStream}function yn(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("ontrack"in r.RTCPeerConnection.prototype)){Object.defineProperty(r.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",s=>{let o;r.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===s.track.id):o={track:s.track};const i=new Event("track");i.track=s.track,i.receiver=o,i.transceiver={receiver:o},i.streams=[n.stream],this.dispatchEvent(i)}),n.stream.getTracks().forEach(s=>{let o;r.RTCPeerConnection.prototype.getReceivers?o=this.getReceivers().find(c=>c.track&&c.track.id===s.id):o={track:s};const i=new Event("track");i.track=s,i.receiver=o,i.transceiver={receiver:o},i.streams=[n.stream],this.dispatchEvent(i)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else $e(r,"track",e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e))}function bn(r){if(typeof r=="object"&&r.RTCPeerConnection&&!("getSenders"in r.RTCPeerConnection.prototype)&&"createDTMFSender"in r.RTCPeerConnection.prototype){const e=function(s,o){return{track:o,get dtmf(){return this._dtmf===void 0&&(o.kind==="audio"?this._dtmf=s.createDTMFSender(o):this._dtmf=null),this._dtmf},_pc:s}};if(!r.RTCPeerConnection.prototype.getSenders){r.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const s=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(c,a){let l=s.apply(this,arguments);return l||(l=e(this,c),this._senders.push(l)),l};const o=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(c){o.apply(this,arguments);const a=this._senders.indexOf(c);a!==-1&&this._senders.splice(a,1)}}const t=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],t.apply(this,[o]),o.getTracks().forEach(i=>{this._senders.push(e(this,i))})};const n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(i=>{const c=this._senders.find(a=>a.track===i);c&&this._senders.splice(this._senders.indexOf(c),1)})}}else if(typeof r=="object"&&r.RTCPeerConnection&&"getSenders"in r.RTCPeerConnection.prototype&&"createDTMFSender"in r.RTCPeerConnection.prototype&&r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)){const e=r.RTCPeerConnection.prototype.getSenders;r.RTCPeerConnection.prototype.getSenders=function(){const n=e.apply(this,[]);return n.forEach(s=>s._pc=this),n},Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function kn(r){if(!r.RTCPeerConnection)return;const e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[n,s,o]=arguments;if(arguments.length>0&&typeof n=="function")return e.apply(this,arguments);if(e.length===0&&(arguments.length===0||typeof n!="function"))return e.apply(this,[]);const i=function(a){const l={};return a.result().forEach(u=>{const f={id:u.id,timestamp:u.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[u.type]||u.type};u.names().forEach(b=>{f[b]=u.stat(b)}),l[f.id]=f}),l},c=function(a){return new Map(Object.keys(a).map(l=>[l,a[l]]))};if(arguments.length>=2){const a=function(l){s(c(i(l)))};return e.apply(this,[a,n])}return new Promise((a,l)=>{e.apply(this,[function(h){a(c(i(h)))},l])}).then(s,o)}}function Cn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender&&r.RTCRtpReceiver))return;if(!("getStats"in r.RTCRtpSender.prototype)){const t=r.RTCPeerConnection.prototype.getSenders;t&&(r.RTCPeerConnection.prototype.getSenders=function(){const o=t.apply(this,[]);return o.forEach(i=>i._pc=this),o});const n=r.RTCPeerConnection.prototype.addTrack;n&&(r.RTCPeerConnection.prototype.addTrack=function(){const o=n.apply(this,arguments);return o._pc=this,o}),r.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(i=>kr(i,o.track,!0))}}if(!("getStats"in r.RTCRtpReceiver.prototype)){const t=r.RTCPeerConnection.prototype.getReceivers;t&&(r.RTCPeerConnection.prototype.getReceivers=function(){const s=t.apply(this,[]);return s.forEach(o=>o._pc=this),s}),$e(r,"track",n=>(n.receiver._pc=n.srcElement,n)),r.RTCRtpReceiver.prototype.getStats=function(){const s=this;return this._pc.getStats().then(o=>kr(o,s.track,!1))}}if(!("getStats"in r.RTCRtpSender.prototype&&"getStats"in r.RTCRtpReceiver.prototype))return;const e=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof r.MediaStreamTrack){const n=arguments[0];let s,o,i;return this.getSenders().forEach(c=>{c.track===n&&(s?i=!0:s=c)}),this.getReceivers().forEach(c=>(c.track===n&&(o?i=!0:o=c),c.track===n)),i||s&&o?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):s?s.getStats():o?o.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function wn(r){r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(i=>this._shimmedLocalStreams[i][0])};const e=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addTrack=function(i,c){if(!c)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const a=e.apply(this,arguments);return this._shimmedLocalStreams[c.id]?this._shimmedLocalStreams[c.id].indexOf(a)===-1&&this._shimmedLocalStreams[c.id].push(a):this._shimmedLocalStreams[c.id]=[c,a],a};const t=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(i){this._shimmedLocalStreams=this._shimmedLocalStreams||{},i.getTracks().forEach(l=>{if(this.getSenders().find(u=>u.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const c=this.getSenders();t.apply(this,arguments);const a=this.getSenders().filter(l=>c.indexOf(l)===-1);this._shimmedLocalStreams[i.id]=[i].concat(a)};const n=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(i){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[i.id],n.apply(this,arguments)};const s=r.RTCPeerConnection.prototype.removeTrack;r.RTCPeerConnection.prototype.removeTrack=function(i){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},i&&Object.keys(this._shimmedLocalStreams).forEach(c=>{const a=this._shimmedLocalStreams[c].indexOf(i);a!==-1&&this._shimmedLocalStreams[c].splice(a,1),this._shimmedLocalStreams[c].length===1&&delete this._shimmedLocalStreams[c]}),s.apply(this,arguments)}}function xn(r,e){if(!r.RTCPeerConnection)return;if(r.RTCPeerConnection.prototype.addTrack&&e.version>=65)return wn(r);const t=r.RTCPeerConnection.prototype.getLocalStreams;r.RTCPeerConnection.prototype.getLocalStreams=function(){const h=t.apply(this);return this._reverseStreams=this._reverseStreams||{},h.map(u=>this._reverseStreams[u.id])};const n=r.RTCPeerConnection.prototype.addStream;r.RTCPeerConnection.prototype.addStream=function(h){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.getTracks().forEach(u=>{if(this.getSenders().find(b=>b.track===u))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[h.id]){const u=new r.MediaStream(h.getTracks());this._streams[h.id]=u,this._reverseStreams[u.id]=h,h=u}n.apply(this,[h])};const s=r.RTCPeerConnection.prototype.removeStream;r.RTCPeerConnection.prototype.removeStream=function(h){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[h.id]||h]),delete this._reverseStreams[this._streams[h.id]?this._streams[h.id].id:h.id],delete this._streams[h.id]},r.RTCPeerConnection.prototype.addTrack=function(h,u){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const f=[].slice.call(arguments,1);if(f.length!==1||!f[0].getTracks().find(x=>x===h))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(x=>x.track===h))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[u.id];if(_)_.addTrack(h),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const x=new r.MediaStream([h]);this._streams[u.id]=x,this._reverseStreams[x.id]=u,this.addStream(x)}return this.getSenders().find(x=>x.track===h)};function o(l,h){let u=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const b=l._reverseStreams[f],_=l._streams[b.id];u=u.replace(new RegExp(_.id,"g"),b.id)}),new RTCSessionDescription({type:h.type,sdp:u})}function i(l,h){let u=h.sdp;return Object.keys(l._reverseStreams||[]).forEach(f=>{const b=l._reverseStreams[f],_=l._streams[b.id];u=u.replace(new RegExp(b.id,"g"),_.id)}),new RTCSessionDescription({type:h.type,sdp:u})}["createOffer","createAnswer"].forEach(function(l){const h=r.RTCPeerConnection.prototype[l],u={[l](){const f=arguments;return arguments.length&&typeof arguments[0]=="function"?h.apply(this,[_=>{const x=o(this,_);f[0].apply(null,[x])},_=>{f[1]&&f[1].apply(null,_)},arguments[2]]):h.apply(this,arguments).then(_=>o(this,_))}};r.RTCPeerConnection.prototype[l]=u[l]});const c=r.RTCPeerConnection.prototype.setLocalDescription;r.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?c.apply(this,arguments):(arguments[0]=i(this,arguments[0]),c.apply(this,arguments))};const a=Object.getOwnPropertyDescriptor(r.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(r.RTCPeerConnection.prototype,"localDescription",{get(){const l=a.get.apply(this);return l.type===""?l:o(this,l)}}),r.RTCPeerConnection.prototype.removeTrack=function(h){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!h._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(h._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let f;Object.keys(this._streams).forEach(b=>{this._streams[b].getTracks().find(x=>h.track===x)&&(f=this._streams[b])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(h.track),this.dispatchEvent(new Event("negotiationneeded")))}}function At(r,e){!r.RTCPeerConnection&&r.webkitRTCPeerConnection&&(r.RTCPeerConnection=r.webkitRTCPeerConnection),r.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){const n=r.RTCPeerConnection.prototype[t],s={[t](){return arguments[0]=new(t==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};r.RTCPeerConnection.prototype[t]=s[t]})}function Sn(r,e){$e(r,"negotiationneeded",t=>{const n=t.target;if(!((e.version<72||n.getConfiguration&&n.getConfiguration().sdpSemantics==="plan-b")&&n.signalingState!=="stable"))return t})}const wr=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Sn,shimAddTrackRemoveTrack:xn,shimAddTrackRemoveTrackWithNative:wn,shimGetDisplayMedia:Gc,shimGetSendersWithDtmf:bn,shimGetStats:kn,shimGetUserMedia:_n,shimMediaStream:vn,shimOnTrack:yn,shimPeerConnection:At,shimSenderReceiverGetStats:Cn},Symbol.toStringTag,{value:"Module"}));function Jc(r,e){let t=!1;return r=JSON.parse(JSON.stringify(r)),r.filter(n=>{if(n&&(n.urls||n.url)){let s=n.urls||n.url;n.url&&!n.urls&&_t("RTCIceServer.url","RTCIceServer.urls");const o=typeof s=="string";return o&&(s=[s]),s=s.filter(i=>{if(i.indexOf("stun:")===0)return!1;const c=i.startsWith("turn")&&!i.startsWith("turn:[")&&i.includes("transport=udp");return c&&!t?(t=!0,!0):c&&!t}),delete n.url,n.urls=o?s[0]:s,!!s.length}})}var Tn={exports:{}};(function(r){var e={};e.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split(`
`).map(function(n){return n.trim()})},e.splitSections=function(t){var n=t.split(`
m=`);return n.map(function(s,o){return(o>0?"m="+s:s).trim()+`\r
`})},e.getDescription=function(t){var n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){var n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter(function(s){return s.indexOf(n)===0})},e.parseCandidate=function(t){var n;t.indexOf("a=candidate:")===0?n=t.substring(12).split(" "):n=t.substring(10).split(" ");for(var s={foundation:n[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},o=8;o<n.length;o+=2)switch(n[o]){case"raddr":s.relatedAddress=n[o+1];break;case"rport":s.relatedPort=parseInt(n[o+1],10);break;case"tcptype":s.tcpType=n[o+1];break;case"ufrag":s.ufrag=n[o+1],s.usernameFragment=n[o+1];break;default:s[n[o]]=n[o+1];break}return s},e.writeCandidate=function(t){var n=[];n.push(t.foundation),n.push(t.component),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);var s=t.type;return n.push("typ"),n.push(s),s!=="host"&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&t.protocol.toLowerCase()==="tcp"&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},e.parseIceOptions=function(t){return t.substr(14).split(" ")},e.parseRtpMap=function(t){var n=t.substr(9).split(" "),s={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),s.name=n[0],s.clockRate=parseInt(n[1],10),s.channels=n.length===3?parseInt(n[2],10):1,s.numChannels=s.channels,s},e.writeRtpMap=function(t){var n=t.payloadType;t.preferredPayloadType!==void 0&&(n=t.preferredPayloadType);var s=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(s!==1?"/"+s:"")+`\r
`},e.parseExtmap=function(t){var n=t.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&t.direction!=="sendrecv"?"/"+t.direction:"")+" "+t.uri+`\r
`},e.parseFmtp=function(t){for(var n={},s,o=t.substr(t.indexOf(" ")+1).split(";"),i=0;i<o.length;i++)s=o[i].trim().split("="),n[s[0].trim()]=s[1];return n},e.writeFmtp=function(t){var n="",s=t.payloadType;if(t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var o=[];Object.keys(t.parameters).forEach(function(i){t.parameters[i]?o.push(i+"="+t.parameters[i]):o.push(i)}),n+="a=fmtp:"+s+" "+o.join(";")+`\r
`}return n},e.parseRtcpFb=function(t){var n=t.substr(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},e.writeRtcpFb=function(t){var n="",s=t.payloadType;return t.preferredPayloadType!==void 0&&(s=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach(function(o){n+="a=rtcp-fb:"+s+" "+o.type+(o.parameter&&o.parameter.length?" "+o.parameter:"")+`\r
`}),n},e.parseSsrcMedia=function(t){var n=t.indexOf(" "),s={ssrc:parseInt(t.substr(7,n-7),10)},o=t.indexOf(":",n);return o>-1?(s.attribute=t.substr(n+1,o-n-1),s.value=t.substr(o+1)):s.attribute=t.substr(n+1),s},e.parseSsrcGroup=function(t){var n=t.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map(function(s){return parseInt(s,10)})}},e.getMid=function(t){var n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substr(6)},e.parseFingerprint=function(t){var n=t.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},e.getDtlsParameters=function(t,n){var s=e.matchPrefix(t+n,"a=fingerprint:");return{role:"auto",fingerprints:s.map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,n){var s="a=setup:"+n+`\r
`;return t.fingerprints.forEach(function(o){s+="a=fingerprint:"+o.algorithm+" "+o.value+`\r
`}),s},e.parseCryptoLine=function(t){var n=t.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+(typeof t.keyParams=="object"?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+`\r
`},e.parseCryptoKeyParams=function(t){if(t.indexOf("inline:")!==0)return null;var n=t.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){var s=e.matchPrefix(t+n,"a=crypto:");return s.map(e.parseCryptoLine)},e.getIceParameters=function(t,n){var s=e.matchPrefix(t+n,"a=ice-ufrag:")[0],o=e.matchPrefix(t+n,"a=ice-pwd:")[0];return s&&o?{usernameFragment:s.substr(12),password:o.substr(10)}:null},e.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+`\r
a=ice-pwd:`+t.password+`\r
`},e.parseRtpParameters=function(t){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},s=e.splitLines(t),o=s[0].split(" "),i=3;i<o.length;i++){var c=o[i],a=e.matchPrefix(t,"a=rtpmap:"+c+" ")[0];if(a){var l=e.parseRtpMap(a),h=e.matchPrefix(t,"a=fmtp:"+c+" ");switch(l.parameters=h.length?e.parseFmtp(h[0]):{},l.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+c+" ").map(e.parseRtcpFb),n.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(l.name.toUpperCase());break}}}return e.matchPrefix(t,"a=extmap:").forEach(function(u){n.headerExtensions.push(e.parseExtmap(u))}),n},e.writeRtpDescription=function(t,n){var s="";s+="m="+t+" ",s+=n.codecs.length>0?"9":"0",s+=" UDP/TLS/RTP/SAVPF ",s+=n.codecs.map(function(i){return i.preferredPayloadType!==void 0?i.preferredPayloadType:i.payloadType}).join(" ")+`\r
`,s+=`c=IN IP4 0.0.0.0\r
`,s+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,n.codecs.forEach(function(i){s+=e.writeRtpMap(i),s+=e.writeFmtp(i),s+=e.writeRtcpFb(i)});var o=0;return n.codecs.forEach(function(i){i.maxptime>o&&(o=i.maxptime)}),o>0&&(s+="a=maxptime:"+o+`\r
`),s+=`a=rtcp-mux\r
`,n.headerExtensions&&n.headerExtensions.forEach(function(i){s+=e.writeExtmap(i)}),s},e.parseRtpEncodingParameters=function(t){var n=[],s=e.parseRtpParameters(t),o=s.fecMechanisms.indexOf("RED")!==-1,i=s.fecMechanisms.indexOf("ULPFEC")!==-1,c=e.matchPrefix(t,"a=ssrc:").map(function(f){return e.parseSsrcMedia(f)}).filter(function(f){return f.attribute==="cname"}),a=c.length>0&&c[0].ssrc,l,h=e.matchPrefix(t,"a=ssrc-group:FID").map(function(f){var b=f.substr(17).split(" ");return b.map(function(_){return parseInt(_,10)})});h.length>0&&h[0].length>1&&h[0][0]===a&&(l=h[0][1]),s.codecs.forEach(function(f){if(f.name.toUpperCase()==="RTX"&&f.parameters.apt){var b={ssrc:a,codecPayloadType:parseInt(f.parameters.apt,10)};a&&l&&(b.rtx={ssrc:l}),n.push(b),o&&(b=JSON.parse(JSON.stringify(b)),b.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},n.push(b))}}),n.length===0&&a&&n.push({ssrc:a});var u=e.matchPrefix(t,"b=");return u.length&&(u[0].indexOf("b=TIAS:")===0?u=parseInt(u[0].substr(7),10):u[0].indexOf("b=AS:")===0?u=parseInt(u[0].substr(5),10)*1e3*.95-50*40*8:u=void 0,n.forEach(function(f){f.maxBitrate=u})),n},e.parseRtcpParameters=function(t){var n={},s=e.matchPrefix(t,"a=ssrc:").map(function(c){return e.parseSsrcMedia(c)}).filter(function(c){return c.attribute==="cname"})[0];s&&(n.cname=s.value,n.ssrc=s.ssrc);var o=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=o.length>0,n.compound=o.length===0;var i=e.matchPrefix(t,"a=rtcp-mux");return n.mux=i.length>0,n},e.parseMsid=function(t){var n,s=e.matchPrefix(t,"a=msid:");if(s.length===1)return n=s[0].substr(7).split(" "),{stream:n[0],track:n[1]};var o=e.matchPrefix(t,"a=ssrc:").map(function(i){return e.parseSsrcMedia(i)}).filter(function(i){return i.attribute==="msid"});if(o.length>0)return n=o[0].value.split(" "),{stream:n[0],track:n[1]}},e.parseSctpDescription=function(t){var n=e.parseMLine(t),s=e.matchPrefix(t,"a=max-message-size:"),o;s.length>0&&(o=parseInt(s[0].substr(19),10)),isNaN(o)&&(o=65536);var i=e.matchPrefix(t,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:n.fmt,maxMessageSize:o};var c=e.matchPrefix(t,"a=sctpmap:");if(c.length>0){var a=e.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:o}}},e.writeSctpDescription=function(t,n){var s=[];return t.protocol!=="DTLS/SCTP"?s=["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+n.port+`\r
`]:s=["m="+t.kind+" 9 "+t.protocol+" "+n.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+n.port+" "+n.protocol+` 65535\r
`],n.maxMessageSize!==void 0&&s.push("a=max-message-size:"+n.maxMessageSize+`\r
`),s.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,21)},e.writeSessionBoilerplate=function(t,n,s){var o,i=n!==void 0?n:2;t?o=t:o=e.generateSessionId();var c=s||"thisisadapterortc";return`v=0\r
o=`+c+" "+o+" "+i+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},e.writeMediaSection=function(t,n,s,o){var i=e.writeRtpDescription(t.kind,n);if(i+=e.writeIceParameters(t.iceGatherer.getLocalParameters()),i+=e.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),s==="offer"?"actpass":"active"),i+="a=mid:"+t.mid+`\r
`,t.direction?i+="a="+t.direction+`\r
`:t.rtpSender&&t.rtpReceiver?i+=`a=sendrecv\r
`:t.rtpSender?i+=`a=sendonly\r
`:t.rtpReceiver?i+=`a=recvonly\r
`:i+=`a=inactive\r
`,t.rtpSender){var c="msid:"+o.id+" "+t.rtpSender.track.id+`\r
`;i+="a="+c,i+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+c,t.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+c,i+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return i+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+e.localCName+`\r
`,t.rtpSender&&t.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+e.localCName+`\r
`),i},e.getDirection=function(t,n){for(var s=e.splitLines(t),o=0;o<s.length;o++)switch(s[o]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return s[o].substr(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){var n=e.splitLines(t),s=n[0].split(" ");return s[0].substr(2)},e.isRejected=function(t){return t.split(" ",2)[1]==="0"},e.parseMLine=function(t){var n=e.splitLines(t),s=n[0].substr(2).split(" ");return{kind:s[0],port:parseInt(s[1],10),protocol:s[2],fmt:s.slice(3).join(" ")}},e.parseOLine=function(t){var n=e.matchPrefix(t,"o=")[0],s=n.substr(2).split(" ");return{username:s[0],sessionId:s[1],sessionVersion:parseInt(s[2],10),netType:s[3],addressType:s[4],address:s[5]}},e.isValidSDP=function(t){if(typeof t!="string"||t.length===0)return!1;for(var n=e.splitLines(t),s=0;s<n.length;s++)if(n[s].length<2||n[s].charAt(1)!=="=")return!1;return!0},r.exports=e})(Tn);var Rn=Tn.exports;const ot=ut(Rn);var O=Rn;function Kc(r){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[r.type]||r.type}function xr(r,e,t,n,s){var o=O.writeRtpDescription(r.kind,e);if(o+=O.writeIceParameters(r.iceGatherer.getLocalParameters()),o+=O.writeDtlsParameters(r.dtlsTransport.getLocalParameters(),t==="offer"?"actpass":s||"active"),o+="a=mid:"+r.mid+`\r
`,r.rtpSender&&r.rtpReceiver?o+=`a=sendrecv\r
`:r.rtpSender?o+=`a=sendonly\r
`:r.rtpReceiver?o+=`a=recvonly\r
`:o+=`a=inactive\r
`,r.rtpSender){var i=r.rtpSender._initialTrackId||r.rtpSender.track.id;r.rtpSender._initialTrackId=i;var c="msid:"+(n?n.id:"-")+" "+i+`\r
`;o+="a="+c,o+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" "+c,r.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+r.sendEncodingParameters[0].ssrc+" "+r.sendEncodingParameters[0].rtx.ssrc+`\r
`)}return o+="a=ssrc:"+r.sendEncodingParameters[0].ssrc+" cname:"+O.localCName+`\r
`,r.rtpSender&&r.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+r.sendEncodingParameters[0].rtx.ssrc+" cname:"+O.localCName+`\r
`),o}function Yc(r,e){var t=!1;return r=JSON.parse(JSON.stringify(r)),r.filter(function(n){if(n&&(n.urls||n.url)){var s=n.urls||n.url;n.url&&!n.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var o=typeof s=="string";return o&&(s=[s]),s=s.filter(function(i){var c=i.indexOf("turn:")===0&&i.indexOf("transport=udp")!==-1&&i.indexOf("turn:[")===-1&&!t;return c?(t=!0,!0):i.indexOf("stun:")===0&&e>=14393&&i.indexOf("?transport=udp")===-1}),delete n.url,n.urls=o?s[0]:s,!!s.length}})}function et(r,e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(o,i){o=parseInt(o,10);for(var c=0;c<i.length;c++)if(i[c].payloadType===o||i[c].preferredPayloadType===o)return i[c]},s=function(o,i,c,a){var l=n(o.parameters.apt,c),h=n(i.parameters.apt,a);return l&&h&&l.name.toLowerCase()===h.name.toLowerCase()};return r.codecs.forEach(function(o){for(var i=0;i<e.codecs.length;i++){var c=e.codecs[i];if(o.name.toLowerCase()===c.name.toLowerCase()&&o.clockRate===c.clockRate){if(o.name.toLowerCase()==="rtx"&&o.parameters&&c.parameters.apt&&!s(o,c,r.codecs,e.codecs))continue;c=JSON.parse(JSON.stringify(c)),c.numChannels=Math.min(o.numChannels,c.numChannels),t.codecs.push(c),c.rtcpFeedback=c.rtcpFeedback.filter(function(a){for(var l=0;l<o.rtcpFeedback.length;l++)if(o.rtcpFeedback[l].type===a.type&&o.rtcpFeedback[l].parameter===a.parameter)return!0;return!1});break}}}),r.headerExtensions.forEach(function(o){for(var i=0;i<e.headerExtensions.length;i++){var c=e.headerExtensions[i];if(o.uri===c.uri){t.headerExtensions.push(c);break}}}),t}function Sr(r,e,t){return{offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[e][r].indexOf(t)!==-1}function Ct(r,e){var t=r.getRemoteCandidates().find(function(n){return e.foundation===n.foundation&&e.ip===n.ip&&e.port===n.port&&e.priority===n.priority&&e.protocol===n.protocol&&e.type===n.type});return t||r.addRemoteCandidate(e),!t}function re(r,e){var t=new Error(e);return t.name=r,t.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[r],t}var Xc=function(r,e){function t(a,l){l.addTrack(a),l.dispatchEvent(new r.MediaStreamTrackEvent("addtrack",{track:a}))}function n(a,l){l.removeTrack(a),l.dispatchEvent(new r.MediaStreamTrackEvent("removetrack",{track:a}))}function s(a,l,h,u){var f=new Event("track");f.track=l,f.receiver=h,f.transceiver={receiver:h},f.streams=u,r.setTimeout(function(){a._dispatchEvent("track",f)})}var o=function(a){var l=this,h=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(f){l[f]=h[f].bind(h)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",a=JSON.parse(JSON.stringify(a||{})),this.usingBundle=a.bundlePolicy==="max-bundle",a.rtcpMuxPolicy==="negotiate")throw re("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require"),a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all";break}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced";break}if(a.iceServers=Yc(a.iceServers||[],e),this._iceGatherers=[],a.iceCandidatePoolSize)for(var u=a.iceCandidatePoolSize;u>0;u--)this._iceGatherers.push(new r.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy}));else a.iceCandidatePoolSize=0;this._config=a,this.transceivers=[],this._sdpSessionId=O.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(o.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(o.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),o.prototype.onicecandidate=null,o.prototype.onaddstream=null,o.prototype.ontrack=null,o.prototype.onremovestream=null,o.prototype.onsignalingstatechange=null,o.prototype.oniceconnectionstatechange=null,o.prototype.onconnectionstatechange=null,o.prototype.onicegatheringstatechange=null,o.prototype.onnegotiationneeded=null,o.prototype.ondatachannel=null,o.prototype._dispatchEvent=function(a,l){this._isClosed||(this.dispatchEvent(l),typeof this["on"+a]=="function"&&this["on"+a](l))},o.prototype._emitGatheringStateChange=function(){var a=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",a)},o.prototype.getConfiguration=function(){return this._config},o.prototype.getLocalStreams=function(){return this.localStreams},o.prototype.getRemoteStreams=function(){return this.remoteStreams},o.prototype._createTransceiver=function(a,l){var h=this.transceivers.length>0,u={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:a,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&h)u.iceTransport=this.transceivers[0].iceTransport,u.dtlsTransport=this.transceivers[0].dtlsTransport;else{var f=this._createIceAndDtlsTransports();u.iceTransport=f.iceTransport,u.dtlsTransport=f.dtlsTransport}return l||this.transceivers.push(u),u},o.prototype.addTrack=function(a,l){if(this._isClosed)throw re("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var h=this.transceivers.find(function(b){return b.track===a});if(h)throw re("InvalidAccessError","Track already exists.");for(var u,f=0;f<this.transceivers.length;f++)!this.transceivers[f].track&&this.transceivers[f].kind===a.kind&&(u=this.transceivers[f]);return u||(u=this._createTransceiver(a.kind)),this._maybeFireNegotiationNeeded(),this.localStreams.indexOf(l)===-1&&this.localStreams.push(l),u.track=a,u.stream=l,u.rtpSender=new r.RTCRtpSender(a,u.dtlsTransport),u.rtpSender},o.prototype.addStream=function(a){var l=this;if(e>=15025)a.getTracks().forEach(function(u){l.addTrack(u,a)});else{var h=a.clone();a.getTracks().forEach(function(u,f){var b=h.getTracks()[f];u.addEventListener("enabled",function(_){b.enabled=_.enabled})}),h.getTracks().forEach(function(u){l.addTrack(u,h)})}},o.prototype.removeTrack=function(a){if(this._isClosed)throw re("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(a instanceof r.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var l=this.transceivers.find(function(f){return f.rtpSender===a});if(!l)throw re("InvalidAccessError","Sender was not created by this connection.");var h=l.stream;l.rtpSender.stop(),l.rtpSender=null,l.track=null,l.stream=null;var u=this.transceivers.map(function(f){return f.stream});u.indexOf(h)===-1&&this.localStreams.indexOf(h)>-1&&this.localStreams.splice(this.localStreams.indexOf(h),1),this._maybeFireNegotiationNeeded()},o.prototype.removeStream=function(a){var l=this;a.getTracks().forEach(function(h){var u=l.getSenders().find(function(f){return f.track===h});u&&l.removeTrack(u)})},o.prototype.getSenders=function(){return this.transceivers.filter(function(a){return!!a.rtpSender}).map(function(a){return a.rtpSender})},o.prototype.getReceivers=function(){return this.transceivers.filter(function(a){return!!a.rtpReceiver}).map(function(a){return a.rtpReceiver})},o.prototype._createIceGatherer=function(a,l){var h=this;if(l&&a>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var u=new r.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(u,"state",{value:"new",writable:!0}),this.transceivers[a].bufferedCandidateEvents=[],this.transceivers[a].bufferCandidates=function(f){var b=!f.candidate||Object.keys(f.candidate).length===0;u.state=b?"completed":"gathering",h.transceivers[a].bufferedCandidateEvents!==null&&h.transceivers[a].bufferedCandidateEvents.push(f)},u.addEventListener("localcandidate",this.transceivers[a].bufferCandidates),u},o.prototype._gather=function(a,l){var h=this,u=this.transceivers[l].iceGatherer;if(!u.onlocalcandidate){var f=this.transceivers[l].bufferedCandidateEvents;this.transceivers[l].bufferedCandidateEvents=null,u.removeEventListener("localcandidate",this.transceivers[l].bufferCandidates),u.onlocalcandidate=function(b){if(!(h.usingBundle&&l>0)){var _=new Event("icecandidate");_.candidate={sdpMid:a,sdpMLineIndex:l};var x=b.candidate,M=!x||Object.keys(x).length===0;if(M)(u.state==="new"||u.state==="gathering")&&(u.state="completed");else{u.state==="new"&&(u.state="gathering"),x.component=1,x.ufrag=u.getLocalParameters().usernameFragment;var A=O.writeCandidate(x);_.candidate=Object.assign(_.candidate,O.parseCandidate(A)),_.candidate.candidate=A,_.candidate.toJSON=function(){return{candidate:_.candidate.candidate,sdpMid:_.candidate.sdpMid,sdpMLineIndex:_.candidate.sdpMLineIndex,usernameFragment:_.candidate.usernameFragment}}}var E=O.getMediaSections(h._localDescription.sdp);M?E[_.candidate.sdpMLineIndex]+=`a=end-of-candidates\r
`:E[_.candidate.sdpMLineIndex]+="a="+_.candidate.candidate+`\r
`,h._localDescription.sdp=O.getDescription(h._localDescription.sdp)+E.join("");var L=h.transceivers.every(function(U){return U.iceGatherer&&U.iceGatherer.state==="completed"});h.iceGatheringState!=="gathering"&&(h.iceGatheringState="gathering",h._emitGatheringStateChange()),M||h._dispatchEvent("icecandidate",_),L&&(h._dispatchEvent("icecandidate",new Event("icecandidate")),h.iceGatheringState="complete",h._emitGatheringStateChange())}},r.setTimeout(function(){f.forEach(function(b){u.onlocalcandidate(b)})},0)}},o.prototype._createIceAndDtlsTransports=function(){var a=this,l=new r.RTCIceTransport(null);l.onicestatechange=function(){a._updateIceConnectionState(),a._updateConnectionState()};var h=new r.RTCDtlsTransport(l);return h.ondtlsstatechange=function(){a._updateConnectionState()},h.onerror=function(){Object.defineProperty(h,"state",{value:"failed",writable:!0}),a._updateConnectionState()},{iceTransport:l,dtlsTransport:h}},o.prototype._disposeIceAndDtlsTransports=function(a){var l=this.transceivers[a].iceGatherer;l&&(delete l.onlocalcandidate,delete this.transceivers[a].iceGatherer);var h=this.transceivers[a].iceTransport;h&&(delete h.onicestatechange,delete this.transceivers[a].iceTransport);var u=this.transceivers[a].dtlsTransport;u&&(delete u.ondtlsstatechange,delete u.onerror,delete this.transceivers[a].dtlsTransport)},o.prototype._transceive=function(a,l,h){var u=et(a.localCapabilities,a.remoteCapabilities);l&&a.rtpSender&&(u.encodings=a.sendEncodingParameters,u.rtcp={cname:O.localCName,compound:a.rtcpParameters.compound},a.recvEncodingParameters.length&&(u.rtcp.ssrc=a.recvEncodingParameters[0].ssrc),a.rtpSender.send(u)),h&&a.rtpReceiver&&u.codecs.length>0&&(a.kind==="video"&&a.recvEncodingParameters&&e<15019&&a.recvEncodingParameters.forEach(function(f){delete f.rtx}),a.recvEncodingParameters.length?u.encodings=a.recvEncodingParameters:u.encodings=[{}],u.rtcp={compound:a.rtcpParameters.compound},a.rtcpParameters.cname&&(u.rtcp.cname=a.rtcpParameters.cname),a.sendEncodingParameters.length&&(u.rtcp.ssrc=a.sendEncodingParameters[0].ssrc),a.rtpReceiver.receive(u))},o.prototype.setLocalDescription=function(a){var l=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(re("TypeError",'Unsupported type "'+a.type+'"'));if(!Sr("setLocalDescription",a.type,l.signalingState)||l._isClosed)return Promise.reject(re("InvalidStateError","Can not set local "+a.type+" in state "+l.signalingState));var h,u;if(a.type==="offer")h=O.splitSections(a.sdp),u=h.shift(),h.forEach(function(b,_){var x=O.parseRtpParameters(b);l.transceivers[_].localCapabilities=x}),l.transceivers.forEach(function(b,_){l._gather(b.mid,_)});else if(a.type==="answer"){h=O.splitSections(l._remoteDescription.sdp),u=h.shift();var f=O.matchPrefix(u,"a=ice-lite").length>0;h.forEach(function(b,_){var x=l.transceivers[_],M=x.iceGatherer,A=x.iceTransport,E=x.dtlsTransport,L=x.localCapabilities,U=x.remoteCapabilities,P=O.isRejected(b)&&O.matchPrefix(b,"a=bundle-only").length===0;if(!P&&!x.rejected){var T=O.getIceParameters(b,u),S=O.getDtlsParameters(b,u);f&&(S.role="server"),(!l.usingBundle||_===0)&&(l._gather(x.mid,_),A.state==="new"&&A.start(M,T,f?"controlling":"controlled"),E.state==="new"&&E.start(S));var C=et(L,U);l._transceive(x,C.codecs.length>0,!1)}})}return l._localDescription={type:a.type,sdp:a.sdp},a.type==="offer"?l._updateSignalingState("have-local-offer"):l._updateSignalingState("stable"),Promise.resolve()},o.prototype.setRemoteDescription=function(a){var l=this;if(["offer","answer"].indexOf(a.type)===-1)return Promise.reject(re("TypeError",'Unsupported type "'+a.type+'"'));if(!Sr("setRemoteDescription",a.type,l.signalingState)||l._isClosed)return Promise.reject(re("InvalidStateError","Can not set remote "+a.type+" in state "+l.signalingState));var h={};l.remoteStreams.forEach(function(A){h[A.id]=A});var u=[],f=O.splitSections(a.sdp),b=f.shift(),_=O.matchPrefix(b,"a=ice-lite").length>0,x=O.matchPrefix(b,"a=group:BUNDLE ").length>0;l.usingBundle=x;var M=O.matchPrefix(b,"a=ice-options:")[0];return M?l.canTrickleIceCandidates=M.substr(14).split(" ").indexOf("trickle")>=0:l.canTrickleIceCandidates=!1,f.forEach(function(A,E){var L=O.splitLines(A),U=O.getKind(A),P=O.isRejected(A)&&O.matchPrefix(A,"a=bundle-only").length===0,T=L[0].substr(2).split(" ")[2],S=O.getDirection(A,b),C=O.parseMsid(A),$=O.getMid(A)||O.generateIdentifier();if(P||U==="application"&&(T==="DTLS/SCTP"||T==="UDP/DTLS/SCTP")){l.transceivers[E]={mid:$,kind:U,protocol:T,rejected:!0};return}!P&&l.transceivers[E]&&l.transceivers[E].rejected&&(l.transceivers[E]=l._createTransceiver(U,!0));var w,I,N,ie,V,Se,ce,ke,Ce,Yt=O.parseRtpParameters(A),Xt,vt;P||(Xt=O.getIceParameters(A,b),vt=O.getDtlsParameters(A,b),vt.role="client"),ce=O.parseRtpEncodingParameters(A);var Qt=O.parseRtcpParameters(A),Zt=O.matchPrefix(A,"a=end-of-candidates",b).length>0,Pe=O.matchPrefix(A,"a=candidate:").map(function(le){return O.parseCandidate(le)}).filter(function(le){return le.component===1});if((a.type==="offer"||a.type==="answer")&&!P&&x&&E>0&&l.transceivers[E]&&(l._disposeIceAndDtlsTransports(E),l.transceivers[E].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[E].iceTransport=l.transceivers[0].iceTransport,l.transceivers[E].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[E].rtpSender&&l.transceivers[E].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[E].rtpReceiver&&l.transceivers[E].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),a.type==="offer"&&!P){w=l.transceivers[E]||l._createTransceiver(U),w.mid=$,w.iceGatherer||(w.iceGatherer=l._createIceGatherer(E,x)),Pe.length&&w.iceTransport.state==="new"&&(Zt&&(!x||E===0)?w.iceTransport.setRemoteCandidates(Pe):Pe.forEach(function(le){Ct(w.iceTransport,le)})),ke=r.RTCRtpReceiver.getCapabilities(U),e<15019&&(ke.codecs=ke.codecs.filter(function(le){return le.name!=="rtx"})),Se=w.sendEncodingParameters||[{ssrc:(2*E+2)*1001}];var yt=!1;if(S==="sendrecv"||S==="sendonly"){if(yt=!w.rtpReceiver,V=w.rtpReceiver||new r.RTCRtpReceiver(w.dtlsTransport,U),yt){var Ae;Ce=V.track,C&&C.stream==="-"||(C?(h[C.stream]||(h[C.stream]=new r.MediaStream,Object.defineProperty(h[C.stream],"id",{get:function(){return C.stream}})),Object.defineProperty(Ce,"id",{get:function(){return C.track}}),Ae=h[C.stream]):(h.default||(h.default=new r.MediaStream),Ae=h.default)),Ae&&(t(Ce,Ae),w.associatedRemoteMediaStreams.push(Ae)),u.push([Ce,V,Ae])}}else w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach(function(le){var er=le.getTracks().find(function(ss){return ss.id===w.rtpReceiver.track.id});er&&n(er,le)}),w.associatedRemoteMediaStreams=[]);w.localCapabilities=ke,w.remoteCapabilities=Yt,w.rtpReceiver=V,w.rtcpParameters=Qt,w.sendEncodingParameters=Se,w.recvEncodingParameters=ce,l._transceive(l.transceivers[E],!1,yt)}else if(a.type==="answer"&&!P){w=l.transceivers[E],I=w.iceGatherer,N=w.iceTransport,ie=w.dtlsTransport,V=w.rtpReceiver,Se=w.sendEncodingParameters,ke=w.localCapabilities,l.transceivers[E].recvEncodingParameters=ce,l.transceivers[E].remoteCapabilities=Yt,l.transceivers[E].rtcpParameters=Qt,Pe.length&&N.state==="new"&&((_||Zt)&&(!x||E===0)?N.setRemoteCandidates(Pe):Pe.forEach(function(le){Ct(w.iceTransport,le)})),(!x||E===0)&&(N.state==="new"&&N.start(I,Xt,"controlling"),ie.state==="new"&&ie.start(vt));var rs=et(w.localCapabilities,w.remoteCapabilities),ns=rs.codecs.filter(function(le){return le.name.toLowerCase()==="rtx"}).length;!ns&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,l._transceive(w,S==="sendrecv"||S==="recvonly",S==="sendrecv"||S==="sendonly"),V&&(S==="sendrecv"||S==="sendonly")?(Ce=V.track,C?(h[C.stream]||(h[C.stream]=new r.MediaStream),t(Ce,h[C.stream]),u.push([Ce,V,h[C.stream]])):(h.default||(h.default=new r.MediaStream),t(Ce,h.default),u.push([Ce,V,h.default]))):delete w.rtpReceiver}}),l._dtlsRole===void 0&&(l._dtlsRole=a.type==="offer"?"active":"passive"),l._remoteDescription={type:a.type,sdp:a.sdp},a.type==="offer"?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(h).forEach(function(A){var E=h[A];if(E.getTracks().length){if(l.remoteStreams.indexOf(E)===-1){l.remoteStreams.push(E);var L=new Event("addstream");L.stream=E,r.setTimeout(function(){l._dispatchEvent("addstream",L)})}u.forEach(function(U){var P=U[0],T=U[1];E.id===U[2].id&&s(l,P,T,[E])})}}),u.forEach(function(A){A[2]||s(l,A[0],A[1],[])}),r.setTimeout(function(){l&&l.transceivers&&l.transceivers.forEach(function(A){A.iceTransport&&A.iceTransport.state==="new"&&A.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),A.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},o.prototype.close=function(){this.transceivers.forEach(function(a){a.iceTransport&&a.iceTransport.stop(),a.dtlsTransport&&a.dtlsTransport.stop(),a.rtpSender&&a.rtpSender.stop(),a.rtpReceiver&&a.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},o.prototype._updateSignalingState=function(a){this.signalingState=a;var l=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",l)},o.prototype._maybeFireNegotiationNeeded=function(){var a=this;this.signalingState!=="stable"||this.needNegotiation===!0||(this.needNegotiation=!0,r.setTimeout(function(){if(a.needNegotiation){a.needNegotiation=!1;var l=new Event("negotiationneeded");a._dispatchEvent("negotiationneeded",l)}},0))},o.prototype._updateIceConnectionState=function(){var a,l={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&!u.rejected&&l[u.iceTransport.state]++}),a="new",l.failed>0?a="failed":l.checking>0?a="checking":l.disconnected>0?a="disconnected":l.new>0?a="new":l.connected>0?a="connected":l.completed>0&&(a="completed"),a!==this.iceConnectionState){this.iceConnectionState=a;var h=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",h)}},o.prototype._updateConnectionState=function(){var a,l={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(u){u.iceTransport&&u.dtlsTransport&&!u.rejected&&(l[u.iceTransport.state]++,l[u.dtlsTransport.state]++)}),l.connected+=l.completed,a="new",l.failed>0?a="failed":l.connecting>0?a="connecting":l.disconnected>0?a="disconnected":l.new>0?a="new":l.connected>0&&(a="connected"),a!==this.connectionState){this.connectionState=a;var h=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",h)}},o.prototype.createOffer=function(){var a=this;if(a._isClosed)return Promise.reject(re("InvalidStateError","Can not call createOffer after close"));var l=a.transceivers.filter(function(_){return _.kind==="audio"}).length,h=a.transceivers.filter(function(_){return _.kind==="video"}).length,u=arguments[0];if(u){if(u.mandatory||u.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");u.offerToReceiveAudio!==void 0&&(u.offerToReceiveAudio===!0?l=1:u.offerToReceiveAudio===!1?l=0:l=u.offerToReceiveAudio),u.offerToReceiveVideo!==void 0&&(u.offerToReceiveVideo===!0?h=1:u.offerToReceiveVideo===!1?h=0:h=u.offerToReceiveVideo)}for(a.transceivers.forEach(function(_){_.kind==="audio"?(l--,l<0&&(_.wantReceive=!1)):_.kind==="video"&&(h--,h<0&&(_.wantReceive=!1))});l>0||h>0;)l>0&&(a._createTransceiver("audio"),l--),h>0&&(a._createTransceiver("video"),h--);var f=O.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.transceivers.forEach(function(_,x){var M=_.track,A=_.kind,E=_.mid||O.generateIdentifier();_.mid=E,_.iceGatherer||(_.iceGatherer=a._createIceGatherer(x,a.usingBundle));var L=r.RTCRtpSender.getCapabilities(A);e<15019&&(L.codecs=L.codecs.filter(function(P){return P.name!=="rtx"})),L.codecs.forEach(function(P){P.name==="H264"&&P.parameters["level-asymmetry-allowed"]===void 0&&(P.parameters["level-asymmetry-allowed"]="1"),_.remoteCapabilities&&_.remoteCapabilities.codecs&&_.remoteCapabilities.codecs.forEach(function(T){P.name.toLowerCase()===T.name.toLowerCase()&&P.clockRate===T.clockRate&&(P.preferredPayloadType=T.payloadType)})}),L.headerExtensions.forEach(function(P){var T=_.remoteCapabilities&&_.remoteCapabilities.headerExtensions||[];T.forEach(function(S){P.uri===S.uri&&(P.id=S.id)})});var U=_.sendEncodingParameters||[{ssrc:(2*x+1)*1001}];M&&e>=15019&&A==="video"&&!U[0].rtx&&(U[0].rtx={ssrc:U[0].ssrc+1}),_.wantReceive&&(_.rtpReceiver=new r.RTCRtpReceiver(_.dtlsTransport,A)),_.localCapabilities=L,_.sendEncodingParameters=U}),a._config.bundlePolicy!=="max-compat"&&(f+="a=group:BUNDLE "+a.transceivers.map(function(_){return _.mid}).join(" ")+`\r
`),f+=`a=ice-options:trickle\r
`,a.transceivers.forEach(function(_,x){f+=xr(_,_.localCapabilities,"offer",_.stream,a._dtlsRole),f+=`a=rtcp-rsize\r
`,_.iceGatherer&&a.iceGatheringState!=="new"&&(x===0||!a.usingBundle)&&(_.iceGatherer.getLocalCandidates().forEach(function(M){M.component=1,f+="a="+O.writeCandidate(M)+`\r
`}),_.iceGatherer.state==="completed"&&(f+=`a=end-of-candidates\r
`))});var b=new r.RTCSessionDescription({type:"offer",sdp:f});return Promise.resolve(b)},o.prototype.createAnswer=function(){var a=this;if(a._isClosed)return Promise.reject(re("InvalidStateError","Can not call createAnswer after close"));if(!(a.signalingState==="have-remote-offer"||a.signalingState==="have-local-pranswer"))return Promise.reject(re("InvalidStateError","Can not call createAnswer in signalingState "+a.signalingState));var l=O.writeSessionBoilerplate(a._sdpSessionId,a._sdpSessionVersion++);a.usingBundle&&(l+="a=group:BUNDLE "+a.transceivers.map(function(f){return f.mid}).join(" ")+`\r
`),l+=`a=ice-options:trickle\r
`;var h=O.getMediaSections(a._remoteDescription.sdp).length;a.transceivers.forEach(function(f,b){if(!(b+1>h)){if(f.rejected){f.kind==="application"?f.protocol==="DTLS/SCTP"?l+=`m=application 0 DTLS/SCTP 5000\r
`:l+="m=application 0 "+f.protocol+` webrtc-datachannel\r
`:f.kind==="audio"?l+=`m=audio 0 UDP/TLS/RTP/SAVPF 0\r
a=rtpmap:0 PCMU/8000\r
`:f.kind==="video"&&(l+=`m=video 0 UDP/TLS/RTP/SAVPF 120\r
a=rtpmap:120 VP8/90000\r
`),l+=`c=IN IP4 0.0.0.0\r
a=inactive\r
a=mid:`+f.mid+`\r
`;return}if(f.stream){var _;f.kind==="audio"?_=f.stream.getAudioTracks()[0]:f.kind==="video"&&(_=f.stream.getVideoTracks()[0]),_&&e>=15019&&f.kind==="video"&&!f.sendEncodingParameters[0].rtx&&(f.sendEncodingParameters[0].rtx={ssrc:f.sendEncodingParameters[0].ssrc+1})}var x=et(f.localCapabilities,f.remoteCapabilities),M=x.codecs.filter(function(A){return A.name.toLowerCase()==="rtx"}).length;!M&&f.sendEncodingParameters[0].rtx&&delete f.sendEncodingParameters[0].rtx,l+=xr(f,x,"answer",f.stream,a._dtlsRole),f.rtcpParameters&&f.rtcpParameters.reducedSize&&(l+=`a=rtcp-rsize\r
`)}});var u=new r.RTCSessionDescription({type:"answer",sdp:l});return Promise.resolve(u)},o.prototype.addIceCandidate=function(a){var l=this,h;return a&&!(a.sdpMLineIndex!==void 0||a.sdpMid)?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(u,f){if(l._remoteDescription)if(!a||a.candidate==="")for(var b=0;b<l.transceivers.length&&!(!l.transceivers[b].rejected&&(l.transceivers[b].iceTransport.addRemoteCandidate({}),h=O.getMediaSections(l._remoteDescription.sdp),h[b]+=`a=end-of-candidates\r
`,l._remoteDescription.sdp=O.getDescription(l._remoteDescription.sdp)+h.join(""),l.usingBundle));b++);else{var _=a.sdpMLineIndex;if(a.sdpMid){for(var x=0;x<l.transceivers.length;x++)if(l.transceivers[x].mid===a.sdpMid){_=x;break}}var M=l.transceivers[_];if(M){if(M.rejected)return u();var A=Object.keys(a.candidate).length>0?O.parseCandidate(a.candidate):{};if(A.protocol==="tcp"&&(A.port===0||A.port===9)||A.component&&A.component!==1)return u();if((_===0||_>0&&M.iceTransport!==l.transceivers[0].iceTransport)&&!Ct(M.iceTransport,A))return f(re("OperationError","Can not add ICE candidate"));var E=a.candidate.trim();E.indexOf("a=")===0&&(E=E.substr(2)),h=O.getMediaSections(l._remoteDescription.sdp),h[_]+="a="+(A.type?E:"end-of-candidates")+`\r
`,l._remoteDescription.sdp=O.getDescription(l._remoteDescription.sdp)+h.join("")}else return f(re("OperationError","Can not add ICE candidate"))}else return f(re("InvalidStateError","Can not add ICE candidate without a remote description"));u()})},o.prototype.getStats=function(a){if(a&&a instanceof r.MediaStreamTrack){var l=null;if(this.transceivers.forEach(function(u){u.rtpSender&&u.rtpSender.track===a?l=u.rtpSender:u.rtpReceiver&&u.rtpReceiver.track===a&&(l=u.rtpReceiver)}),!l)throw re("InvalidAccessError","Invalid selector.");return l.getStats()}var h=[];return this.transceivers.forEach(function(u){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(f){u[f]&&h.push(u[f].getStats())})}),Promise.all(h).then(function(u){var f=new Map;return u.forEach(function(b){b.forEach(function(_){f.set(_.id,_)})}),f})};var i=["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"];i.forEach(function(a){var l=r[a];if(l&&l.prototype&&l.prototype.getStats){var h=l.prototype.getStats;l.prototype.getStats=function(){return h.apply(this).then(function(u){var f=new Map;return Object.keys(u).forEach(function(b){u[b].type=Kc(u[b]),f.set(b,u[b])}),f})}}});var c=["createOffer","createAnswer"];return c.forEach(function(a){var l=o.prototype[a];o.prototype[a]=function(){var h=arguments;return typeof h[0]=="function"||typeof h[1]=="function"?l.apply(this,[arguments[2]]).then(function(u){typeof h[0]=="function"&&h[0].apply(null,[u])},function(u){typeof h[1]=="function"&&h[1].apply(null,[u])}):l.apply(this,arguments)}}),c=["setLocalDescription","setRemoteDescription","addIceCandidate"],c.forEach(function(a){var l=o.prototype[a];o.prototype[a]=function(){var h=arguments;return typeof h[1]=="function"||typeof h[2]=="function"?l.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)},function(u){typeof h[2]=="function"&&h[2].apply(null,[u])}):l.apply(this,arguments)}}),["getStats"].forEach(function(a){var l=o.prototype[a];o.prototype[a]=function(){var h=arguments;return typeof h[1]=="function"?l.apply(this,arguments).then(function(){typeof h[1]=="function"&&h[1].apply(null)}):l.apply(this,arguments)}}),o};const Qc=ut(Xc);function En(r){const e=r&&r.navigator,t=function(s){return{name:{PermissionDeniedError:"NotAllowedError"}[s.name]||s.name,message:s.message,constraint:s.constraint,toString(){return this.name}}},n=e.mediaDevices.getUserMedia.bind(e.mediaDevices);e.mediaDevices.getUserMedia=function(s){return n(s).catch(o=>Promise.reject(t(o)))}}function Pn(r){"getDisplayMedia"in r.navigator&&r.navigator.mediaDevices&&(r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||(r.navigator.mediaDevices.getDisplayMedia=r.navigator.getDisplayMedia.bind(r.navigator)))}function It(r,e){if(r.RTCIceGatherer&&(r.RTCIceCandidate||(r.RTCIceCandidate=function(s){return s}),r.RTCSessionDescription||(r.RTCSessionDescription=function(s){return s}),e.version<15025)){const n=Object.getOwnPropertyDescriptor(r.MediaStreamTrack.prototype,"enabled");Object.defineProperty(r.MediaStreamTrack.prototype,"enabled",{set(s){n.set.call(this,s);const o=new Event("enabled");o.enabled=s,this.dispatchEvent(o)}})}r.RTCRtpSender&&!("dtmf"in r.RTCRtpSender.prototype)&&Object.defineProperty(r.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=new r.RTCDtmfSender(this):this.track.kind==="video"&&(this._dtmf=null)),this._dtmf}}),r.RTCDtmfSender&&!r.RTCDTMFSender&&(r.RTCDTMFSender=r.RTCDtmfSender);const t=Qc(r,e.version);r.RTCPeerConnection=function(s){return s&&s.iceServers&&(s.iceServers=Jc(s.iceServers,e.version),Vt("ICE servers after filtering:",s.iceServers)),new t(s)},r.RTCPeerConnection.prototype=t.prototype}function An(r){r.RTCRtpSender&&!("replaceTrack"in r.RTCRtpSender.prototype)&&(r.RTCRtpSender.prototype.replaceTrack=r.RTCRtpSender.prototype.setTrack)}const Tr=Object.freeze(Object.defineProperty({__proto__:null,shimGetDisplayMedia:Pn,shimGetUserMedia:En,shimPeerConnection:It,shimReplaceTrack:An},Symbol.toStringTag,{value:"Module"}));function In(r,e){const t=r&&r.navigator,n=r&&r.MediaStreamTrack;if(t.getUserMedia=function(s,o,i){_t("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),t.mediaDevices.getUserMedia(s).then(o,i)},!(e.version>55&&"autoGainControl"in t.mediaDevices.getSupportedConstraints())){const s=function(i,c,a){c in i&&!(a in i)&&(i[a]=i[c],delete i[c])},o=t.mediaDevices.getUserMedia.bind(t.mediaDevices);if(t.mediaDevices.getUserMedia=function(i){return typeof i=="object"&&typeof i.audio=="object"&&(i=JSON.parse(JSON.stringify(i)),s(i.audio,"autoGainControl","mozAutoGainControl"),s(i.audio,"noiseSuppression","mozNoiseSuppression")),o(i)},n&&n.prototype.getSettings){const i=n.prototype.getSettings;n.prototype.getSettings=function(){const c=i.apply(this,arguments);return s(c,"mozAutoGainControl","autoGainControl"),s(c,"mozNoiseSuppression","noiseSuppression"),c}}if(n&&n.prototype.applyConstraints){const i=n.prototype.applyConstraints;n.prototype.applyConstraints=function(c){return this.kind==="audio"&&typeof c=="object"&&(c=JSON.parse(JSON.stringify(c)),s(c,"autoGainControl","mozAutoGainControl"),s(c,"noiseSuppression","mozNoiseSuppression")),i.apply(this,[c])}}}}function Zc(r,e){r.navigator.mediaDevices&&"getDisplayMedia"in r.navigator.mediaDevices||r.navigator.mediaDevices&&(r.navigator.mediaDevices.getDisplayMedia=function(n){if(!(n&&n.video)){const s=new DOMException("getDisplayMedia without video constraints is undefined");return s.name="NotFoundError",s.code=8,Promise.reject(s)}return n.video===!0?n.video={mediaSource:e}:n.video.mediaSource=e,r.navigator.mediaDevices.getUserMedia(n)})}function On(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Ot(r,e){if(typeof r!="object"||!(r.RTCPeerConnection||r.mozRTCPeerConnection))return;!r.RTCPeerConnection&&r.mozRTCPeerConnection&&(r.RTCPeerConnection=r.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const o=r.RTCPeerConnection.prototype[s],i={[s](){return arguments[0]=new(s==="addIceCandidate"?r.RTCIceCandidate:r.RTCSessionDescription)(arguments[0]),o.apply(this,arguments)}};r.RTCPeerConnection.prototype[s]=i[s]});const t={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=r.RTCPeerConnection.prototype.getStats;r.RTCPeerConnection.prototype.getStats=function(){const[o,i,c]=arguments;return n.apply(this,[o||null]).then(a=>{if(e.version<53&&!i)try{a.forEach(l=>{l.type=t[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;a.forEach((h,u)=>{a.set(u,Object.assign({},h,{type:t[h.type]||h.type}))})}return a}).then(i,c)}}function Dn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpSender.prototype)return;const e=r.RTCPeerConnection.prototype.getSenders;e&&(r.RTCPeerConnection.prototype.getSenders=function(){const s=e.apply(this,[]);return s.forEach(o=>o._pc=this),s});const t=r.RTCPeerConnection.prototype.addTrack;t&&(r.RTCPeerConnection.prototype.addTrack=function(){const s=t.apply(this,arguments);return s._pc=this,s}),r.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function Bn(r){if(!(typeof r=="object"&&r.RTCPeerConnection&&r.RTCRtpSender)||r.RTCRtpSender&&"getStats"in r.RTCRtpReceiver.prototype)return;const e=r.RTCPeerConnection.prototype.getReceivers;e&&(r.RTCPeerConnection.prototype.getReceivers=function(){const n=e.apply(this,[]);return n.forEach(s=>s._pc=this),n}),$e(r,"track",t=>(t.receiver._pc=t.srcElement,t)),r.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function $n(r){!r.RTCPeerConnection||"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(t){_t("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function Nn(r){r.DataChannel&&!r.RTCDataChannel&&(r.RTCDataChannel=r.DataChannel)}function Mn(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const e=r.RTCPeerConnection.prototype.addTransceiver;e&&(r.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const n=arguments[1],s=n&&"sendEncodings"in n;s&&n.sendEncodings.forEach(i=>{if("rid"in i&&!/^[a-z0-9]{0,16}$/i.test(i.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in i&&!(parseFloat(i.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in i&&!(parseFloat(i.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=e.apply(this,arguments);if(s){const{sender:i}=o,c=i.getParameters();(!("encodings"in c)||c.encodings.length===1&&Object.keys(c.encodings[0]).length===0)&&(c.encodings=n.sendEncodings,i.sendEncodings=n.sendEncodings,this.setParametersPromises.push(i.setParameters(c).then(()=>{delete i.sendEncodings}).catch(()=>{delete i.sendEncodings})))}return o})}function jn(r){if(!(typeof r=="object"&&r.RTCRtpSender))return;const e=r.RTCRtpSender.prototype.getParameters;e&&(r.RTCRtpSender.prototype.getParameters=function(){const n=e.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function Fn(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const e=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}function Ln(r){if(!(typeof r=="object"&&r.RTCPeerConnection))return;const e=r.RTCPeerConnection.prototype.createAnswer;r.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>e.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):e.apply(this,arguments)}}const Rr=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:Mn,shimCreateAnswer:Ln,shimCreateOffer:Fn,shimGetDisplayMedia:Zc,shimGetParameters:jn,shimGetUserMedia:In,shimOnTrack:On,shimPeerConnection:Ot,shimRTCDataChannel:Nn,shimReceiverGetStats:Bn,shimRemoveStream:$n,shimSenderGetStats:Dn},Symbol.toStringTag,{value:"Module"}));function Un(r){if(!(typeof r!="object"||!r.RTCPeerConnection)){if("getLocalStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in r.RTCPeerConnection.prototype)){const e=r.RTCPeerConnection.prototype.addTrack;r.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(s=>e.call(this,s,n)),n.getVideoTracks().forEach(s=>e.call(this,s,n))},r.RTCPeerConnection.prototype.addTrack=function(n,...s){return s&&s.forEach(o=>{this._localStreams?this._localStreams.includes(o)||this._localStreams.push(o):this._localStreams=[o]}),e.apply(this,arguments)}}"removeStream"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const s=t.getTracks();this.getSenders().forEach(o=>{s.includes(o.track)&&this.removeTrack(o)})})}}function Hn(r){if(!(typeof r!="object"||!r.RTCPeerConnection)&&("getRemoteStreams"in r.RTCPeerConnection.prototype||(r.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in r.RTCPeerConnection.prototype))){Object.defineProperty(r.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=n=>{n.streams.forEach(s=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(s))return;this._remoteStreams.push(s);const o=new Event("addstream");o.stream=s,this.dispatchEvent(o)})})}});const e=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(s){s.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const i=new Event("addstream");i.stream=o,n.dispatchEvent(i)})}),e.apply(n,arguments)}}}function zn(r){if(typeof r!="object"||!r.RTCPeerConnection)return;const e=r.RTCPeerConnection.prototype,t=e.createOffer,n=e.createAnswer,s=e.setLocalDescription,o=e.setRemoteDescription,i=e.addIceCandidate;e.createOffer=function(l,h){const u=arguments.length>=2?arguments[2]:arguments[0],f=t.apply(this,[u]);return h?(f.then(l,h),Promise.resolve()):f},e.createAnswer=function(l,h){const u=arguments.length>=2?arguments[2]:arguments[0],f=n.apply(this,[u]);return h?(f.then(l,h),Promise.resolve()):f};let c=function(a,l,h){const u=s.apply(this,[a]);return h?(u.then(l,h),Promise.resolve()):u};e.setLocalDescription=c,c=function(a,l,h){const u=o.apply(this,[a]);return h?(u.then(l,h),Promise.resolve()):u},e.setRemoteDescription=c,c=function(a,l,h){const u=i.apply(this,[a]);return h?(u.then(l,h),Promise.resolve()):u},e.addIceCandidate=c}function qn(r){const e=r&&r.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=s=>n(Wn(s))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(n,s,o){e.mediaDevices.getUserMedia(n).then(s,o)}.bind(e))}function Wn(r){return r&&r.video!==void 0?Object.assign({},r,{video:gn(r.video)}):r}function Vn(r){if(!r.RTCPeerConnection)return;const e=r.RTCPeerConnection;r.RTCPeerConnection=function(n,s){if(n&&n.iceServers){const o=[];for(let i=0;i<n.iceServers.length;i++){let c=n.iceServers[i];!c.hasOwnProperty("urls")&&c.hasOwnProperty("url")?(_t("RTCIceServer.url","RTCIceServer.urls"),c=JSON.parse(JSON.stringify(c)),c.urls=c.url,delete c.url,o.push(c)):o.push(n.iceServers[i])}n.iceServers=o}return new e(n,s)},r.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(r.RTCPeerConnection,"generateCertificate",{get(){return e.generateCertificate}})}function Gn(r){typeof r=="object"&&r.RTCTrackEvent&&"receiver"in r.RTCTrackEvent.prototype&&!("transceiver"in r.RTCTrackEvent.prototype)&&Object.defineProperty(r.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Jn(r){const e=r.RTCPeerConnection.prototype.createOffer;r.RTCPeerConnection.prototype.createOffer=function(n){if(n){typeof n.offerToReceiveAudio<"u"&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const s=this.getTransceivers().find(i=>i.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&s?s.direction==="sendrecv"?s.setDirection?s.setDirection("sendonly"):s.direction="sendonly":s.direction==="recvonly"&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive"):n.offerToReceiveAudio===!0&&!s&&this.addTransceiver("audio"),typeof n.offerToReceiveVideo<"u"&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(i=>i.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo===!0&&!o&&this.addTransceiver("video")}return e.apply(this,arguments)}}function Kn(r){typeof r!="object"||r.AudioContext||(r.AudioContext=r.webkitAudioContext)}const Er=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:Kn,shimCallbacksAPI:zn,shimConstraints:Wn,shimCreateOfferLegacy:Jn,shimGetUserMedia:qn,shimLocalStreamsAPI:Un,shimRTCIceServerUrls:Vn,shimRemoteStreamsAPI:Hn,shimTrackEventTransceiver:Gn},Symbol.toStringTag,{value:"Module"}));function it(r){if(!r.RTCIceCandidate||r.RTCIceCandidate&&"foundation"in r.RTCIceCandidate.prototype)return;const e=r.RTCIceCandidate;r.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&(n=JSON.parse(JSON.stringify(n)),n.candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const s=new e(n),o=ot.parseCandidate(n.candidate),i=Object.assign(s,o);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new e(n)},r.RTCIceCandidate.prototype=e.prototype,$e(r,"icecandidate",t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new r.RTCIceCandidate(t.candidate),writable:"false"}),t))}function He(r,e){if(!r.RTCPeerConnection)return;"sctp"in r.RTCPeerConnection.prototype||Object.defineProperty(r.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const t=function(c){if(!c||!c.sdp)return!1;const a=ot.splitSections(c.sdp);return a.shift(),a.some(l=>{const h=ot.parseMLine(l);return h&&h.kind==="application"&&h.protocol.indexOf("SCTP")!==-1})},n=function(c){const a=c.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(a===null||a.length<2)return-1;const l=parseInt(a[1],10);return l!==l?-1:l},s=function(c){let a=65536;return e.browser==="firefox"&&(e.version<57?c===-1?a=16384:a=2147483637:e.version<60?a=e.version===57?65535:65536:a=2147483637),a},o=function(c,a){let l=65536;e.browser==="firefox"&&e.version===57&&(l=65535);const h=ot.matchPrefix(c.sdp,"a=max-message-size:");return h.length>0?l=parseInt(h[0].substr(19),10):e.browser==="firefox"&&a!==-1&&(l=2147483637),l},i=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,e.browser==="chrome"&&e.version>=76){const{sdpSemantics:a}=this.getConfiguration();a==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(t(arguments[0])){const a=n(arguments[0]),l=s(a),h=o(arguments[0],a);let u;l===0&&h===0?u=Number.POSITIVE_INFINITY:l===0||h===0?u=Math.max(l,h):u=Math.min(l,h);const f={};Object.defineProperty(f,"maxMessageSize",{get(){return u}}),this._sctp=f}return i.apply(this,arguments)}}function ze(r){if(!(r.RTCPeerConnection&&"createDataChannel"in r.RTCPeerConnection.prototype))return;function e(n,s){const o=n.send;n.send=function(){const c=arguments[0],a=c.length||c.size||c.byteLength;if(n.readyState==="open"&&s.sctp&&a>s.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+s.sctp.maxMessageSize+" bytes)");return o.apply(n,arguments)}}const t=r.RTCPeerConnection.prototype.createDataChannel;r.RTCPeerConnection.prototype.createDataChannel=function(){const s=t.apply(this,arguments);return e(s,this),s},$e(r,"datachannel",n=>(e(n.channel,n.target),n))}function Dt(r){if(!r.RTCPeerConnection||"connectionState"in r.RTCPeerConnection.prototype)return;const e=r.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=s=>{const o=s.target;if(o._lastConnectionState!==o.connectionState){o._lastConnectionState=o.connectionState;const i=new Event("connectionstatechange",s);o.dispatchEvent(i)}return s},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}})}function Bt(r,e){if(!r.RTCPeerConnection||e.browser==="chrome"&&e.version>=71||e.browser==="safari"&&e.version>=605)return;const t=r.RTCPeerConnection.prototype.setRemoteDescription;r.RTCPeerConnection.prototype.setRemoteDescription=function(s){if(s&&s.sdp&&s.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=s.sdp.split(`
`).filter(i=>i.trim()!=="a=extmap-allow-mixed").join(`
`);r.RTCSessionDescription&&s instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:s.type,sdp:o}):s.sdp=o}return t.apply(this,arguments)}}function at(r,e){if(!(r.RTCPeerConnection&&r.RTCPeerConnection.prototype))return;const t=r.RTCPeerConnection.prototype.addIceCandidate;!t||t.length===0||(r.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(e.browser==="chrome"&&e.version<78||e.browser==="firefox"&&e.version<68||e.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}const el=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:Bt,shimAddIceCandidateNullOrEmpty:at,shimConnectionState:Dt,shimMaxMessageSize:He,shimRTCIceCandidate:it,shimSendThrowTypeError:ze},Symbol.toStringTag,{value:"Module"}));function tl({window:r}={},e={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0}){const t=Vt,n=Vc(r),s={browserDetails:n,commonShim:el,extractVersion:Ue,disableLog:qc,disableWarnings:Wc};switch(n.browser){case"chrome":if(!wr||!At||!e.shimChrome)return t("Chrome shim is not included in this adapter release."),s;if(n.version===null)return t("Chrome shim can not determine version, not shimming."),s;t("adapter.js shimming chrome."),s.browserShim=wr,at(r,n),_n(r,n),vn(r),At(r,n),yn(r),xn(r,n),bn(r),kn(r),Cn(r),Sn(r,n),it(r),Dt(r),He(r,n),ze(r),Bt(r,n);break;case"firefox":if(!Rr||!Ot||!e.shimFirefox)return t("Firefox shim is not included in this adapter release."),s;t("adapter.js shimming firefox."),s.browserShim=Rr,at(r,n),In(r,n),Ot(r,n),On(r),$n(r),Dn(r),Bn(r),Nn(r),Mn(r),jn(r),Fn(r),Ln(r),it(r),Dt(r),He(r,n),ze(r);break;case"edge":if(!Tr||!It||!e.shimEdge)return t("MS edge shim is not included in this adapter release."),s;t("adapter.js shimming edge."),s.browserShim=Tr,En(r),Pn(r),It(r,n),An(r),He(r,n),ze(r);break;case"safari":if(!Er||!e.shimSafari)return t("Safari shim is not included in this adapter release."),s;t("adapter.js shimming safari."),s.browserShim=Er,at(r,n),Vn(r),Jn(r),zn(r),Un(r),Hn(r),Gn(r),qn(r),Kn(r),it(r),He(r,n),ze(r),Bt(r,n);break;default:t("Unsupported browser!");break}return s}const Pr=tl({window:typeof window>"u"?void 0:window});function be(r,e,t,n){Object.defineProperty(r,e,{get:t,set:n,enumerable:!0,configurable:!0})}var wt=Pr.default||Pr,Me=new(function(){function r(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return r.prototype.isWebRTCSupported=function(){return typeof RTCPeerConnection<"u"},r.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion(),n=this.supportedBrowsers.includes(e);return n?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1},r.prototype.getBrowser=function(){return wt.browserDetails.browser},r.prototype.getVersion=function(){return wt.browserDetails.version||0},r.prototype.isUnifiedPlanSupported=function(){var e=this.getBrowser(),t=wt.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n,s=!1;try{n=new RTCPeerConnection,n.addTransceiver("audio"),s=!0}catch{}finally{n&&n.close()}return s},r.prototype.toString=function(){return`Supports:
    browser:`.concat(this.getBrowser(),`
    version:`).concat(this.getVersion(),`
    isIOS:`).concat(this.isIOS,`
    isWebRTCSupported:`).concat(this.isWebRTCSupported(),`
    isBrowserSupported:`).concat(this.isBrowserSupported(),`
    isUnifiedPlanSupported:`).concat(this.isUnifiedPlanSupported())},r}()),Ar={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"},rl=function(){function r(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=Ar,this.browser=Me.getBrowser(),this.browserVersion=Me.getVersion(),this.supports=function(){var e={browser:Me.isBrowserSupported(),webRTC:Me.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!e.webRTC)return e;var t;try{t=new RTCPeerConnection(Ar),e.audioVideo=!0;var n=void 0;try{n=t.createDataChannel("_PEERJSTEST",{ordered:!0}),e.data=!0,e.reliable=!!n.ordered;try{n.binaryType="blob",e.binaryBlob=!Me.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{t&&t.close()}return e}(),this.pack=yr.pack,this.unpack=yr.unpack,this._dataCount=1}return r.prototype.noop=function(){},r.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},r.prototype.chunk=function(e){for(var t=[],n=e.size,s=Math.ceil(n/F.chunkedMTU),o=0,i=0;i<n;){var c=Math.min(n,i+F.chunkedMTU),a=e.slice(i,c),l={__peerData:this._dataCount,n:o,data:a,total:s};t.push(l),i=c,o++}return this._dataCount++,t},r.prototype.blobToArrayBuffer=function(e,t){var n=new FileReader;return n.onload=function(s){s.target&&t(s.target.result)},n.readAsArrayBuffer(e),n},r.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n)&255;return t.buffer},r.prototype.randomToken=function(){return Math.random().toString(36).slice(2)},r.prototype.isSecure=function(){return location.protocol==="https:"},r}(),F=new rl,Yn={};be(Yn,"Peer",()=>Ur,r=>Ur=r);var Ye={},nl=Object.prototype.hasOwnProperty,ae="~";function Je(){}Object.create&&(Je.prototype=Object.create(null),new Je().__proto__||(ae=!1));function sl(r,e,t){this.fn=r,this.context=e,this.once=t||!1}function Xn(r,e,t,n,s){if(typeof t!="function")throw new TypeError("The listener must be a function");var o=new sl(t,n||r,s),i=ae?ae+e:e;return r._events[i]?r._events[i].fn?r._events[i]=[r._events[i],o]:r._events[i].push(o):(r._events[i]=o,r._eventsCount++),r}function ct(r,e){--r._eventsCount===0?r._events=new Je:delete r._events[e]}function oe(){this._events=new Je,this._eventsCount=0}oe.prototype.eventNames=function(){var e=[],t,n;if(this._eventsCount===0)return e;for(n in t=this._events)nl.call(t,n)&&e.push(ae?n.slice(1):n);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(t)):e};oe.prototype.listeners=function(e){var t=ae?ae+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var s=0,o=n.length,i=new Array(o);s<o;s++)i[s]=n[s].fn;return i};oe.prototype.listenerCount=function(e){var t=ae?ae+e:e,n=this._events[t];return n?n.fn?1:n.length:0};oe.prototype.emit=function(e,t,n,s,o,i){var c=ae?ae+e:e;if(!this._events[c])return!1;var a=this._events[c],l=arguments.length,h,u;if(a.fn){switch(a.once&&this.removeListener(e,a.fn,void 0,!0),l){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,n),!0;case 4:return a.fn.call(a.context,t,n,s),!0;case 5:return a.fn.call(a.context,t,n,s,o),!0;case 6:return a.fn.call(a.context,t,n,s,o,i),!0}for(u=1,h=new Array(l-1);u<l;u++)h[u-1]=arguments[u];a.fn.apply(a.context,h)}else{var f=a.length,b;for(u=0;u<f;u++)switch(a[u].once&&this.removeListener(e,a[u].fn,void 0,!0),l){case 1:a[u].fn.call(a[u].context);break;case 2:a[u].fn.call(a[u].context,t);break;case 3:a[u].fn.call(a[u].context,t,n);break;case 4:a[u].fn.call(a[u].context,t,n,s);break;default:if(!h)for(b=1,h=new Array(l-1);b<l;b++)h[b-1]=arguments[b];a[u].fn.apply(a[u].context,h)}}return!0};oe.prototype.on=function(e,t,n){return Xn(this,e,t,n,!1)};oe.prototype.once=function(e,t,n){return Xn(this,e,t,n,!0)};oe.prototype.removeListener=function(e,t,n,s){var o=ae?ae+e:e;if(!this._events[o])return this;if(!t)return ct(this,o),this;var i=this._events[o];if(i.fn)i.fn===t&&(!s||i.once)&&(!n||i.context===n)&&ct(this,o);else{for(var c=0,a=[],l=i.length;c<l;c++)(i[c].fn!==t||s&&!i[c].once||n&&i[c].context!==n)&&a.push(i[c]);a.length?this._events[o]=a.length===1?a[0]:a:ct(this,o)}return this};oe.prototype.removeAllListeners=function(e){var t;return e?(t=ae?ae+e:e,this._events[t]&&ct(this,t)):(this._events=new Je,this._eventsCount=0),this};oe.prototype.off=oe.prototype.removeListener;oe.prototype.addListener=oe.prototype.on;oe.prefixed=ae;oe.EventEmitter=oe;Ye=oe;var R={};be(R,"LogLevel",()=>de,r=>de=r);be(R,"default",()=>Ir,r=>Ir=r);var Te=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,o=[],i;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(c){i={error:c}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}return o},Re=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,o;n<s;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},ol="PeerJS: ",de;(function(r){r[r.Disabled=0]="Disabled",r[r.Errors=1]="Errors",r[r.Warnings=2]="Warnings",r[r.All=3]="All"})(de||(de={}));var il=function(){function r(){this._logLevel=de.Disabled}return Object.defineProperty(r.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!1,configurable:!0}),r.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=de.All&&this._print.apply(this,Re([de.All],Te(e),!1))},r.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=de.Warnings&&this._print.apply(this,Re([de.Warnings],Te(e),!1))},r.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=de.Errors&&this._print.apply(this,Re([de.Errors],Te(e),!1))},r.prototype.setLogFunction=function(e){this._print=e},r.prototype._print=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var s=Re([ol],Te(t),!1);for(var o in s)s[o]instanceof Error&&(s[o]="("+s[o].name+") "+s[o].message);e>=de.All?console.log.apply(console,Re([],Te(s),!1)):e>=de.Warnings?console.warn.apply(console,Re(["WARNING"],Te(s),!1)):e>=de.Errors&&console.error.apply(console,Re(["ERROR"],Te(s),!1))},r}(),Ir=new il,Qn={};be(Qn,"Socket",()=>Or,r=>Or=r);var ge;(function(r){r.Data="data",r.Media="media"})(ge||(ge={}));var G;(function(r){r.BrowserIncompatible="browser-incompatible",r.Disconnected="disconnected",r.InvalidID="invalid-id",r.InvalidKey="invalid-key",r.Network="network",r.PeerUnavailable="peer-unavailable",r.SslUnavailable="ssl-unavailable",r.ServerError="server-error",r.SocketError="socket-error",r.SocketClosed="socket-closed",r.UnavailableID="unavailable-id",r.WebRTC="webrtc"})(G||(G={}));var we;(function(r){r.Binary="binary",r.BinaryUTF8="binary-utf8",r.JSON="json"})(we||(we={}));var xe;(function(r){r.Message="message",r.Disconnected="disconnected",r.Error="error",r.Close="close"})(xe||(xe={}));var Q;(function(r){r.Heartbeat="HEARTBEAT",r.Candidate="CANDIDATE",r.Offer="OFFER",r.Answer="ANSWER",r.Open="OPEN",r.Error="ERROR",r.IdTaken="ID-TAKEN",r.InvalidKey="INVALID-KEY",r.Leave="LEAVE",r.Expire="EXPIRE"})(Q||(Q={}));var Gt={};Gt=JSON.parse('{"name":"peerjs","version":"1.4.7","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stckler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Soren Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","types":"dist/types.d.ts","engines":{"node":">= 10"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"cover 99%, not dead"},"source":"lib/global.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"mocha -r ts-node/register -r jsdom-global/register test/**/*.ts","format":"prettier --write .","semantic-release":"semantic-release"},"devDependencies":{"@parcel/config-default":"^2.5.0","@parcel/packager-ts":"^2.5.0","@parcel/transformer-typescript-tsc":"^2.5.0","@parcel/transformer-typescript-types":"^2.5.0","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@types/chai":"^4.3.0","@types/mocha":"^9.1.0","@types/node":"^17.0.18","chai":"^4.3.6","git-authors-cli":"^1.0.40","jsdom":"^19.0.0","jsdom-global":"^3.0.2","mocha":"^9.2.0","mock-socket":"8.0.5","parcel":"^2.5.0","parcel-transformer-tsc-sourcemaps":"^1.0.2","prettier":"^2.6.2","semantic-release":"^19.0.2","standard":"^16.0.4","ts-node":"^10.5.0","typescript":"^4.5.5"},"dependencies":{"@swc/helpers":"^0.3.13","eventemitter3":"^4.0.7","peerjs-js-binarypack":"1.0.1","webrtc-adapter":"^7.7.1"}}');var al=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),cl=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,o=[],i;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(c){i={error:c}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}return o},ll=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,o;n<s;n++)(o||!(n in e))&&(o||(o=Array.prototype.slice.call(e,0,n)),o[n]=e[n]);return r.concat(o||Array.prototype.slice.call(e))},dl=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Or=function(r){al(e,r);function e(t,n,s,o,i,c){c===void 0&&(c=5e3);var a=r.call(this)||this;a.pingInterval=c,a._disconnected=!0,a._messagesQueue=[];var l=t?"wss://":"ws://";return a._baseUrl=l+n+":"+s+o+"peerjs?key="+i,a}return e.prototype.start=function(t,n){var s=this;this._id=t;var o="".concat(this._baseUrl,"&id=").concat(t,"&token=").concat(n);this._socket||!this._disconnected||(this._socket=new WebSocket(o+"&version="+Gt.version),this._disconnected=!1,this._socket.onmessage=function(i){var c;try{c=JSON.parse(i.data),R.default.log("Server message received:",c)}catch{R.default.log("Invalid server message",i.data);return}s.emit(xe.Message,c)},this._socket.onclose=function(i){s._disconnected||(R.default.log("Socket closed.",i),s._cleanup(),s._disconnected=!0,s.emit(xe.Disconnected))},this._socket.onopen=function(){s._disconnected||(s._sendQueuedMessages(),R.default.log("Socket open"),s._scheduleHeartbeat())})},e.prototype._scheduleHeartbeat=function(){var t=this;this._wsPingTimer=setTimeout(function(){t._sendHeartbeat()},this.pingInterval)},e.prototype._sendHeartbeat=function(){if(!this._wsOpen()){R.default.log("Cannot send heartbeat, because socket closed");return}var t=JSON.stringify({type:Q.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()},e.prototype._wsOpen=function(){return!!this._socket&&this._socket.readyState===1},e.prototype._sendQueuedMessages=function(){var t,n,s=ll([],cl(this._messagesQueue),!1);this._messagesQueue=[];try{for(var o=dl(s),i=o.next();!i.done;i=o.next()){var c=i.value;this.send(c)}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}},e.prototype.send=function(t){if(!this._disconnected){if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(xe.Error,"Invalid message");return}if(this._wsOpen()){var n=JSON.stringify(t);this._socket.send(n)}}},e.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},e.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},e}(Ye.EventEmitter),$t={};be($t,"MediaConnection",()=>$r,r=>$r=r);var Jt={};be(Jt,"Negotiator",()=>Dr,r=>Dr=r);var dt=function(){return dt=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},dt.apply(this,arguments)},tt=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(h){try{l(n.next(h))}catch(u){i(u)}}function a(h){try{l(n.throw(h))}catch(u){i(u)}}function l(h){h.done?o(h.value):s(h.value).then(c,a)}l((n=n.apply(r,e||[])).next())})},rt=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i;return i={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(l){return function(h){return a([l,h])}}function a(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(h){l=[6,h],s=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Dr=function(){function r(e){this.connection=e}return r.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===ge.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===ge.Data){var n=this.connection,s={ordered:!!e.reliable},o=t.createDataChannel(n.label,s);n.initialize(o)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},r.prototype._startPeerConnection=function(){R.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},r.prototype._setupListeners=function(e){var t=this,n=this.connection.peer,s=this.connection.connectionId,o=this.connection.type,i=this.connection.provider;R.default.log("Listening for ICE candidates."),e.onicecandidate=function(c){!c.candidate||!c.candidate.candidate||(R.default.log("Received ICE candidates for ".concat(n,":"),c.candidate),i.socket.send({type:Q.Candidate,payload:{candidate:c.candidate,type:o,connectionId:s},dst:n}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":R.default.log("iceConnectionState is failed, closing connections to "+n),t.connection.emit("error",new Error("Negotiation of connection to "+n+" failed.")),t.connection.close();break;case"closed":R.default.log("iceConnectionState is closed, closing connections to "+n),t.connection.emit("error",new Error("Connection to "+n+" closed.")),t.connection.close();break;case"disconnected":R.default.log("iceConnectionState changed to disconnected on the connection with "+n);break;case"completed":e.onicecandidate=F.noop;break}t.connection.emit("iceStateChanged",e.iceConnectionState)},R.default.log("Listening for data channel"),e.ondatachannel=function(c){R.default.log("Received data channel");var a=c.channel,l=i.getConnection(n,s);l.initialize(a)},R.default.log("Listening for remote stream"),e.ontrack=function(c){R.default.log("Received remote stream");var a=c.streams[0],l=i.getConnection(n,s);if(l.type===ge.Media){var h=l;t._addStreamToMediaConnection(a,h)}}},r.prototype.cleanup=function(){R.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t=e.signalingState!=="closed",n=!1;if(this.connection.type===ge.Data){var s=this.connection,o=s.dataChannel;o&&(n=!!o.readyState&&o.readyState!=="closed")}(t||n)&&e.close()}},r.prototype._makeOffer=function(){return tt(this,void 0,Promise,function(){var e,t,n,s,o,i,c;return rt(this,function(a){switch(a.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,a.label=1;case 1:return a.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:n=a.sent(),R.default.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),a.label=3;case 3:return a.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return a.sent(),R.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),s={sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:F.browser},this.connection.type===ge.Data&&(o=this.connection,s=dt(dt({},s),{label:o.label,reliable:o.reliable,serialization:o.serialization})),t.socket.send({type:Q.Offer,payload:s,dst:this.connection.peer}),[3,6];case 5:return i=a.sent(),i!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(t.emitError(G.WebRTC,i),R.default.log("Failed to setLocalDescription, ",i)),[3,6];case 6:return[3,8];case 7:return c=a.sent(),t.emitError(G.WebRTC,c),R.default.log("Failed to createOffer, ",c),[3,8];case 8:return[2]}})})},r.prototype._makeAnswer=function(){return tt(this,void 0,Promise,function(){var e,t,n,s,o;return rt(this,function(i){switch(i.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,i.label=1;case 1:return i.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:n=i.sent(),R.default.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(n.sdp=this.connection.options.sdpTransform(n.sdp)||n.sdp),i.label=3;case 3:return i.trys.push([3,5,,6]),[4,e.setLocalDescription(n)];case 4:return i.sent(),R.default.log("Set localDescription:",n,"for:".concat(this.connection.peer)),t.socket.send({type:Q.Answer,payload:{sdp:n,type:this.connection.type,connectionId:this.connection.connectionId,browser:F.browser},dst:this.connection.peer}),[3,6];case 5:return s=i.sent(),t.emitError(G.WebRTC,s),R.default.log("Failed to setLocalDescription, ",s),[3,6];case 6:return[3,8];case 7:return o=i.sent(),t.emitError(G.WebRTC,o),R.default.log("Failed to create answer, ",o),[3,8];case 8:return[2]}})})},r.prototype.handleSDP=function(e,t){return tt(this,void 0,Promise,function(){var n,s,o,i;return rt(this,function(c){switch(c.label){case 0:t=new RTCSessionDescription(t),n=this.connection.peerConnection,s=this.connection.provider,R.default.log("Setting remote description",t),o=this,c.label=1;case 1:return c.trys.push([1,5,,6]),[4,n.setRemoteDescription(t)];case 2:return c.sent(),R.default.log("Set remoteDescription:".concat(e," for:").concat(this.connection.peer)),e!=="OFFER"?[3,4]:[4,o._makeAnswer()];case 3:c.sent(),c.label=4;case 4:return[3,6];case 5:return i=c.sent(),s.emitError(G.WebRTC,i),R.default.log("Failed to setRemoteDescription, ",i),[3,6];case 6:return[2]}})})},r.prototype.handleCandidate=function(e){return tt(this,void 0,Promise,function(){var t,n,s,o,i,c;return rt(this,function(a){switch(a.label){case 0:R.default.log("handleCandidate:",e),t=e.candidate,n=e.sdpMLineIndex,s=e.sdpMid,o=this.connection.peerConnection,i=this.connection.provider,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,o.addIceCandidate(new RTCIceCandidate({sdpMid:s,sdpMLineIndex:n,candidate:t}))];case 2:return a.sent(),R.default.log("Added ICE candidate for:".concat(this.connection.peer)),[3,4];case 3:return c=a.sent(),i.emitError(G.WebRTC,c),R.default.log("Failed to handleCandidate, ",c),[3,4];case 4:return[2]}})})},r.prototype._addTracksToConnection=function(e,t){if(R.default.log("add tracks from stream ".concat(e.id," to peer connection")),!t.addTrack)return R.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach(function(n){t.addTrack(n,e)})},r.prototype._addStreamToMediaConnection=function(e,t){R.default.log("add stream ".concat(e.id," to media connection ").concat(t.connectionId)),t.addStream(e)},r}(),Kt={};be(Kt,"BaseConnection",()=>Br,r=>Br=r);var hl=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Br=function(r){hl(e,r);function e(t,n,s){var o=r.call(this)||this;return o.peer=t,o.provider=n,o.options=s,o._open=!1,o.metadata=s.metadata,o}return Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),e}(Ye.EventEmitter),ul=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),ht=function(){return ht=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},ht.apply(this,arguments)},fl=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$r=function(r){ul(e,r);function e(t,n,s){var o=r.call(this,t,n,s)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||e.ID_PREFIX+F.randomToken(),o._negotiator=new Jt.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return ge.Media},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!1,configurable:!0}),e.prototype.addStream=function(t){R.default.log("Receiving stream",t),this._remoteStream=t,r.prototype.emit.call(this,"stream",t)},e.prototype.handleMessage=function(t){var n=t.type,s=t.payload;switch(t.type){case Q.Answer:this._negotiator.handleSDP(n,s.sdp),this._open=!0;break;case Q.Candidate:this._negotiator.handleCandidate(s.candidate);break;default:R.default.warn("Unrecognized message type:".concat(n," from peer:").concat(this.peer));break}},e.prototype.answer=function(t,n){var s,o;if(n===void 0&&(n={}),this._localStream){R.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,n&&n.sdpTransform&&(this.options.sdpTransform=n.sdpTransform),this._negotiator.startConnection(ht(ht({},this.options._payload),{_stream:t}));var i=this.provider._getMessages(this.connectionId);try{for(var c=fl(i),a=c.next();!a.done;a=c.next()){var l=a.value;this.handleMessage(l)}}catch(h){s={error:h}}finally{try{a&&!a.done&&(o=c.return)&&o.call(c)}finally{if(s)throw s.error}}this._open=!0},e.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,r.prototype.emit.call(this,"close"))},e.ID_PREFIX="mc_",e}(Kt.BaseConnection),Nt={};be(Nt,"DataConnection",()=>Mr,r=>Mr=r);var Zn={};be(Zn,"EncodingQueue",()=>Nr,r=>Nr=r);var pl=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),Nr=function(r){pl(e,r);function e(){var t=r.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(n){t._processing=!1,n.target&&t.emit("done",n.target.result),t.doNextTask()},t.fileReader.onerror=function(n){R.default.error("EncodingQueue error:",n),t._processing=!1,t.destroy(),t.emit("error",n)},t}return Object.defineProperty(e.prototype,"queue",{get:function(){return this._queue},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"processing",{get:function(){return this._processing},enumerable:!1,configurable:!0}),e.prototype.enque=function(t){this.queue.push(t),!this.processing&&this.doNextTask()},e.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},e.prototype.doNextTask=function(){this.size!==0&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},e}(Ye.EventEmitter),ml=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),gl=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Mr=function(r){ml(e,r);function e(t,n,s){var o=r.call(this,t,n,s)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new Zn.EncodingQueue,o.connectionId=o.options.connectionId||e.ID_PREFIX+F.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||we.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",function(i){o._bufferedSend(i)}),o._encodingQueue.on("error",function(){R.default.error("DC#".concat(o.connectionId,": Error occured in encoding from blob to arraybuffer, close DC")),o.close()}),o._negotiator=new Jt.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return Object.defineProperty(e.prototype,"type",{get:function(){return ge.Data},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t){this._dc=t,this._configureDataChannel()},e.prototype._configureDataChannel=function(){var t=this;(!F.supports.binaryBlob||F.supports.reliable)&&(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){R.default.log("DC#".concat(t.connectionId," dc connection success")),t._open=!0,t.emit("open")},this.dataChannel.onmessage=function(n){R.default.log("DC#".concat(t.connectionId," dc onmessage:"),n.data),t._handleDataMessage(n)},this.dataChannel.onclose=function(){R.default.log("DC#".concat(t.connectionId," dc closed for:"),t.peer),t.close()}},e.prototype._handleDataMessage=function(t){var n=this,s=t.data,o=s.constructor,i=this.serialization===we.Binary||this.serialization===we.BinaryUTF8,c=s;if(i){if(o===Blob){F.blobToArrayBuffer(s,function(l){var h=F.unpack(l);n.emit("data",h)});return}else if(o===ArrayBuffer)c=F.unpack(s);else if(o===String){var a=F.binaryStringToArrayBuffer(s);c=F.unpack(a)}}else this.serialization===we.JSON&&(c=this.parse(s));if(c.__peerData){this._handleChunk(c);return}r.prototype.emit.call(this,"data",c)},e.prototype._handleChunk=function(t){var n=t.__peerData,s=this._chunkedData[n]||{data:[],count:0,total:t.total};if(s.data[t.n]=t.data,s.count++,this._chunkedData[n]=s,s.total===s.count){delete this._chunkedData[n];var o=new Blob(s.data);this._handleDataMessage({data:o})}},e.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,r.prototype.emit.call(this,"close"))},e.prototype.send=function(t,n){if(!this.open){r.prototype.emit.call(this,"error",new Error("Connection is not open. You should listen for the `open` event before sending messages."));return}if(this.serialization===we.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===we.Binary||this.serialization===we.BinaryUTF8){var s=F.pack(t);if(!n&&s.size>F.chunkedMTU){this._sendChunks(s);return}F.supports.binaryBlob?this._bufferedSend(s):this._encodingQueue.enque(s)}else this._bufferedSend(t)},e.prototype._bufferedSend=function(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)},e.prototype._trySend=function(t){var n=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>e.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(function(){n._buffering=!1,n._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(s){return R.default.error("DC#:".concat(this.connectionId," Error when sending:"),s),this._buffering=!0,this.close(),!1}return!0},e.prototype._tryBuffer=function(){if(this.open&&this._buffer.length!==0){var t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},e.prototype._sendChunks=function(t){var n,s,o=F.chunk(t);R.default.log("DC#".concat(this.connectionId," Try to send ").concat(o.length," chunks..."));try{for(var i=gl(o),c=i.next();!c.done;c=i.next()){var a=c.value;this.send(a,!0)}}catch(l){n={error:l}}finally{try{c&&!c.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}},e.prototype.handleMessage=function(t){var n=t.payload;switch(t.type){case Q.Answer:this._negotiator.handleSDP(t.type,n.sdp);break;case Q.Candidate:this._negotiator.handleCandidate(n.candidate);break;default:R.default.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}},e.ID_PREFIX="dc_",e.MAX_BUFFERED_AMOUNT=8388608,e}(Kt.BaseConnection),es={};be(es,"API",()=>Lr,r=>Lr=r);var jr=function(r,e,t,n){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function c(h){try{l(n.next(h))}catch(u){i(u)}}function a(h){try{l(n.throw(h))}catch(u){i(u)}}function l(h){h.done?o(h.value):s(h.value).then(c,a)}l((n=n.apply(r,e||[])).next())})},Fr=function(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,s,o,i;return i={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(l){return function(h){return a([l,h])}}function a(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(h){l=[6,h],s=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},Lr=function(){function r(e){this._options=e}return r.prototype._buildRequest=function(e){var t=this._options.secure?"https":"http",n=this._options,s=n.host,o=n.port,i=n.path,c=n.key,a=new URL("".concat(t,"://").concat(s,":").concat(o).concat(i).concat(c,"/").concat(e));return a.searchParams.set("ts","".concat(Date.now()).concat(Math.random())),a.searchParams.set("version",Gt.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})},r.prototype.retrieveId=function(){return jr(this,void 0,Promise,function(){var e,t,n;return Fr(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("id")];case 1:if(e=s.sent(),e.status!==200)throw new Error("Error. Status:".concat(e.status));return[2,e.text()];case 2:throw t=s.sent(),R.default.error("Error retrieving ID",t),n="",this._options.path==="/"&&this._options.host!==F.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 3:return[2]}})})},r.prototype.listAllPeers=function(){return jr(this,void 0,Promise,function(){var e,t,n;return Fr(this,function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,this._buildRequest("peers")];case 1:if(e=s.sent(),e.status!==200)throw e.status===401?(t="",this._options.host===F.CLOUD_HOST?t="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":t="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+t)):new Error("Error. Status:".concat(e.status));return[2,e.json()];case 2:throw n=s.sent(),R.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 3:return[2]}})})},r}(),_l=function(){var r=function(e,t){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s}||function(n,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(n[o]=s[o])},r(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");r(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}}(),We=function(){return We=Object.assign||function(r){for(var e,t=1,n=arguments.length;t<n;t++){e=arguments[t];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=e[s])}return r},We.apply(this,arguments)},je=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},vl=function(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,o=[],i;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)o.push(s.value)}catch(c){i={error:c}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(i)throw i.error}}return o},Ur=function(r){_l(e,r);function e(t,n){var s=r.call(this)||this;s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map;var o;return t&&t.constructor==Object?n=t:t&&(o=t.toString()),n=We({debug:0,host:F.CLOUD_HOST,port:F.CLOUD_PORT,path:"/",key:e.DEFAULT_KEY,token:F.randomToken(),config:F.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin"},n),s._options=n,s._options.host==="/"&&(s._options.host=window.location.hostname),s._options.path&&(s._options.path[0]!=="/"&&(s._options.path="/"+s._options.path),s._options.path[s._options.path.length-1]!=="/"&&(s._options.path+="/")),s._options.secure===void 0&&s._options.host!==F.CLOUD_HOST?s._options.secure=F.isSecure():s._options.host==F.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&R.default.setLogFunction(s._options.logFunction),R.default.logLevel=s._options.debug||0,s._api=new es.API(n),s._socket=s._createServerConnection(),!F.supports.audioVideo&&!F.supports.data?(s._delayedAbort(G.BrowserIncompatible,"The current browser does not support WebRTC"),s):o&&!F.validateId(o)?(s._delayedAbort(G.InvalidID,'ID "'.concat(o,'" is invalid')),s):(o?s._initialize(o):s._api.retrieveId().then(function(i){return s._initialize(i)}).catch(function(i){return s._abort(G.ServerError,i)}),s)}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"open",{get:function(){return this._open},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"socket",{get:function(){return this._socket},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connections",{get:function(){var t,n,s=Object.create(null);try{for(var o=je(this._connections),i=o.next();!i.done;i=o.next()){var c=vl(i.value,2),a=c[0],l=c[1];s[a]=l}}catch(h){t={error:h}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return s},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!1,configurable:!0}),e.prototype._createServerConnection=function(){var t=this,n=new Qn.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return n.on(xe.Message,function(s){t._handleMessage(s)}),n.on(xe.Error,function(s){t._abort(G.SocketError,s)}),n.on(xe.Disconnected,function(){t.disconnected||(t.emitError(G.Network,"Lost connection to server."),t.disconnect())}),n.on(xe.Close,function(){t.disconnected||t._abort(G.SocketClosed,"Underlying socket is already closed.")}),n},e.prototype._initialize=function(t){this._id=t,this.socket.start(t,this._options.token)},e.prototype._handleMessage=function(t){var n,s,o=t.type,i=t.payload,c=t.src;switch(o){case Q.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case Q.Error:this._abort(G.ServerError,i.msg);break;case Q.IdTaken:this._abort(G.UnavailableID,'ID "'.concat(this.id,'" is taken'));break;case Q.InvalidKey:this._abort(G.InvalidKey,'API KEY "'.concat(this._options.key,'" is invalid'));break;case Q.Leave:R.default.log("Received leave message from ".concat(c)),this._cleanupPeer(c),this._connections.delete(c);break;case Q.Expire:this.emitError(G.PeerUnavailable,"Could not connect to peer ".concat(c));break;case Q.Offer:var _=i.connectionId,x=this.getConnection(c,_);if(x&&(x.close(),R.default.warn("Offer received for existing Connection ID:".concat(_))),i.type===ge.Media){var a=new $t.MediaConnection(c,this,{connectionId:_,_payload:i,metadata:i.metadata});x=a,this._addConnection(c,x),this.emit("call",a)}else if(i.type===ge.Data){var l=new Nt.DataConnection(c,this,{connectionId:_,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable});x=l,this._addConnection(c,x),this.emit("connection",l)}else{R.default.warn("Received malformed connection type:".concat(i.type));return}var h=this._getMessages(_);try{for(var u=je(h),f=u.next();!f.done;f=u.next()){var b=f.value;x.handleMessage(b)}}catch(M){n={error:M}}finally{try{f&&!f.done&&(s=u.return)&&s.call(u)}finally{if(n)throw n.error}}break;default:if(!i){R.default.warn("You received a malformed message from ".concat(c," of type ").concat(o));return}var _=i.connectionId,x=this.getConnection(c,_);x&&x.peerConnection?x.handleMessage(t):_?this._storeMessage(_,t):R.default.warn("You received an unrecognized message:",t);break}},e.prototype._storeMessage=function(t,n){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(n)},e.prototype._getMessages=function(t){var n=this._lostMessages.get(t);return n?(this._lostMessages.delete(t),n):[]},e.prototype.connect=function(t,n){if(n===void 0&&(n={}),this.disconnected){R.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(G.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}var s=new Nt.DataConnection(t,this,n);return this._addConnection(t,s),s},e.prototype.call=function(t,n,s){if(s===void 0&&(s={}),this.disconnected){R.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(G.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!n){R.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}var o=new $t.MediaConnection(t,this,We(We({},s),{_stream:n}));return this._addConnection(t,o),o},e.prototype._addConnection=function(t,n){R.default.log("add connection ".concat(n.type,":").concat(n.connectionId," to peerId:").concat(t)),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(n)},e.prototype._removeConnection=function(t){var n=this._connections.get(t.peer);if(n){var s=n.indexOf(t);s!==-1&&n.splice(s,1)}this._lostMessages.delete(t.connectionId)},e.prototype.getConnection=function(t,n){var s,o,i=this._connections.get(t);if(!i)return null;try{for(var c=je(i),a=c.next();!a.done;a=c.next()){var l=a.value;if(l.connectionId===n)return l}}catch(h){s={error:h}}finally{try{a&&!a.done&&(o=c.return)&&o.call(c)}finally{if(s)throw s.error}}return null},e.prototype._delayedAbort=function(t,n){var s=this;setTimeout(function(){s._abort(t,n)},0)},e.prototype._abort=function(t,n){R.default.error("Aborting!"),this.emitError(t,n),this._lastServerId?this.disconnect():this.destroy()},e.prototype.emitError=function(t,n){R.default.error("Error:",n);var s;typeof n=="string"?s=new Error(n):s=n,s.type=t,this.emit("error",s)},e.prototype.destroy=function(){this.destroyed||(R.default.log("Destroy peer with ID:".concat(this.id)),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))},e.prototype._cleanup=function(){var t,n;try{for(var s=je(this._connections.keys()),o=s.next();!o.done;o=s.next()){var i=o.value;this._cleanupPeer(i),this._connections.delete(i)}}catch(c){t={error:c}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}this.socket.removeAllListeners()},e.prototype._cleanupPeer=function(t){var n,s,o=this._connections.get(t);if(o)try{for(var i=je(o),c=i.next();!c.done;c=i.next()){var a=c.value;a.close()}}catch(l){n={error:l}}finally{try{c&&!c.done&&(s=i.return)&&s.call(i)}finally{if(n)throw n.error}}},e.prototype.disconnect=function(){if(!this.disconnected){var t=this.id;R.default.log("Disconnect peer with ID:".concat(t)),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}},e.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)R.default.log("Attempting reconnection to server with ID ".concat(this._lastServerId)),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)R.default.error("In a hurry? We're still trying to make the initial connection!");else throw new Error("Peer ".concat(this.id," cannot reconnect because it is not disconnected from the server!"))}},e.prototype.listAllPeers=function(t){var n=this;t===void 0&&(t=function(s){}),this._api.listAllPeers().then(function(s){return t(s)}).catch(function(s){return n._abort(G.ServerError,s)})},e.DEFAULT_KEY="peerjs",e}(Ye.EventEmitter),yl=Yn.Peer;const Fe=new Hs().withUrl("http://192.168.210.252:5000/chat",{skipNegotiation:!0,transport:K.WebSockets}).withAutomaticReconnect().build(),ue={startConnection(){return Fe.start()},stopConnection(){return Fe.stop()},on(r,e){Fe.on(r,e)},off(r,e){Fe.off(r,e)},invoke(r,...e){return Fe.invoke(r,...e)}},bl="/assets/sound1-9fee966a.mp3",kl={data(){return{chatBoxCheck:!1,messages:[],userForCheck:null,call:!1,caller:!1,receiver:!1,callerId:0,files:[],myPeerId:null,connectedPeerId:null,connected:!1,peer:null,peerConnection:null}},created(){let r=this;const e=r.$route.query.chat;this.userForCheck=this.authStore.getUser,e=="true"&&(this.chatBoxCheck=!0);var t=this.ticketId,n=new FormData;n.append("id",t),q.post(r.globalUrl+"getChat",n).then(s=>{r.messages=s.data.conversation}).catch(s=>r.$toast.warning(s))},mounted(){var r=this,e=this.authStore.getUser.empName;ue.startConnection().then(()=>{ue.invoke("Subscribe",r.ticketId,e),ue.on("Receive",r.handleReceive),ue.on("File",r.handleFile),ue.on("NotificationReceive",r.handleNotification),ue.on("CallAlert",r.handleCall)}).catch(t=>{console.error("Error starting SignalR connection:",t)})},beforeUnmount(){ue.off("eventName",this.handleEvent),ue.stopConnection()},props:["ticketId","user"],methods:{handleFile(r){console.log("received message successfully"),console.log(r);var e=JSON.parse(r);this.$refs.audio.play(),this.messages=[...this.messages,e]},handleNotification(r){var e=JSON.parse(r),t=this.notificationStore.getNotifications;this.notificationStore.setNotifications([...t,e])},handleCall(r){this.call=!0,this.receiver=!0,console.log("this is the caller id"),console.log(r),this.call=!0,this.callerId=r},handleReceive(r){console.log("from received"),console.log(r);var e=this;console.log("received message successfully"),console.log(r);var t=JSON.parse(r);this.$refs.audio.play(),console.log(`after playing audio: ${t.message}`),e.messages==null?(e.messages=[],e.messages.push(t)):e.messages=[...e.messages,t],this.$nextTick(()=>{this.$refs.messageArea.scrollTo({top:this.$refs.messageArea.scrollHeight,behavior:"smooth"})}),console.log("the scroll height is"),console.log(typeof this.$refs.messageArea.scrollHeight)},async getCameraStream(){try{return await navigator.mediaDevices.getUserMedia()({video:!0,audio:!0})}catch(r){console.error("Error accessing the camera:",r)}},sendMessage(){var r=this.authStore.getUser,e=this.user,t=JSON.stringify(r),n=this.message,s=this.ticketId;this.message="",ue.invoke("SendMessage",n,t,s).then(o=>{ue.invoke("SendNotificationFromClient",n,r.empName,e,s),console.log(o)}).catch(o=>{console.error("Error invoking SignalR method:",o)})},sendFile(){this.$refs.fileInput.click()},handleFileInputChange(r){var e=this,t=e.ticketId,n=e.authStore.getUser,s=JSON.stringify(n),o=new FormData;o.append("id",t),o.append("user",s);for(var i of r.target.files)o.append("files",i);q.post(e.globalUrl+"uploadFiles",o).then(c=>{var a=JSON.stringify(c.data);ue.invoke("UploadFile",a,s,t).catch(l=>{console.error("Error invoking SignalR method:",l)})})},toggleChatBox(){console.log("called toggleChatBox"),this.chatBoxCheck?this.chatBoxCheck=!1:this.chatBoxCheck=!0},convertUrlsToLinks(r){const e=/((https?:\/\/|www\.)[^\s]+)/g;return r.replace(e,t=>{let n=t;return!t.startsWith("http://")&&!t.startsWith("https://")&&(n="http://"+t),`<a href="${n}" target="_blank">${t}</a>`})},videoCall(){console.log("calling the other person"),console.log(this.user),this.call=!0,this.caller=!0,ue.invoke("MakeCall",this.user,this.ticketId,this.myPeerId).then(r=>{console.log(r)}).catch(r=>{console.log(r)})},respond(){var r=this;r.getCameraStream().then(e=>{var t=document.getElementById("receiver");t.srcObject=e,t.play();var n=r.peer.call(r.callerId,e);n.on("stream",s=>{var o=document.getElementById("caller");o.srcObject=s,o.play()})}).catch(e=>{console.log(e)})},initPeer(){var r=this;this.peer=new yl(null,{host:"http://192.168.210.199",port:9e3,path:"/peerjs"}),this.peer.on("open",e=>{this.myPeerId=e}),this.peer.on("connection",e=>{this.peerConnection=e,this.peerConnection.on("data",t=>{console.log("Received data:",t)})}),this.peer.on("error",e=>{console.error("Peer error:",e)}),this.peer.on("call",e=>{r.getCameraStream(t=>{e.answer(t),e.on("stream",n=>{var s=document.getElementById("caller");s.srcObject=n,s.play()})}).then(t=>console.log(t))})}}},Cl={key:0,class:"fixed top-[50px] left-[100px] w-auto h-[300px] bg-white border border-solid border-black",style:{"z-index":"9999999999999999"}},wl={class:"w-full h-full flex-col flex p-3"},xl={class:"flex flex-row"},Sl={id:"caller",width:"300",height:"300",class:"mx-auto d-block border border-solid border-black",ref:"caller"},Tl={id:"receiver",width:"300",height:"300",class:"mx-auto d-block border border-solid border-black",ref:"receiver"},Rl={key:0},El={key:1},Pl={class:"w-full flex flex-row justify-end hover:cursor-pointer"},Al={id:"myAudio",class:"hidden",ref:"audio"},Il=d("source",{src:bl,type:"audio/mp3"},null,-1),Ol={class:"fixed bottom-0 left-[455px] h-auto w-auto border border-solid border-black bg-white",style:{"z-index":"90000"}},Dl=d("label",{for:""},"Chatbox",-1),Bl={key:0,class:"flex flex-col h-[400px] w-[408px] bg-white",style:{"z-index":"9999"}},$l={class:"flex flex-col h-full w-full p-3 overflow-y-scroll",id:"messageArea",ref:"messageArea"},Nl={key:0,class:"flex flex-col justify-end items-end w-full mb-2"},Ml={class:"text-xs flex flex-row justify-end"},jl=["innerHTML"],Fl={class:"text-xs flex flex-row justify-end"},Ll={class:"text-xs flex flex-row justify-end mb-2"},Ul=["href"],Hl={class:"text-xs flex flex-row justify-end"},zl={key:1,class:"flex flex-col w-full h-auto justify-start items-start"},ql={class:"text-xs flex flex-row justify-end"},Wl=["innerHTML"],Vl={class:"text-xs flex flex-row justify-end"},Gl={class:"text-xs flex flex-row justify-end"},Jl=["href"],Kl={class:"text-xs flex flex-row justify-end"},Yl={class:"w-full h-auto bg-white border-t border-solid border-black"},Xl={class:"flex flex-row h-auto w-full"},Ql={class:"h-auto w-4/5 p-2 pr-4"},Zl={class:"h-auto w-1/5 flex flex-row justify-around items-center"},ed={class:"p-3 bg-white h-full w-full"},td={class:"p-3 bg-white h-full w-full"},rd={class:"p-3 bg-white h-full w-full"};function nd(r,e,t,n,s,o){const i=ne("font-awesome-icon");return p(),m(k,null,[s.call==!0?(p(),m("div",Cl,[d("div",wl,[d("div",xl,[d("video",Sl,null,512),d("video",Tl,null,512)]),s.caller==!0?(p(),m("div",Rl," Calling "+g(t.user),1)):D("",!0),s.receiver==!0?(p(),m("div",El,[y(" Receiving call from "+g(t.user)+" ",1),d("div",{onClick:e[0]||(e[0]=c=>o.respond())},"Respond")])):D("",!0),d("div",Pl,[d("div",{onClick:e[1]||(e[1]=c=>this.call=!1)},"Cancel")])])])):D("",!0),d("audio",Al,[Il,y(" Your browser does not support the audio element. ")],512),d("div",Ol,[d("div",{class:"flex flex-row justify-between h-12 w-[408px] border-b-2 p-3 border-solid border-black text-white bg-blue-400",onClick:e[2]||(e[2]=(...c)=>o.toggleChatBox&&o.toggleChatBox(...c))},[Dl,Z(i,{icon:"fa-solid fa-minus",size:"lg",class:"hover:cursor-pointer",ref:"toggleIcon"},null,512)]),s.chatBoxCheck==!0?(p(),m("div",Bl,[d("div",$l,[(p(!0),m(k,null,W(s.messages,(c,a)=>(p(),m("div",{class:"flex flex-row w-full",key:a},[c&&c.from.mailAddress==s.userForCheck.mailAddress?(p(),m("div",Nl,[c.type=="text"?(p(),m(k,{key:0},[d("div",Ml,g(c.time),1),d("div",{class:"bg-blue-500 p-3 rounded-md text-white",style:{"word-wrap":"break-word","max-width":"50%"},innerHTML:o.convertUrlsToLinks(c.message)},null,8,jl),d("div",Fl,g(c.from.empName),1)],64)):c.type=="files"?(p(),m(k,{key:1},[d("div",Ll,g(c.time),1),(p(!0),m(k,null,W(c.files,(l,h)=>(p(),m("div",{class:"bg-blue-500 p-3 text-white",style:{"word-wrap":"break-word","max-width":"50%"},key:h},[d("a",{href:this.globalUrl+"uploads/"+l.fileName,target:"_blank",class:"underline"},g(l.originalName),9,Ul)]))),128)),d("div",Hl,g(c.from.empName),1)],64)):D("",!0)])):(p(),m("div",zl,[c.type=="text"?(p(),m(k,{key:0},[d("div",ql,g(c.time),1),d("div",{class:"bg-gray-200 p-3 rounded-md text-black w-[200px]",style:{"word-wrap":"break-word"},innerHTML:o.convertUrlsToLinks(c.message)},null,8,Wl),d("div",Vl,g(c.from.empName),1)],64)):c.type=="files"?(p(),m(k,{key:1},[d("div",Gl,g(c.time),1),(p(!0),m(k,null,W(c.files,(l,h)=>(p(),m("div",{class:"bg-gray-200 p-3 text-black w-[200px]",style:{"word-wrap":"break-word"},key:h},[d("a",{href:this.globalUrl+"uploads/"+l.fileName,target:"_blank",class:"underline"},g(l.originalName),9,Jl)]))),128)),d("div",Kl,g(c.from.empName),1)],64)):D("",!0)]))]))),128))],512),d("div",Yl,[d("div",Xl,[d("div",Ql,[ft(d("textarea",{rows:"1",name:"",id:"",class:"rounded-xl bg-slate-200 h-auto w-full p-3",placeholder:"Message","onUpdate:modelValue":e[3]||(e[3]=c=>r.message=c),onKeyup:e[4]||(e[4]=cs((...c)=>o.sendMessage&&o.sendMessage(...c),["enter"]))},null,544),[[pt,r.message]])]),d("div",Zl,[d("input",{type:"file",ref:"fileInput",style:{display:"none"},multiple:"",onChange:e[5]||(e[5]=(...c)=>o.handleFileInputChange&&o.handleFileInputChange(...c))},null,544),d("div",ed,[Z(i,{class:"text-blue-600 hover:cursor-pointer",icon:"fa-solid fa-video",size:"lg",onClick:e[6]||(e[6]=c=>o.videoCall())})]),d("div",td,[Z(i,{class:"text-blue-600 hover:cursor-pointer",icon:"fa-solid fa-paperclip",size:"lg",onClick:o.sendFile},null,8,["onClick"])]),d("div",rd,[Z(i,{class:"text-blue-600 hover:cursor-pointer",icon:"fa-solid fa-paper-plane",onClick:o.sendMessage,size:"lg"},null,8,["onClick"])])])])])])):D("",!0)])],64)}const ts=pe(kl,[["render",nd]]),sd={data(r){return{showDetailsCheck:!1,comment:"",commentCall:!1,users:[],componentTicket:null,files:[],additionalInfo:"",approver:null,socket:null,user:null,modalCheck:!1,rating:0,note:"",notes:[]}},mixins:[dn],mounted(){this.componentTicket=this.ticket},beforeUnmount(){_r.disconnect()},created(){this.getApprovers(),this.getNotes(),this.user=this.authStore.getUser},props:["ticket","currentHandlerType"],components:{Actions:sn,Buttons:on,CommentModal:ln,ActionStatus:hn,Chat:ts},computed:{user(){var r=this.authStore.getUser;return r},reversedActions(){return this.ticket.actions.slice().reverse()}},methods:{submitMessage(){const r=this.ticket._id,e="this is the message from the current handler";_r.sendMessage({message:e,roomName:r},t=>{console.log(t)})},showDetails(){this.showDetailsCheck==!1?(this.$refs.details.style.display="block",this.$refs.main.style.filter="blur(5px)",this.showDetailsCheck=!0):(this.$refs.details.style.display="none",this.$refs.main.style.filter="blur(0px)",this.showDetailsCheck=!1)},modalToggle(r){this.$refs.commentModal&&this.$refs.commentModal.commentBox(r)},handleCall(r){this.modalToggle(r)},cancel(){this.modalToggle("cancel")},setFile(r){for(var e of r.target.files)this.files.push(e)},removeFile(r){this.files.splice(r,1)},handleRemoveFile(r){this.removeFile(r)},setRating(r){this.rating=r},handleModalCall(r){console.log("entered Handle Modal Call"),r=="Supervisor Approved"?this.supervisorApprove(this.comment,this.ticket):r=="Higher Authority Approved"?this.higherApprove(this.comment,this.ticket):r=="Request For Higher Approval"?this.seekHigherApproval(this.comment,this.approver,this.ticket):r=="Ticket Assigned"?(console.log("entered ticket assigned in modal call"),this.assignTicket(this.comment,this.approver,this.ticket)):r=="Ticket Accept"?(console.log("entered ticket assigned in modal call"),console.log("this is the ticket"),console.log(this.ticket),this.assignSelf(this.comment,this.ticket)):r=="Close Request"?this.closeRequest(this.comment,this.files,this.ticket,this.additionalInfo):r=="Close Request Accepted"?this.closeTicket(this.comment,this.ticket,this.rating):r=="Close Request Rejected"?this.closeRequestReject(this.comment,this.ticket):r=="Asking For Information"?this.ask(this.comment,this.ticket):r=="Giving Information"?this.giveInfo(this.comment,this.files,this.ticket,this.additionalInfo):r=="reject"?this.rejectTicket(this.comment,this.ticket):r=="Reassign"&&this.Reassign(this.comment,this.approver,this.ticket)},handleFileChange(r){for(var e of r)this.files.push(e)},handleCommentChange(r){this.comment=r},handleInfoChange(r){this.additionalInfo=r},handleApproverChange(r){this.approver=r},getActionType(r){if(r.type==0)return"New Ticket Raised";if(r.type==1)return"Approval From Supervisor";if(r.type==3)return"Seeking Higher Approval";if(r.type==4)return"Assigned Ticket";if(r.type==5)return"Assigned Ticket";if(r.type==6)return"Asking For More Information";if(r.type==7)return"Giving More Information";if(r.type==8)return"Reject Ticket";if(r.type==9)return"Reassign Ticket";if(r.type==10)return"Ticket Close Request";if(r.type==11)return"Ticket Close Request Accept";if(r.type==12)return console.log("rejecting request"),"Ticket Close Request Reject"},addNote(){var r=this,e=this.ticket,t=this.note,n=this.authStore.getToken,s=this.authStore.getUser.empName,o=new FormData;o.append("token",n),o.append("note",t),o.append("id",e._id),o.append("userName",s),q.post(r.globalUrl+"insertNote",o).then(i=>{console.log("this is the result"),r.notes=[...r.notes,i.data]}).catch(i=>{r.$toast.warning(i)})},getNotes(){var r=this,e=this.authStore.getToken,t=this.ticket._id,n=new FormData;n.append("token",e),n.append("id",t),q.post(r.globalUrl+"getNotes",n).then(s=>{r.notes=s.data}).catch(s=>r.$toast.warning(s))}}},od={class:"flex flex-row w-full h-auto",ref:"main"},id={class:"w-2/6 h-[100vh] overflow-y-scroll pl-10 border bg-gray-100 border-solid border-black"},ad=d("div",{class:"mb-4 border-2 border-solid border-black text-xl mt-2 rounded-md w-11/12 p-4 text-black font-semibold"},"Ticketing Status",-1),cd={class:"flex flex-row w-11/12 mt-2"},ld=d("div",{class:"w-2/4"}," Raised By: ",-1),dd={class:"w-2/4 text-right"},hd={class:"flex flex-row w-11/12 mt-2"},ud=d("div",{class:"w-2/4"}," Raiser's Email: ",-1),fd={class:"w-2/4 text-right"},pd={key:0},md={key:1},gd={class:"flex flex-row w-11/12 mt-2"},_d=d("div",{class:"w-2/4"}," Raiser's Phone: ",-1),vd={class:"w-2/4 text-right"},yd={key:0},bd={key:1},kd={class:"flex flex-row w-11/12 mt-2"},Cd=d("div",{class:"w-2/4"}," Raiser's Extension: ",-1),wd={class:"w-2/4 text-right"},xd={key:0},Sd={key:1},Td={class:"flex flex-row w-11/12 mt-2"},Rd=d("div",{class:"w-2/4"}," Raiser's Location: ",-1),Ed={class:"w-2/4 text-right"},Pd={key:0},Ad={key:1},Id={key:0,class:"flex flex-row w-11/12 mt-2"},Od=d("div",{class:"w-2/4"}," Raised On Behalf Of: ",-1),Dd={key:0,class:"w-2/4 text-right"},Bd=d("br",null,null,-1),$d={key:1,class:"w-2/4 text-right"},Nd={class:"flex flex-row w-11/12 mt-2"},Md=d("div",{class:"w-2/4"}," Request Date: ",-1),jd={class:"w-2/4 text-right"},Fd={class:"flex flex-row w-11/12 mt-2 h-auto"},Ld=d("div",{class:"w-2/4 text-lg font-bold text-white p-3 bg-red-500"}," Problem in Details: ",-1),Ud={class:"w-2/4 text-right text-lg font-bold text-white bg-red-500 p-3",style:{"word-wrap":"break-word","max-width":"50%"}},Hd={class:"flex flex-row w-11/12 mt-2"},zd={class:"w-2/4"},qd={class:"w-2/4 text-right"},Wd={class:"flex flex-row w-11/12 mt-2"},Vd=d("div",{class:"w-2/4"}," Approval Required: ",-1),Gd={class:"w-2/4 text-right"},Jd={class:"flex flex-row w-11/12 mt-2"},Kd=d("div",{class:"w-2/4"}," Priority: ",-1),Yd={class:"w-2/4 text-right"},Xd={class:"flex flex-row w-11/12 mt-2"},Qd=d("div",{class:"w-2/4"}," Department: ",-1),Zd={class:"w-2/4 text-right"},eh={class:"flex flex-row w-11/12 mt-2"},th=d("div",{class:"w-2/4"}," Location: ",-1),rh={class:"w-2/4 text-right"},nh={class:"flex flex-row w-11/12 mt-2"},sh=d("div",{class:"w-2/4"}," Assigned To: ",-1),oh={class:"w-2/4 text-right"},ih={class:"flex flex-row w-11/12 mt-2"},ah=d("div",{class:"w-2/4"}," Department Head: ",-1),ch={class:"w-2/4 text-right"},lh={class:"flex flex-row w-11/12 mt-2"},dh=d("div",{class:"w-2/4"}," Higher Approver: ",-1),hh={class:"w-2/4 text-right"},uh={key:2,class:"flex flex-row w-11/12 mt-3"},fh=d("div",{class:"w-2/4"}," Supervisor: ",-1),ph={class:"w-2/4 text-right"},mh=d("br",null,null,-1),gh={class:"flex flex-row w-11/12 mt-3"},_h=d("div",{class:"w-2/4 font-bold"}," Current Status: ",-1),vh={class:"w-2/4 text-lg font-bold text-black text-right"},yh={class:"flex flex-row w-11/12 mt-3"},bh=d("div",{class:"w-2/4 font-bold"}," Current Handler: ",-1),kh={class:"w-2/4 text-lg text-black text-right"},Ch={class:"flex flex-row w-11/12 mt-2"},wh=d("div",{class:"w-2/4"}," Current Handler's Email: ",-1),xh={class:"w-2/4 text-right"},Sh={key:0},Th={key:1},Rh={class:"flex flex-row w-11/12 mt-2"},Eh=d("div",{class:"w-2/4"}," Current Handler's Phone: ",-1),Ph={class:"w-2/4 text-right"},Ah={key:0},Ih={key:1},Oh={class:"flex flex-row w-11/12 mt-2"},Dh=d("div",{class:"w-2/4"}," Current Handler's Extension: ",-1),Bh={class:"w-2/4 text-right"},$h={key:0},Nh={key:1},Mh={class:"flex flex-row w-11/12 mt-2"},jh=d("div",{class:"w-2/4"}," Current Handler's Location: ",-1),Fh={class:"w-2/4 text-right"},Lh={key:0},Uh={key:1},Hh={class:"flex flex-row w-11/12 mt-3"},zh=d("div",{class:"w-2/4"}," Responder Comment: ",-1),qh={class:"w-2/4 text-lg text-black text-right"},Wh={class:"flex flex-row w-11/12 mt-3"},Vh=d("div",{class:"w-2/4"}," Relevant Files: ",-1),Gh={class:"w-2/4 text-lg font-bold text-black text-right"},Jh={class:"flex flex-col"},Kh=["href"],Yh={class:"w-2/6 h-[100vh] pt-2 pr-2 text-center bg-blue overflow-y-scroll"},Xh={class:"flex flex-row items-end w-full flex-wrap"},Qh={class:"flex flex-row w-2/6 justify-start",style:{"z-index":"1"}},Zh={key:0,class:"border border-solid flex flex-col w-full p-4",style:{"z-index":"99"}},eu={class:"font-bold flex flex-row text-4xl pb-2"},tu={class:"mr-4"},ru={class:"border border-solid border-gray-400 flex flex-col overflow-y-scroll h-[150px]"},nu={class:"flex flex-col"},su={class:"flex flex-row justify-start pl-2 font-bold text-lg"},ou={class:"flex flex-col justify-start items-start px-3 pb-3"},iu={class:"flex flex-row w-full justify-center items-center border border-solid border-gray-200"},au={class:"flex flex-col justify-center items-center pt-2"},cu={class:"flex flex-col bg-white text-black w-[900px] h-[500px] pt-10 mt-10 px-10 fixed overflow-y-scroll border-2 border-black border-solid",style:{top:"50px",left:"250px",display:"none",transition:"0.50s","z-index":"1233333333333333333"},ref:"details"},lu=d("div",{class:"flex flex-row text-4xl font-extrabold"},"Details",-1),du={class:"ml-10"},hu=d("hr",{class:"border border-solid border-black w-2/4"},null,-1),uu={class:"flex flex-row pl-10"},fu=d("div",{class:"w-2/4 flex flex-row justify-between"},[d("div",null,"Action Serial Number"),d("div",null,":")],-1),pu={class:"w-2/4 ml-4"},mu={class:"flex flex-row pl-10 mt-1"},gu=d("div",{class:"w-2/4 flex flex-row justify-between"},[d("div",null,"Action Type"),d("div",null,":")],-1),_u={class:"w-2/4 ml-4"},vu={class:"flex flex-row items-center justify-end mb-2 sticky bottom-2"};function yu(r,e,t,n,s,o){const i=ne("Chat"),c=ne("CommentModal"),a=ne("ActionStatus"),l=ne("Buttons"),h=ne("font-awesome-icon"),u=ne("Actions");return p(),m(k,null,[Z(i,{ticketId:t.ticket._id,user:t.ticket.raisedBy.empName},null,8,["ticketId","user"]),Z(c,{ref:"commentModal",ticket:t.ticket,onRating:o.setRating,onModalCall:o.handleModalCall,onCancel:o.cancel,onFileChange:o.handleFileChange,onCommentChange:o.handleCommentChange,onInfoChange:o.handleInfoChange,onCall:o.handleCall,onApproverChange:o.handleApproverChange,onRemoveFile:o.handleRemoveFile},null,8,["ticket","onRating","onModalCall","onCancel","onFileChange","onCommentChange","onInfoChange","onCall","onApproverChange","onRemoveFile"]),d("div",od,[d("div",id,[ad,d("div",cd,[ld,d("div",dd,g(t.ticket.raisedBy.empName),1)]),d("div",hd,[ud,d("div",fd,[t.ticket.raisedBy.mailAddress?(p(),m("span",pd,g(t.ticket.raisedBy.mailAddress),1)):(p(),m("span",md,"Not Available"))])]),d("div",gd,[_d,d("div",vd,[t.ticket.raisedBy.phone?(p(),m("span",yd,g(t.ticket.raisedBy.phone),1)):(p(),m("span",bd,"Not Available"))])]),d("div",kd,[Cd,d("div",wd,[t.ticket.raisedBy.extension?(p(),m("span",xd,g(t.ticket.raisedBy.extension),1)):(p(),m("span",Sd,"Not Available"))])]),d("div",Td,[Rd,d("div",Ed,[t.ticket.raisedBy.location?(p(),m("span",Pd,g(t.ticket.raisedBy.location),1)):(p(),m("span",Ad,"Not Available"))])]),t.ticket.raisedFor?(p(),m("div",Id,[Od,t.ticket.raisedFor&&t.ticket.raisedFor.mailAddress!=null?(p(),m("div",Dd,[y(g(t.ticket.raisedFor.empName)+" ",1),d("i",null,g(t.ticket.raisedFor.Designation)+", "+g(t.ticket.raisedFor.unit),1),y(),Bd,d("i",null,[y("Extension:"),t.ticket.raisedFor.extension?(p(),m(k,{key:0},[y(g(t.ticket.raisedFor.extension)+",",1)],64)):(p(),m(k,{key:1},[y("N/A,")],64)),y(" Phone:"),t.ticket.raisedFor.phone?(p(),m(k,{key:2},[y(g(t.ticket.raisedFor.phone)+",",1)],64)):(p(),m(k,{key:3},[y("N/A,")],64)),y(" Email:"),t.ticket.raisedFor.mailAddress?(p(),m(k,{key:4},[y(g(t.ticket.raisedFor.mailAddress),1)],64)):(p(),m(k,{key:5},[y("N/A,")],64))])])):(p(),m("div",$d," Not Available "))])):D("",!0),d("div",Nd,[Md,d("div",jd,g(t.ticket.actions[0].time),1)]),d("div",Fd,[Ld,d("div",Ud,g(t.ticket.problemDetails),1)]),t.ticket.details&&t.ticket.details.length>0?(p(!0),m(k,{key:1},W(t.ticket.details,(f,b)=>(p(),m("div",Hd,[d("div",zd,g(f.label),1),d("div",qd,g(f.input),1)]))),256)):D("",!0),d("div",Wd,[Vd,d("div",Gd,[t.ticket.approvalRequired=="yes"?(p(),m(k,{key:0},[y(" Yes ")],64)):(p(),m(k,{key:1},[y(" No ")],64))])]),d("div",Jd,[Kd,d("div",Yd,g(t.ticket.priority),1)]),d("div",Xd,[Qd,d("div",Zd,g(t.ticket.department),1)]),d("div",eh,[th,d("div",rh,g(t.ticket.raisedBy.unit),1)]),d("div",nh,[sh,d("div",oh,[t.ticket.assignedTo?(p(),m(k,{key:0},[y(g(t.ticket.assignedTo.mailAddress),1)],64)):(p(),m(k,{key:1},[y(" Not Assigned Yet ")],64))])]),d("div",ih,[ah,d("div",ch,g(t.ticket.ticketingHead.mailAddress),1)]),d("div",lh,[dh,d("div",hh,[t.ticket.higherApprover?(p(),m(k,{key:0},[y(g(t.ticket.higherApprover.mailAddress),1)],64)):(p(),m(k,{key:1},[y(" Not Available ")],64))])]),t.ticket.supervisor?(p(),m("div",uh,[fh,d("div",ph,[y(g(t.ticket.supervisor.empName)+" ",1),d("i",null,g(t.ticket.supervisor.Designation)+", "+g(t.ticket.supervisor.unit),1),y(),mh,d("i",null,[y("Extension:"),t.ticket.supervisor.extension?(p(),m(k,{key:0},[y(g(t.ticket.supervisor.extension)+",",1)],64)):(p(),m(k,{key:1},[y("N/A,")],64)),y(" Phone:"),t.ticket.supervisor.phone?(p(),m(k,{key:2},[y(g(t.ticket.raisedBy.phone)+",",1)],64)):(p(),m(k,{key:3},[y("N/A,")],64)),y(" Email:"),t.ticket.supervisor.mailAddress?(p(),m(k,{key:4},[y(g(t.ticket.supervisor.mailAddress),1)],64)):(p(),m(k,{key:5},[y("N/A,")],64))])])])):D("",!0),d("div",gh,[_h,d("div",vh,g(t.ticket.status),1)]),d("div",yh,[bh,d("div",kh,g(t.ticket.currentHandler.empName),1)]),d("div",Ch,[wh,d("div",xh,[t.ticket.currentHandler.mailAddress?(p(),m("span",Sh,g(t.ticket.currentHandler.mailAddress),1)):(p(),m("span",Th,"Not Available"))])]),d("div",Rh,[Eh,d("div",Ph,[t.ticket.currentHandler.phone?(p(),m("span",Ah,g(t.ticket.currentHandler.phone),1)):(p(),m("span",Ih,"Not Available"))])]),d("div",Oh,[Dh,d("div",Bh,[t.ticket.currentHandler.extension?(p(),m("span",$h,g(t.ticket.currentHandler.extension),1)):(p(),m("span",Nh,"Not Available"))])]),d("div",Mh,[jh,d("div",Fh,[t.ticket.currentHandler.location?(p(),m("span",Lh,g(t.ticket.currentHandler.location),1)):(p(),m("span",Uh,"Not Available"))])]),d("div",Hh,[zh,d("div",qh,[t.ticket.remarks?(p(),m(k,{key:0},[y(g(t.ticket.remarks),1)],64)):(p(),m(k,{key:1},[y("Not Available")],64))])]),d("div",Wh,[Vh,d("div",Gh,[d("div",Jh,[(p(!0),m(k,null,W(t.ticket.actions[0].files,(f,b)=>(p(),m("div",{key:b},[d("a",{href:r.globalUrl+"uploads/"+f.fileName,target:"__blank",class:"underline"},g(f.originalName),9,Kh)]))),128))])])])]),d("div",Yh,[Z(a,{ticket:t.ticket},null,8,["ticket"]),d("div",Xh,[Z(l,{ticket:t.ticket,onShowDetails:e[0]||(e[0]=f=>o.showDetails()),class:"",onComment:e[1]||(e[1]=f=>o.modalToggle()),onCall:o.handleCall},null,8,["ticket","onCall"])])]),d("div",Qh,[t.ticket.raisedBy.mailAddress!=t.ticket.currentHandler.mailAddress?(p(),m("div",Zh,[d("div",eu,[d("div",tu,[Z(h,{icon:"fa-regular fa-pen-to-square",size:"2x"})]),y("Internal Notes")]),d("div",ru,[(p(!0),m(k,null,W(s.notes,(f,b)=>(p(),m("div",nu,[d("div",su,g(f.takenBy)+":",1),d("div",ou,g(f.data),1)]))),256))]),d("div",iu,[d("div",au,[ft(d("textarea",{name:"",id:"",cols:"52",rows:"5","onUpdate:modelValue":e[2]||(e[2]=f=>s.note=f),placeholder:"Write Notes Here",class:"p-3 border border-solid border-gray-400"},` \r
         \r
                            `,512),[[pt,s.note]]),d("div",{class:"mt-4 bg-emerald-500 text-white font-bold text-lg p-3 rounded-sm hover:cursor-pointer w-32 mb-2",onClick:e[3]||(e[3]=(...f)=>o.addNote&&o.addNote(...f))},"Add Note")])])])):D("",!0)])],512),d("div",cu,[lu,(p(!0),m(k,null,W(o.reversedActions,(f,b)=>(p(),m("div",{key:b,class:"flex flex-col bg-white mt-10"},[d("span",du,g(f.time),1),hu,d("div",uu,[fu,d("div",pu,g(f.serial),1)]),d("div",mu,[gu,d("div",_u,g(o.getActionType(f)),1)]),f.type==0?(p(),m(k,{key:0},[t.ticket.approvalRequired=="yes"?(p(),j(u,{key:0,action:"Raised By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):(p(),j(u,{key:1,action:"Raised By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"]))],64)):f.type==1?(p(),j(u,{key:1,action:"Approved By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):f.type==3?(p(),j(u,{key:2,action:"Approved By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):f.type==2?(p(),j(u,{key:3,action:"Request By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):f.type==5?(p(),j(u,{key:4,action:"Assigned By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):f.type==10?(p(),j(u,{key:5,action:"Requested By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwarded To",comment:f.comments},null,8,["from","to","comment"])):f.type==11?(p(),j(u,{key:6,action:"Response By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwared To",comment:f.comments},null,8,["from","to","comment"])):f.type==12?(p(),j(u,{key:7,action:"Response By",from:f.raisedBy,to:f.forwardedTo,toAction:"Forwared To",comment:f.comments},null,8,["from","to","comment"])):f.type==6?(p(),j(u,{key:8,action:"Asked By",from:f.raisedBy,to:f.forwardedTo,toAction:"Asked From",comment:f.comments},null,8,["from","to","comment"])):f.type==7?(p(),j(u,{key:9,action:"Given By",from:f.raisedBy,to:f.forwardedTo,toAction:"Give To",comment:f.comments},null,8,["from","to","comment"])):f.type==8?(p(),j(u,{key:10,action:"Rejected By",from:f.raisedBy,to:f.forwardedTo,toAction:"Ticket From",comment:f.comments},null,8,["from","to","comment"])):f.type==4?(p(),j(u,{key:11,action:"Assigned By",from:f.raisedBy,to:f.forwardedTo,toAction:"Assigned To",comment:f.comments},null,8,["from","to","comment"])):f.type==9?(p(),j(u,{key:12,action:"Assigned By",from:f.raisedBy,to:f.forwardedTo,toAction:"Assigned To",comment:f.comments},null,8,["from","to","comment"])):D("",!0)]))),128)),d("div",vu,[d("div",{class:"p-3 text-white font-bold bg-blue-500 rounded-sm hover:cursor-pointer",onClick:e[4]||(e[4]=(...f)=>o.showDetails&&o.showDetails(...f))},"Close")])],512)],64)}const bu=pe(sd,[["render",yu]]),ku={data(r){return{showDetailsCheck:!1,comment:"",commentCall:!1,users:[],componentTicket:null,files:[],additionalInfo:"",approver:null,ticket:r.ticket,socket:null,showConversationCheck:!1,messages:[],userForCheck:null,closeCheck:!1,comments:"",rating:0}},mixins:[dn],mounted(){this.componentTicket=this.ticket},created(){this.getApprovers(),this.socket=qe("http://localhost:3000"),this.socket.emit("join",this.ticket._id),this.userForCheck=this.authStore.getUser},props:["ticket","currentHandlerType"],components:{Actions:sn,Buttons:on,CommentModal:ln,ActionStatus:hn,Chat:ts,StarRating:cn},computed:{user(){var r=this.authStore.getUser;return r},reversedActions(){return this.ticket.actions.slice().reverse()}},methods:{setRating(r){this.rating=r},submitMessage(){const r=this.ticket._id,e="this is the message from the viewer";SocketioService.sendMessage({message:e,roomName:r},t=>{console.log(t)})},showConversation(){var r=this,e=this.ticket._id,t=new FormData;t.append("id",e),this.showConversationCheck==!1?q.post(r.globalUrl+"getChat",t).then(n=>{r.messages=n.data.conversation,r.showConversationCheck=!0}).catch(n=>r.$toast.warning(n)):r.showConversationCheck=!1},showDetails(){this.showDetailsCheck=!this.showDetailsCheck},sendMessage(){this.socket.emit("message","this is the message from the client")},modalToggle(r){this.$refs.commentModal&&this.$refs.commentModal.commentBox(r)},handleCall(r){this.modalToggle(r)},cancel(){this.modalToggle("cancel")},setFile(r){for(var e of r.target.files)this.files.push(e)},removeFile(r){this.files.splice(r,1)},handleRemoveFile(r){this.removeFile(r)},handleModalCall(r){console.log("entered Handle Modal Call"),r=="Supervisor Approved"?this.supervisorApprove(this.comment,this.ticket):r=="Higher Authority Approved"?this.higherApprove(this.comment,this.ticket):r=="Request For Higher Approval"?this.seekHigherApproval(this.comment,this.approver,this.ticket):r=="Ticket Assigned"?this.assignTicket(this.comment,this.approver,this.ticket):r=="Close Request"?this.closeRequest(this.comment,this.ticket):r=="Close Request Accepted"?this.closeTicket(this.comment,this.ticket):r=="Close Request Rejected"?this.closeRequestReject(this.comment,this.ticket):r=="Asking For Information"?this.ask(this.comment,this.ticket):r=="Giving Information"&&this.giveInfo(this.comment,this.files,this.ticket,this.additionalInfo)},handleFileChange(r){for(var e of r)this.files.push(e)},handleCommentChange(r){this.comment=r},handleInfoChange(r){this.additionalInfo=r},handleApproverChange(r){this.approver=r},getActionType(r){if(r.type==0)return"New Ticket Raised";if(r.type==1)return"Approval From Supervisor";if(r.type==3)return"Seeking Higher Approval";if(r.type==4)return"Assigned Ticket";if(r.type==5)return"Assigned Ticket";if(r.type==6)return"Asking For More Information";if(r.type==7)return"Giving More Information";if(r.type==8)return"Reject Ticket";if(r.type==9)return"Reassign Ticket";if(r.type==10)return"Ticket Close Request";if(r.type==11)return"Ticket Close Request Accept";if(r.type==12)return console.log("rejecting request"),"Ticket Close Request Reject"},closeTicket(){this.closeCheck==!1?(this.$refs.modal.style.top="100px",this.closeCheck=!0):(this.$refs.modal.style.top="-200px",this.closeCheck=!1)},closeTicketProceed(){var r=this;this.$toast.info("Closing Ticket...");var e=this.authStore.getUser,t=this.authStore.getToken,n=this.comments,s=this.ticket,o=this.rating,i=new FormData;i.append("user",JSON.stringify(e)),i.append("token",t),i.append("comment",n),i.append("ticket",JSON.stringify(s)),i.append("rating",o),q.post(r.globalUrl+"closeTicket",i).then(c=>{c.data==!0?(r.$toast.clear(),r.$toast.success("Ticket Closed"),this.$router.push("/ticketing/searchTicket")):(r.$toast.clear(),r.$toast.warning(c.data))}).catch(c=>{r.$toast.clear(),r.$toast.warning(c)})},showDetails(){this.showDetailsCheck==!1?(this.$refs.details.style.display="block",this.$refs.main.style.filter="blur(5px)",this.showDetailsCheck=!0):(this.$refs.details.style.display="none",this.$refs.main.style.filter="blur(0px)",this.showDetailsCheck=!1)}}},Cu={class:"w-2/4 h-auto bg-white flex flex-col rounded-md p-5 pt-10 border border-solid border-black",style:{left:"350px",top:"-200px","z-index":"4000",transition:"0.5s smooth",position:"fixed"},ref:"modal",id:"modal"},wu={class:"flex flex-col w-full h-full"},xu={class:"flex flex-row w-full mt-4"},Su=d("div",{class:"w-1/6 font-bold text-center"}," Comment: ",-1),Tu={class:"w-5/6"},Ru={class:"flex flex-row w-full h-full justify-end"},Eu={class:"flex flex-row w-full h-screen",ref:"main"},Pu={class:"flex flex-col w-3/4 h-screen items-center bg-white"},Au=d("div",{class:"mb-4 mt-2 rounded-md w-11/12 p-4 text-black border-2 border-solid border-black text-xl font-semibold"},"Ticketing Status",-1),Iu={class:"flex flex-row w-11/12 mt-2"},Ou=d("div",{class:"w-1/4"}," Raised By: ",-1),Du={class:"w-3/4"},Bu={class:"flex flex-row w-11/12 mt-2"},$u=d("div",{class:"w-1/4"}," Raiser's Email: ",-1),Nu={class:"w-3/4"},Mu={key:0},ju={key:1},Fu={class:"flex flex-row w-11/12 mt-2"},Lu=d("div",{class:"w-1/4"}," Raiser's Phone: ",-1),Uu={class:"w-3/4"},Hu={key:0},zu={key:1},qu={class:"flex flex-row w-11/12 mt-2"},Wu=d("div",{class:"w-1/4"}," Raiser's Extension: ",-1),Vu={class:"w-3/4"},Gu={key:0},Ju={key:1},Ku={class:"flex flex-row w-11/12 mt-2"},Yu=d("div",{class:"w-1/4"}," Raiser's Location: ",-1),Xu={class:"w-3/4"},Qu={key:0},Zu={key:1},ef={class:"flex flex-row w-11/12 mt-2"},tf=d("div",{class:"w-1/4"}," Request Date: ",-1),rf={class:"w-3/4"},nf={class:"flex flex-row w-11/12 mt-2"},sf=d("div",{class:"w-1/4 text-black font-bold text-lg"}," Problem in Details: ",-1),of={class:"w-3/4 text-black font-bold text-lg"},af={class:"flex flex-row w-11/12 mt-2"},cf={class:"w-1/4"},lf={class:"w-3/4"},df={class:"flex flex-row w-11/12 mt-2"},hf=d("div",{class:"w-1/4"}," Approval Required: ",-1),uf={class:"w-3/4"},ff={class:"flex flex-row w-11/12 mt-2"},pf=d("div",{class:"w-1/4"}," Priority: ",-1),mf={class:"w-3/4"},gf={class:"flex flex-row w-11/12 mt-2"},_f=d("div",{class:"w-1/4"}," Department: ",-1),vf={class:"w-3/4"},yf={class:"flex flex-row w-11/12 mt-2"},bf=d("div",{class:"w-1/4"}," Location: ",-1),kf={class:"w-3/4"},Cf={class:"flex flex-row w-11/12 mt-2"},wf=d("div",{class:"w-1/4"}," Assigned To: ",-1),xf={class:"w-3/4"},Sf={class:"flex flex-row w-11/12 mt-2"},Tf=d("div",{class:"w-1/4"}," Department Head: ",-1),Rf={class:"w-3/4"},Ef={class:"flex flex-row w-11/12 mt-2"},Pf=d("div",{class:"w-1/4"}," Higher Approver: ",-1),Af={class:"w-3/4"},If={key:1,class:"flex flex-row w-11/12 mt-3"},Of=d("div",{class:"w-1/4"}," Supervisor: ",-1),Df={class:"w-3/4"},Bf=d("br",null,null,-1),$f={class:"flex flex-row w-11/12 mt-3"},Nf=d("div",{class:"w-1/4 font-bold"}," Current Status: ",-1),Mf={class:"w-3/4 text-lg font-bold text-black"},jf={class:"flex flex-row w-11/12 mt-3"},Ff=d("div",{class:"w-1/4 font-bold"}," Current Handler: ",-1),Lf={class:"w-3/4 text-lg text-black"},Uf={class:"flex flex-row w-11/12 mt-2"},Hf=d("div",{class:"w-1/4"}," Current Handler's Email: ",-1),zf={class:"w-3/4"},qf={key:0},Wf={key:1},Vf={class:"flex flex-row w-11/12 mt-2"},Gf=d("div",{class:"w-1/4"}," Current Handler's Phone: ",-1),Jf={class:"w-3/4"},Kf={key:0},Yf={key:1},Xf={class:"flex flex-row w-11/12 mt-2"},Qf=d("div",{class:"w-1/4"}," Current Handler's Extension: ",-1),Zf={class:"w-3/4"},ep={key:0},tp={key:1},rp={class:"flex flex-row w-11/12 mt-2"},np=d("div",{class:"w-1/4"}," Current Handler's Location: ",-1),sp={class:"w-3/4"},op={key:0},ip={key:1},ap={class:"flex flex-row w-11/12 mt-3"},cp=d("div",{class:"w-1/4"}," Responder Comment: ",-1),lp={class:"w-3/4 text-lg text-black"},dp={class:"flex flex-row w-11/12 mt-3"},hp=d("div",{class:"w-1/4"}," Relevant Files: ",-1),up={class:"w-3/4 text-lg font-bold text-black"},fp={class:"flex flex-col"},pp=["href"],mp={class:"w-1/4 h-screen pt-2 pr-2 text-center bg-blue"},gp={key:0,class:"mt-10 mr-4"},_p=d("div",{class:"text-2xl font-bold underline"},"Conversation:",-1),vp={class:"flex flex-col h-[400px] w-auto bg-red"},yp={class:"flex flex-col h-full w-full p-3",id:"messageArea",ref:"messageArea"},bp={key:0,class:"flex flex-col justify-end items-end w-full mb-2"},kp={class:"text-xs flex flex-row justify-end"},Cp={class:"bg-blue-500 p-3 rounded-md text-white text-xs",style:{"word-wrap":"break-word","max-width":"50%"}},wp={class:"text-xs flex flex-row justify-end"},xp={class:"text-xs flex flex-row justify-end mb-2"},Sp=["href"],Tp={class:"text-xs flex flex-row justify-end"},Rp={key:1,class:"flex flex-col w-full h-auto justify-start items-start"},Ep={class:"text-xs flex flex-row justify-end"},Pp={class:"bg-gray-200 p-3 rounded-md text-black w-[200px]",style:{"word-wrap":"break-word"}},Ap={class:"text-xs flex flex-row justify-end"},Ip={class:"text-xs flex flex-row justify-end"},Op=["href"],Dp={class:"text-xs flex flex-row justify-end"},Bp={class:"flex flex-row w-full justify-center h-auto pt-10"},$p={class:"flex flex-col bg-white text-black w-[900px] h-[500px] pt-10 mt-10 px-10 fixed overflow-y-scroll border-2 border-black border-solid",style:{top:"50px","z-index":"12312321123",left:"250px",display:"none",transition:"0.50s"},ref:"details"},Np=d("div",{class:"flex flex-row text-4xl font-extrabold"},"Details",-1),Mp={class:"ml-10"},jp=d("hr",{class:"border border-solid border-black w-3/4"},null,-1),Fp={class:"flex flex-row pl-10"},Lp=d("div",{class:"w-1/4 flex flex-row justify-between"},[d("div",null,"Action Serial Number"),d("div",null,":")],-1),Up={class:"w-3/4 ml-4"},Hp={class:"flex flex-row pl-10 mt-1"},zp=d("div",{class:"w-1/4 flex flex-row justify-between"},[d("div",null,"Action Type"),d("div",null,":")],-1),qp={class:"w-3/4 ml-4"},Wp={class:"flex flex-row items-center justify-end mb-2 sticky bottom-2"};function Vp(r,e,t,n,s,o){const i=ne("Chat"),c=ne("Actions");return p(),m(k,null,[d("div",Cu,[d("div",wu,[d("div",xu,[Su,d("div",Tu,[ft(d("textarea",{class:"border-2 border-solid w-full border-slate-300 p-3","onUpdate:modelValue":e[0]||(e[0]=a=>s.comments=a)},null,512),[[pt,s.comments]])])])]),d("div",Ru,[d("button",{class:"bg-blue-500 text-white font-bold mr-2 mt-10 p-2 border border-solid rounded-sm",onClick:e[1]||(e[1]=(...a)=>o.closeTicketProceed&&o.closeTicketProceed(...a))},"Proceed"),d("button",{class:"bg-slate-300 text-black border border-solid b font-bold mr-2 mt-10 p-2 rounded-sm",onClick:e[2]||(e[2]=(...a)=>o.closeTicket&&o.closeTicket(...a))},"Cancel")])],512),this.authStore.getUser.mailAddress==t.ticket.raisedBy.mailAddress&&t.ticket.status!="Closed Ticket"?(p(),j(i,{key:0,ticketId:t.ticket._id,user:t.ticket.currentHandler.empName},null,8,["ticketId","user"])):D("",!0),d("div",Eu,[d("div",Pu,[Au,d("div",Iu,[Ou,d("div",Du,g(t.ticket.raisedBy.empName),1)]),d("div",Bu,[$u,d("div",Nu,[t.ticket.raisedBy.mailAddress?(p(),m("span",Mu,g(t.ticket.raisedBy.mailAddress),1)):(p(),m("span",ju,"Not Available"))])]),d("div",Fu,[Lu,d("div",Uu,[t.ticket.raisedBy.phone?(p(),m("span",Hu,g(t.ticket.raisedBy.phone),1)):(p(),m("span",zu,"Not Available"))])]),d("div",qu,[Wu,d("div",Vu,[t.ticket.raisedBy.extension?(p(),m("span",Gu,g(t.ticket.raisedBy.extension),1)):(p(),m("span",Ju,"Not Available"))])]),d("div",Ku,[Yu,d("div",Xu,[t.ticket.raisedBy.location?(p(),m("span",Qu,g(t.ticket.raisedBy.location),1)):(p(),m("span",Zu,"Not Available"))])]),d("div",ef,[tf,d("div",rf,g(t.ticket.requestDate),1)]),d("div",nf,[sf,d("div",of,g(t.ticket.problemDetails),1)]),t.ticket.details&&t.ticket.details.length>0?(p(!0),m(k,{key:0},W(t.ticket.details,(a,l)=>(p(),m("div",af,[d("div",cf,g(a.label),1),d("div",lf,g(a.input),1)]))),256)):D("",!0),d("div",df,[hf,d("div",uf,[t.ticket.approvalRequired=="yes"?(p(),m(k,{key:0},[y(" Yes ")],64)):(p(),m(k,{key:1},[y(" No ")],64))])]),d("div",ff,[pf,d("div",mf,g(t.ticket.priority),1)]),d("div",gf,[_f,d("div",vf,g(t.ticket.department),1)]),d("div",yf,[bf,d("div",kf,g(t.ticket.raisedBy.unit),1)]),d("div",Cf,[wf,d("div",xf,[t.ticket.assignedTo?(p(),m(k,{key:0},[y(g(t.ticket.assignedTo.mailAddress),1)],64)):(p(),m(k,{key:1},[y(" Not Assigned Yet ")],64))])]),d("div",Sf,[Tf,d("div",Rf,g(t.ticket.ticketingHead.mailAddress),1)]),d("div",Ef,[Pf,d("div",Af,[t.ticket.higherApprover?(p(),m(k,{key:0},[y(g(t.ticket.higherApprover.mailAddress),1)],64)):(p(),m(k,{key:1},[y(" Not Available ")],64))])]),t.ticket.supervisor?(p(),m("div",If,[Of,d("div",Df,[y(g(t.ticket.supervisor.empName)+" ",1),d("i",null,g(t.ticket.supervisor.Designation)+", "+g(t.ticket.supervisor.unit),1),y(),Bf,d("i",null,[y("Extension:"),t.ticket.supervisor.extension?(p(),m(k,{key:0},[y(g(t.ticket.supervisor.extension)+",",1)],64)):(p(),m(k,{key:1},[y("N/A,")],64)),y(" Phone:"),t.ticket.supervisor.phone?(p(),m(k,{key:2},[y(g(t.ticket.raisedBy.phone)+",",1)],64)):(p(),m(k,{key:3},[y("N/A,")],64)),y(" Email:"),t.ticket.supervisor.mailAddress?(p(),m(k,{key:4},[y(g(t.ticket.supervisor.mailAddress),1)],64)):(p(),m(k,{key:5},[y("N/A,")],64))])])])):D("",!0),d("div",$f,[Nf,d("div",Mf,g(t.ticket.status),1)]),d("div",jf,[Ff,d("div",Lf,[t.ticket.currentHandler?(p(),m(k,{key:0},[y(g(t.ticket.currentHandler.empName),1)],64)):(p(),m(k,{key:1},[y(" Not Available ")],64))])]),d("div",Uf,[Hf,d("div",zf,[t.ticket.currentHandler&&t.ticket.currentHandler.mailAddress?(p(),m("span",qf,g(t.ticket.currentHandler.mailAddress),1)):(p(),m("span",Wf,"Not Available"))])]),d("div",Vf,[Gf,d("div",Jf,[t.ticket.currentHandler&&t.ticket.currentHandler.phone?(p(),m("span",Kf,g(t.ticket.currentHandler.phone),1)):(p(),m("span",Yf,"Not Available"))])]),d("div",Xf,[Qf,d("div",Zf,[t.ticket.currentHandler&&t.ticket.currentHandler.extension?(p(),m("span",ep,g(t.ticket.currentHandler.extension),1)):(p(),m("span",tp,"Not Available"))])]),d("div",rp,[np,d("div",sp,[t.ticket.currentHandler&&t.ticket.currentHandler.location?(p(),m("span",op,g(t.ticket.currentHandler.location),1)):(p(),m("span",ip,"Not Available"))])]),d("div",ap,[cp,d("div",lp,[t.ticket.remarks?(p(),m(k,{key:0},[y(g(t.ticket.remarks),1)],64)):(p(),m(k,{key:1},[y("Not Available")],64))])]),d("div",dp,[hp,d("div",up,[d("div",fp,[(p(!0),m(k,null,W(t.ticket.files,(a,l)=>(p(),m("div",{key:l},[d("a",{href:r.globalUrl+"uploads/"+a.fileName,target:"__blank",class:"underline"},g(a.originalName),9,pp)]))),128))])])])]),d("div",mp,[s.showConversationCheck==!0?(p(),m("div",gp,[_p,d("div",vp,[d("div",yp,[(p(!0),m(k,null,W(s.messages,(a,l)=>(p(),m("div",{class:"flex flex-row w-full",key:l},[a&&a.from.mailAddress==s.userForCheck.mailAddress?(p(),m("div",bp,[a.type=="text"?(p(),m(k,{key:0},[d("div",kp,g(a.time),1),d("div",Cp,g(a.message),1),d("div",wp,g(a.from.empName),1)],64)):a.type=="files"?(p(),m(k,{key:1},[d("div",xp,g(a.time),1),(p(!0),m(k,null,W(a.files,(h,u)=>(p(),m("div",{class:"bg-blue-500 p-3 text-white",style:{"word-wrap":"break-word","max-width":"50%"},key:u},[d("a",{href:this.globalUrl+"uploads/"+h.fileName,target:"_blank",class:"underline"},g(h.originalName),9,Sp)]))),128)),d("div",Tp,g(a.from.empName),1)],64)):D("",!0)])):(p(),m("div",Rp,[a.type=="text"?(p(),m(k,{key:0},[d("div",Ep,g(a.time),1),d("div",Pp,g(a.message),1),d("div",Ap,g(a.from.empName),1)],64)):a.type=="files"?(p(),m(k,{key:1},[d("div",Ip,g(a.time),1),(p(!0),m(k,null,W(a.files,(h,u)=>(p(),m("div",{class:"bg-gray-200 p-3 text-black w-[200px]",style:{"word-wrap":"break-word"},key:u},[d("a",{href:this.globalUrl+"uploads/"+h.fileName,target:"_blank",class:"underline"},g(h.originalName),9,Op)]))),128)),d("div",Dp,g(a.from.empName),1)],64)):D("",!0)]))]))),128))],512)])])):D("",!0),d("div",Bp,[d("button",{class:"bg-amber-500 text-white font-bold mr-2 mt-10 p-2 rounded-sm",onClick:e[3]||(e[3]=(...a)=>o.showDetails&&o.showDetails(...a))},"Show Details"),t.ticket.status=="Closed Ticket"?(p(),m("button",{key:0,class:"bg-green-500 text-white font-bold mr-2 mt-10 p-2 rounded-sm",onClick:e[4]||(e[4]=(...a)=>o.showConversation&&o.showConversation(...a))},"Show Conversation")):D("",!0)])])],512),d("div",$p,[Np,(p(!0),m(k,null,W(o.reversedActions,(a,l)=>(p(),m("div",{key:l,class:"flex flex-col bg-white mt-10"},[d("span",Mp,g(a.time),1),jp,d("div",Fp,[Lp,d("div",Up,g(a.serial),1)]),d("div",Hp,[zp,d("div",qp,g(o.getActionType(a)),1)]),a.type==0?(p(),m(k,{key:0},[t.ticket.approvalRequired=="yes"?(p(),j(c,{key:0,action:"Raised By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):(p(),j(c,{key:1,action:"Raised By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"]))],64)):a.type==1?(p(),j(c,{key:1,action:"Approved By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):a.type==3?(p(),j(c,{key:2,action:"Approved By",from:a.raised,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):a.type==2?(p(),j(c,{key:3,action:"Request By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):a.type==5?(p(),j(c,{key:4,action:"Assigned By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):a.type==10?(p(),j(c,{key:5,action:"Requested By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwarded To",comment:a.comments},null,8,["from","to","comment"])):a.type==11?(p(),j(c,{key:6,action:"Response By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwared To",comment:a.comments},null,8,["from","to","comment"])):a.type==12?(p(),j(c,{key:7,action:"Response By",from:a.raisedBy,to:a.forwardedTo,toAction:"Forwared To",comment:a.comments},null,8,["from","to","comment"])):a.type==6?(p(),j(c,{key:8,action:"Asked By",from:a.raisedBy,to:a.forwardedTo,toAction:"Asked From",comment:a.comments},null,8,["from","to","comment"])):a.type==7?(p(),j(c,{key:9,action:"Given By",from:a.raisedBy,to:a.forwardedTo,toAction:"Give To",comment:a.comments},null,8,["from","to","comment"])):a.type==8?(p(),j(c,{key:10,action:"Rejected By",from:a.raisedBy,to:a.forwardedTo,toAction:"Ticket From",comment:a.comments},null,8,["from","to","comment"])):a.type==4?(p(),j(c,{key:11,action:"Assigned By",from:a.raisedBy,to:a.forwardedTo,toAction:"Assigned To",comment:a.comments},null,8,["from","to","comment"])):a.type==9?(p(),j(c,{key:12,action:"Assigned By",from:a.raisedBy,to:a.forwardedTo,toAction:"Assigned To",comment:a.comments},null,8,["from","to","comment"])):D("",!0)]))),128)),d("div",Wp,[d("div",{class:"p-3 text-white font-bold bg-blue-500 rounded-sm hover:cursor-pointer",onClick:e[5]||(e[5]=(...a)=>o.showDetails&&o.showDetails(...a))},"Close")])],512)],64)}const Gp=pe(ku,[["render",Vp]]),Jp={data(r){return{ticket:r.ticket}},computed:{reversedComments(){this.ticket.actions;var r=this.ticket.actions.map(e=>({time:e.time,comment:e.comments,commenter:e.raisedBy.mailAddress}));return r.reverse()}},props:["ticket"]},Kp={class:"w-full h-3/4 overflow-y-scroll"},Yp=d("hr",{class:"border border-solid border-black"},null,-1),Xp={class:"p-3 flex flex-col"},Qp={class:"font-bold"};function Zp(r,e,t,n,s,o){return p(),m("div",Kp,[(p(!0),m(k,null,W(o.reversedComments,(i,c)=>(p(),m("div",{key:c,class:"p-3 pb-10 m-3 shadow-md shadow-black bg-white flex flex-col"},[i.comment!=null?(p(),m(k,{key:0},[y(g(i.time)+" ",1),Yp,d("div",Xp,[d("span",Qp,g(i.commenter),1),y(g(i.comment),1)])],64)):D("",!0)]))),128))])}const em=pe(Jp,[["render",Zp]]),tm={data(r){return{ticket:r.ticket}},computed:{reversedFiles(){this.ticket.actions;var r=this.ticket.actions.map(e=>({time:e.time,files:e.files,from:e.raisedBy.mailAddress}));return r.reverse()}},props:["ticket"]},rm={class:"w-full h-[500px] overflow-y-scroll"},nm={key:0,class:"p-3 m-3 shadow-md shadow-black bg-white flex flex-col"},sm=d("hr",{class:"border border-solid border-black"},null,-1),om={class:"font-bold"},im=["href"];function am(r,e,t,n,s,o){return p(),m("div",rm,[(p(!0),m(k,null,W(o.reversedFiles,(i,c)=>(p(),m("div",{key:c},[i.files!=null?(p(),m("div",nm,[y(g(i.time)+" ",1),sm,d("span",om,g(i.from),1),(p(!0),m(k,null,W(i.files,(a,l)=>(p(),m("div",{key:l,class:"p-3 flex flex-col"},[d("a",{href:r.globalUrl+"uploads/"+a.fileName,target:"__blank",class:"underline"},g(a.originalName),9,im)]))),128))])):D("",!0)]))),128))])}const cm=pe(tm,[["render",am]]),lm={data(r){return{ticket:r.ticket}},props:["ticket"],computed:{reversedInfos(){this.ticket.actions;var r=this.ticket.actions.map(e=>({time:e.time,info:e.additionalInfo,informer:e.raisedBy.mailAddress}));return r.reverse()}}},dm={class:"w-full h-[500px] overflow-y-scroll"},hm={key:0,class:"p-3 m-3 shadow-md shadow-black bg-white flex flex-col"},um=d("hr",{class:"border border-solid border-black"},null,-1),fm={class:"p-3 flex flex-col"},pm={class:"font-bold"};function mm(r,e,t,n,s,o){return p(),m("div",dm,[(p(!0),m(k,null,W(o.reversedInfos,(i,c)=>(p(),m("div",{key:c},[i.info!=null?(p(),m("div",hm,[y(g(i.time)+" ",1),um,d("div",fm,[d("span",pm,g(i.informer),1),y(" "+g(i.info),1)])])):D("",!0)]))),128))])}const gm=pe(lm,[["render",mm]]),_m={data(){return{articles:[],searchTerm:null}},props:["ticket"],created(){console.log("searched");var r=this;this.authStore.getUser;var e=this.authStore.getToken,t=this.ticket.problemDetails,n=new FormData;n.append("token",e),n.append("search",t),q.post(r.globalUrl+"getFilteredBlogs",n).then(s=>{r.articles=s.data}).catch(s=>r.$toast.warning(s))},methods:{openPage(r,e){let t=this.$router.resolve({path:e});window.open(t.href)},search(){console.log("searched");var r=this;this.authStore.getUser;var e=this.authStore.getToken,t=this.searchTerm,n=new FormData;n.append("token",e),n.append("search",t),q.post(r.globalUrl+"getFilteredBlogs",n).then(s=>{r.articles=s.data}).catch(s=>r.$toast.warning(s))},deleteArticle(r,s){console.log("delete called"),console.log(s);var t=this,n=this.authStore.getToken,s=s,o=new FormData;o.append("id",s),o.append("token",n),q.post(t.globalUrl+"deleteArticle",o).then(i=>{i.data==!0&&(t.articles=t.articles.filter(c=>c._id!=s))}).catch(i=>t.$toast.warning(i))},async copy(r,e){await navigator.clipboard.writeText(e)}}},vm={class:"w-full h-[500px] overflow-y-scroll text-sm p-3"},ym={class:"flex flex-row justify-end text-sm"},bm={class:"flex flex-row justify-center text-sm"},km={class:"flex flex-col w-full h-auto text-sm"},Cm=d("label",{class:"text-2xl font-bold mb-2 mt-2"},"Articles:",-1),wm={class:"flex flex-col w-full h-auto text-sm"},xm={class:"text-lg pb-4 font-bold text-black mb-4 border-b-2 border-b-gray-500 flex flex-row justify-between"},Sm={class:"flex flex-row justify-end w-16 items-center"},Tm=["innerHTML"],Rm={class:"mt-2 flex flex-row justify-between items-center"},Em={class:"border-2 border-solid border-black p-2"},Pm=["onClick"],Am=d("div",null,null,-1);function Im(r,e,t,n,s,o){const i=ne("font-awesome-icon");return p(),m("div",vm,[d("div",ym,[d("div",bm,[ft(d("input",{"onUpdate:modelValue":e[0]||(e[0]=c=>s.searchTerm=c),type:"search",name:"",placeholder:"Search Article",id:"",class:"focus:outline-none text-bold text-lg border-b-2 border-t-2 border-l-2 border-solid border-l-gray-500 border-t-gray-500 border-b-gray-500 p-3 w-[200px]"},null,512),[[pt,s.searchTerm]]),d("div",{class:"flex flex-col justify-center bg-gray-300 items-center p-3 border-t-2 border-r-2 border-b-2 border-solid border-r-gray-500 border-t-gray-500 border-b-gray-500 hover:cursor-pointer",onClick:e[1]||(e[1]=c=>o.search())},[Z(i,{icon:"fa-solid fa-search"})])])]),d("div",km,[Cm,d("div",wm,[(p(!0),m(k,null,W(s.articles,(c,a)=>(p(),m("div",{class:"text-sm w-full mb-5 p-3 bg-white h-auto flex flex-col border-2 border-solid border-gray-800",key:a},[d("div",xm,[y(g(c.headline)+" ",1),d("div",Sm,[Z(i,{icon:"fa-solid fa-copy",size:"lg",class:"hover:text-emerald-600 hover:scale-125 hover:cursor-pointer",onClick:l=>o.copy(l,this.frontUrl+"#/blog/article/"+c._id)},null,8,["onClick"])])]),d("div",{class:"text-sm text-black h-[60px] truncate",innerHTML:c.content},null,8,Tm),d("div",Rm,[d("div",Em,"Written By: "+g(c.authors.empName),1),d("div",{class:"border-2 border-solid border-black hover:cursor-pointer bg-blue-500 text-white font-bold p-2",onClick:l=>o.openPage(l,"/blog/article/"+c._id)},"Read Article",8,Pm)])]))),128))]),Am])])}const Om=pe(_m,[["render",Im]]),Dm={data(){return{ticket:null,showTicketDetails:!1,user:null,drawerOpen:!1,iconName:"fa-solid fa-bars",commentsCheck:!1,filesCheck:!0,infosCheck:!1,knowledgeCheck:!1,currentComponent:"Comments",prevComponent:""}},components:{CurrentHandler:bu,Viewer:Gp,Comments:em,Files:cm,Infos:gm,KnowledgeBase:Om},created(){this.loadTicket()},methods:{loadTicket(){var r=this;this.user=this.authStore.getUser,r.$toast.info("Loading Ticket");var e=this.authStore.getToken,t=this.$route.params.id,n=new FormData;n.append("token",e),n.append("id",t),n.append("user",JSON.stringify(this.user));var s=r.globalUrl+"getTicket";q.post(s,n).then(o=>{r.ticket=o.data,console.log("this is the ticket"),console.log(r.ticket),r.$toast.clear(),r.$toast.success("Ticket Loaded")}).catch(o=>console.log(o))},openShowTicketDetails(){this.showTicketDetails=!this.showTicketDetails},close(){this.$refs.handle;const r=this.$refs.drawer;this.$refs.drawerIcon,this.drawerOpen?this.drawerOpen&&(r.style.width="0px",this.drawerOpen=!1):(r.style.width="400px",this.drawerOpen=!0)},toggleComponent(r,e){this.prevComponent=this.currentComponent,this.currentComponent=e;var t=document.getElementById(e),n=document.getElementById(this.prevComponent);t.style.backgroundColor="rgb(156 163 175)",n.style.background="white"}}},Bm={class:"bg-white h-screen w-full"},$m={class:"fixed h-full w-full flex flex-col z-10 right-0 bg-gray-200",style:{width:"0px",transition:"0.3s","z-index":"99999"},ref:"drawer"},Nm={class:"flex flex-row my-2 mx-2"},Mm={class:"flex flex-col w-full bg-gray-200"};function jm(r,e,t,n,s,o){const i=ne("font-awesome-icon"),c=ne("CurrentHandler"),a=ne("Viewer");return p(),m("div",Bm,[d("div",$m,[d("div",{style:{top:"420px",left:"-45px","z-index":"99999"},class:"shadow-md shadow-black absolute h-24 w-14 z-50 bg-slate-100 rounded-sm border border-solid border-l-gray-400 border-t-gray-400 border-b-gray-400 flex flex-col justify-center items-center",ref:"handle",onClick:e[0]||(e[0]=l=>o.close())},[Z(i,{icon:s.iconName,size:"2x",id:"drawerIcon"},null,8,["icon"])],512),d("div",Nm,[d("button",{class:"bg-white font-bold hover:bg-gray-400 text-black w-32 border border-solid border-slate-300 text-sm p-2",onClick:e[1]||(e[1]=l=>o.toggleComponent(l,"Comments")),ref:"comments",id:"Comments"},"Comments",512),d("button",{class:"bg-white font-bold hover:bg-gray-400 text-black w-32 border border-solid border-slate-300 text-sm p-2",onClick:e[2]||(e[2]=l=>o.toggleComponent(l,"Infos")),ref:"infos",id:"Infos"},"Infos",512),d("button",{class:"bg-white font-bold hover:bg-gray-400 text-black w-32 border border-solid border-slate-300 text-sm p-2",onClick:e[3]||(e[3]=l=>o.toggleComponent(l,"Files")),ref:"files",id:"Files"},"Files",512),d("button",{class:"bg-white font-bold hover:bg-gray-400 text-black w-32 border border-solid border-slate-300 text-sm p-2",onClick:e[4]||(e[4]=l=>o.toggleComponent(l,"KnowledgeBase")),ref:"files",id:"KnowledgeBase"},"Knowledge Base",512)]),d("div",Mm,[s.ticket?(p(),j(ls(s.currentComponent),{key:0,ticket:s.ticket},null,8,["ticket"])):D("",!0)])],512),s.user&&s.ticket&&s.ticket.currentHandler&&(s.user.mailAddress==s.ticket.currentHandler.mailAddress||s.user.userType=="admin")?(p(),j(c,{key:0,ticket:s.ticket,handlerType:s.ticket.currentHandlerType},null,8,["ticket","handlerType"])):s.ticket&&s.user?(p(),j(a,{key:1,ticket:s.ticket,handlerType:s.ticket.currentHandlerType,class:"bg-white"},null,8,["ticket","handlerType"])):D("",!0)])}const zm=pe(Dm,[["render",jm]]);export{zm as default};
